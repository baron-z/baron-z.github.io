<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":"ture","mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="分析 mtk 平台 logo 显示接口, 自己实现一个显示 demo ，并利用 input 子系统在屏上绘图">
<meta property="og:type" content="article">
<meta property="og:title" content="番外篇-mtk平台logo显示接口">
<meta property="og:url" content="https://example.com/2021/07/03/mtk%E5%B9%B3%E5%8F%B0-lcd%E6%98%BE%E7%A4%BA%E6%8E%A5%E5%8F%A3/index.html">
<meta property="og:site_name" content="braon-z&#39;s blog">
<meta property="og:description" content="分析 mtk 平台 logo 显示接口, 自己实现一个显示 demo ，并利用 input 子系统在屏上绘图">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://myblog-1258129986.cos.ap-chengdu.myqcloud.com/linux%E9%A9%B1%E5%8A%A8/mtk-logo/1.png?q-sign-algorithm=sha1&q-ak=AKIDhKF3mfZXf8SeirDbHrMiLZbzDlsoqM1W&q-sign-time=1602580658;2466494258&q-key-time=1602580658;2466494258&q-header-list=&q-url-param-list=&q-signature=6acb057d0dc7600f2930312c87c2d5f34fae06cd
">
<meta property="og:image" content="https://myblog-1258129986.cos.ap-chengdu.myqcloud.com/linux%E9%A9%B1%E5%8A%A8/mtk-logo/2.png?q-sign-algorithm=sha1&q-ak=AKIDhKF3mfZXf8SeirDbHrMiLZbzDlsoqM1W&q-sign-time=1602582954;2466496554&q-key-time=1602582954;2466496554&q-header-list=&q-url-param-list=&q-signature=646e9394d9c44ab8fc07436cc47d3278f744087e
">
<meta property="og:image" content="https://myblog-1258129986.cos.ap-chengdu.myqcloud.com/linux%E9%A9%B1%E5%8A%A8/mtk-logo/4.png?q-sign-algorithm=sha1&q-ak=AKIDhKF3mfZXf8SeirDbHrMiLZbzDlsoqM1W&q-sign-time=1602655665;2466569265&q-key-time=1602655665;2466569265&q-header-list=&q-url-param-list=&q-signature=8a681f2ed06b6c9a79b0b698e1dbd2c0c77f2971">
<meta property="og:image" content="https://myblog-1258129986.cos.ap-chengdu.myqcloud.com/linux%E9%A9%B1%E5%8A%A8/mtk-logo/%E7%94%BB%E5%9B%BE.jpg?q-sign-algorithm=sha1&q-ak=AKIDhKF3mfZXf8SeirDbHrMiLZbzDlsoqM1W&q-sign-time=1626260415;10266174015&q-key-time=1626260415;10266174015&q-header-list=&q-url-param-list=&q-signature=6a279df81113702caddbff933964042f587ac202">
<meta property="article:published_time" content="2021-07-03T01:14:17.000Z">
<meta property="article:modified_time" content="2021-07-14T11:06:42.996Z">
<meta property="article:author" content="braon-z">
<meta property="article:tag" content="mtk">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://myblog-1258129986.cos.ap-chengdu.myqcloud.com/linux%E9%A9%B1%E5%8A%A8/mtk-logo/1.png?q-sign-algorithm=sha1&q-ak=AKIDhKF3mfZXf8SeirDbHrMiLZbzDlsoqM1W&q-sign-time=1602580658;2466494258&q-key-time=1602580658;2466494258&q-header-list=&q-url-param-list=&q-signature=6acb057d0dc7600f2930312c87c2d5f34fae06cd
">


<link rel="canonical" href="https://example.com/2021/07/03/mtk%E5%B9%B3%E5%8F%B0-lcd%E6%98%BE%E7%A4%BA%E6%8E%A5%E5%8F%A3/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<title>番外篇-mtk平台logo显示接口 | braon-z's blog</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">braon-z's blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1%E3%80%81mtk%E6%8F%90%E4%BE%9B%E4%BA%86%E6%B5%8B%E8%AF%95-demo"><span class="nav-text">1、mtk提供了测试 demo</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2%E3%80%81%E9%80%89%E6%8B%A9%E4%BD%BF%E7%94%A8%E5%BC%80%E6%9C%BA-logo"><span class="nav-text">2、选择使用开机 logo</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3%E3%80%81%E6%96%B0%E5%A2%9E%E8%87%AA%E5%B7%B1%E7%9A%84%E5%9B%BE%E7%89%87"><span class="nav-text">3、新增自己的图片</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4%E3%80%81%E8%B0%83%E7%94%A8%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90"><span class="nav-text">4、调用简单分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5%E3%80%81%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB"><span class="nav-text">5、源码阅读</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-LCM-SCREEN-T"><span class="nav-text">1) LCM_SCREEN_T</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-anim-logo-init"><span class="nav-text">2) anim_logo_init</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-anim-fb-init"><span class="nav-text">3) anim_fb_init</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-anim-set-buffer-address"><span class="nav-text">4) anim_set_buffer_address</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-anim-show-logo"><span class="nav-text">5) anim_show_logo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-fill-animation-logo"><span class="nav-text">6) fill_animation_logo</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-fill-rect-with-content"><span class="nav-text">7) fill_rect_with_content</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-fill-rect-with-content-by-32bit-argb8888"><span class="nav-text">8) fill_rect_with_content_by_32bit_argb8888</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-fill-point-buffer"><span class="nav-text">9) fill_point_buffer</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-calculate-logo-offset"><span class="nav-text">10) calculate_logo_offset</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-check-logo-index-valid"><span class="nav-text">11) check_logo_index_valid</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#13-get-total-logo-images-entries"><span class="nav-text">13) get_total_logo_images_entries</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6%E3%80%81%E5%9C%A8%E5%B1%8F%E4%B8%8A%E6%98%BE%E7%A4%BA%E4%BB%BB%E6%84%8F%E7%BB%98%E5%88%B6%E7%82%B9"><span class="nav-text">6、在屏上显示任意绘制点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7%E3%80%81%E5%9C%A8%E5%B1%8F%E5%B9%95%E4%B8%8A%E9%9D%A2%E7%BB%98%E5%88%B6"><span class="nav-text">7、在屏幕上面绘制</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="braon-z"
      src="/images/wallhaven.jfif">
  <p class="site-author-name" itemprop="name">braon-z</p>
  <div class="site-description" itemprop="description"> 爱一个人，攀一座山，追一次梦<br>不妨大胆一点，有很多事没有答案</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/yourname" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yourname@gmail.com" title="E-Mail → mailto:yourname@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


<div style="">
  <canvas id="canvas" style="width:60%;">当前浏览器不支持canvas，请更换浏览器后再试</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();
</script>
        </div>
      </div>
        <div class="back-to-top animated" role="button">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://example.com/2021/07/03/mtk%E5%B9%B3%E5%8F%B0-lcd%E6%98%BE%E7%A4%BA%E6%8E%A5%E5%8F%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/wallhaven.jfif">
      <meta itemprop="name" content="braon-z">
      <meta itemprop="description" content=" 爱一个人，攀一座山，追一次梦<br>不妨大胆一点，有很多事没有答案">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="braon-z's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          番外篇-mtk平台logo显示接口
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-03 09:14:17" itemprop="dateCreated datePublished" datetime="2021-07-03T09:14:17+08:00">2021-07-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-07-14 19:06:42" itemprop="dateModified" datetime="2021-07-14T19:06:42+08:00">2021-07-14</time>
      </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2021/07/03/mtk%E5%B9%B3%E5%8F%B0-lcd%E6%98%BE%E7%A4%BA%E6%8E%A5%E5%8F%A3/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/07/03/mtk%E5%B9%B3%E5%8F%B0-lcd%E6%98%BE%E7%A4%BA%E6%8E%A5%E5%8F%A3/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>39k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>35 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>分析 mtk 平台 logo 显示接口, 自己实现一个显示 demo ，并利用 input 子系统在屏上绘图</p>
<a id="more"></a>

<h2 id="1、mtk提供了测试-demo"><a href="#1、mtk提供了测试-demo" class="headerlink" title="1、mtk提供了测试 demo"></a>1、mtk提供了测试 demo</h2><p>/vendor/mediatek/proprietary/external/libshowlogo/libshowlogoTest //路径</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utils/Log.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//#include &lt;charging_animation.h&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VERION_OLD_ANIMATION 0</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VERION_NEW_ANIMATION 1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> VERION_WIRELESS_CHARGING_ANIMATION  2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DRAW_ANIM_MODE_FB       1</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DRAW_ANIM_MODE_SURFACE  0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span>  LOG_ANIM(x...)     dprintf(0, x)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test_charging_animation</span><span class="params">(<span class="keyword">int</span> charging_item)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> time = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(time &lt;= <span class="number">10</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (charging_item == <span class="number">2</span>) &#123;</span><br><span class="line">            show_fast_charging(<span class="number">25</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            show_battery_capacity(<span class="number">25</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        time ++;</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">// DRAW_ANIM_MODE_SURFACE 0</span></span><br><span class="line"><span class="comment">// DRAW_ANIM_MODE_FB  1</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[logo_test %s %d]libshowlogo Test ...\n&quot;</span>,__FUNCTION__,__LINE__);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;***************     libshowlogo Test       ********************\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;*******     Testlibshowlogo  introduce...               *******\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;It can test boot logo, kernel logo and charging animation using \n framebuffer or surface flinger with different parameters\n&quot;</span>); </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;***************************************************************\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; ---&gt; para 1:boot kernel charging ut\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;    boot: boot logo\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;    kernel: kernel logo \n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;    charging: charging animation\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;    ut: test all\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; ---&gt; para 2: fb sf \n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;    fb: framebuffer\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;    sf: surface flinger\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; ---&gt; para 3: new fast wireless \n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;    new: new version\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;    fast: fast Charging\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;    wireless: wireless Charging\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n ---&gt; Example (Default):libshowlogoTest boot  sf\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;**************************************************************\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> draw_mode = DRAW_ANIM_MODE_SURFACE;</span><br><span class="line">    <span class="keyword">int</span> version = VERION_OLD_ANIMATION;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> test_item = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> charging_item = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(argc &gt; <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[logo_test %s %d] argv[1]=%s\n&quot;</span>,__FUNCTION__,__LINE__,argv[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">strcmp</span>(argv[<span class="number">1</span>],<span class="string">&quot;boot&quot;</span>))&#123;</span><br><span class="line">            test_item = <span class="number">0</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!<span class="built_in">strcmp</span>(argv[<span class="number">1</span>],<span class="string">&quot;kernel&quot;</span>))&#123;</span><br><span class="line">            test_item = <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!<span class="built_in">strcmp</span>(argv[<span class="number">1</span>],<span class="string">&quot;charging&quot;</span>))&#123;</span><br><span class="line">            test_item = <span class="number">2</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!<span class="built_in">strcmp</span>(argv[<span class="number">1</span>],<span class="string">&quot;ut&quot;</span>))&#123;</span><br><span class="line">            test_item = <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(argc &gt; <span class="number">2</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[logo_test %s %d] argv[2]=%s\n&quot;</span>,__FUNCTION__,__LINE__,argv[<span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">strcmp</span>(argv[<span class="number">2</span>],<span class="string">&quot;sf&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">       	    draw_mode = DRAW_ANIM_MODE_SURFACE;</span><br><span class="line">       	&#125;<span class="keyword">else</span> <span class="keyword">if</span>(!<span class="built_in">strcmp</span>(argv[<span class="number">2</span>],<span class="string">&quot;fb&quot;</span>))&#123;</span><br><span class="line">       	    draw_mode = DRAW_ANIM_MODE_FB;</span><br><span class="line">       	&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(argc &gt; <span class="number">3</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[logo_test %s %d] argv[3]=%s\n&quot;</span>,__FUNCTION__,__LINE__,argv[<span class="number">3</span>]);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="built_in">strcmp</span>(argv[<span class="number">3</span>],<span class="string">&quot;new&quot;</span>))&#123;</span><br><span class="line">            version = VERION_NEW_ANIMATION;</span><br><span class="line">            charging_item = <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!<span class="built_in">strcmp</span>(argv[<span class="number">3</span>],<span class="string">&quot;fast&quot;</span>))&#123;</span><br><span class="line">            version = VERION_NEW_ANIMATION;</span><br><span class="line">            charging_item = <span class="number">2</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(!<span class="built_in">strcmp</span>(argv[<span class="number">3</span>],<span class="string">&quot;wireless&quot;</span>))&#123;</span><br><span class="line">            version = VERION_WIRELESS_CHARGING_ANIMATION;</span><br><span class="line">            charging_item = <span class="number">3</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[logo_test %s %d] argc =%d, draw_mode=%d,test_item=%d, version=%d, charging_item=%d\n&quot;</span></span><br><span class="line">        ,__FUNCTION__,__LINE__,argc, draw_mode,test_item,version,charging_item);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// set parameter before init</span></span><br><span class="line">    set_draw_mode(draw_mode);</span><br><span class="line">    set_anim_version(version);</span><br><span class="line">    anim_init();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[logo_test %s %d]libshowlogo Test start...\n&quot;</span>,__FUNCTION__,__LINE__);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span>(test_item)&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            show_boot_logo();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            show_kernel_logo();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            test_charging_animation(charging_item);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            show_boot_logo();</span><br><span class="line">            sleep(<span class="number">2</span>);</span><br><span class="line">            show_kernel_logo();</span><br><span class="line">            sleep(<span class="number">2</span>);</span><br><span class="line">            show_low_battery();</span><br><span class="line">            sleep(<span class="number">2</span>);</span><br><span class="line">            show_charger_ov_logo();</span><br><span class="line">            sleep(<span class="number">2</span>);</span><br><span class="line">            test_charging_animation(charging_item);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            show_low_battery();</span><br><span class="line">    &#125;</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    anim_deinit();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从代码可以看出来代码一共提供了两个接口来显示图片，分别是fb(framebuff)与sf(surface flinger)，此处对于sf不做深究，等以后有时间了在研究。跟踪代码发现，show_boot_logo，show_kernel_logo，test_charging_animation，最终都是调用了函数anim_show_logo于是，简化代码如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utils/Log.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/i2c.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/i2c-dev.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//logo显示初始化</span></span><br><span class="line">    set_draw_mode(DRAW_ANIM_MODE_FB);</span><br><span class="line">    set_anim_version(VERION_NEW_ANIMATION);</span><br><span class="line">    anim_init(); <span class="comment">// 获取 logo 相关地址以及映射 framebuffer 地址等</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//向 fb 写入对应的图片，同时显示该图片</span></span><br><span class="line">    anim_show_logo(index);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//释放init获取的数据结构</span></span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    anim_deinit();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行上述代码就能显示索引为 index 的图片，图片是怎么索引的呢？后文给出答案</p>
<h2 id="2、选择使用开机-logo"><a href="#2、选择使用开机-logo" class="headerlink" title="2、选择使用开机 logo"></a>2、选择使用开机 logo</h2><p>在路径 /vendor/mediatek/proprietary/bootable/bootloader/lk/dev/logo 下有很多logo 文件存放不同分辨率的图片</p>
<p><img width=600 src="https://myblog-1258129986.cos.ap-chengdu.myqcloud.com/linux%E9%A9%B1%E5%8A%A8/mtk-logo/1.png?q-sign-algorithm=sha1&q-ak=AKIDhKF3mfZXf8SeirDbHrMiLZbzDlsoqM1W&q-sign-time=1602580658;2466494258&q-key-time=1602580658;2466494258&q-header-list=&q-url-param-list=&q-signature=6acb057d0dc7600f2930312c87c2d5f34fae06cd
" ></p>
<p>他们之间的区别就是分辨率不同，我们选择使用的文件是和我们lcd屏分辨率相同的，如果logo的分辨率和lcd的分辨率对不上开机就会出现显示不全或者显示位置不对的问题。怎么确定每个文件的分辨率，一般有两个方法，复制其中的文件名直接百度，二就是用画图工具打开，看分辨率如下</p>
<p><img width=700 src="https://myblog-1258129986.cos.ap-chengdu.myqcloud.com/linux%E9%A9%B1%E5%8A%A8/mtk-logo/2.png?q-sign-algorithm=sha1&q-ak=AKIDhKF3mfZXf8SeirDbHrMiLZbzDlsoqM1W&q-sign-time=1602582954;2466496554&q-key-time=1602582954;2466496554&q-header-list=&q-url-param-list=&q-signature=646e9394d9c44ab8fc07436cc47d3278f744087e
" ></p>
<p>图片的下面一行显示了图片的分辨率为1080x1920，这个也是lcd的分辨率，如果已有的分辨率的图片没有和lcd相符合的怎么办呢，方法很简单，就是复制一份现有的，然后用画图工具，修改分辨率为自己需要的的就好了，当然了别忘了重命名。文件名是很重要的，代码就是通过文件名来找到对应的图片文件对其进行编译。<br>怎么使用这里面的文件呢，分别在lk和device配置 BOOT_LOGO 这个宏:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">/vendor/mediatek/proprietary/bootable/bootloader/lk/project/tb8768tp1_64_bsp.mk <span class="comment">//路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//省略部分内容</span></span><br><span class="line">......</span><br><span class="line">BOOT_LOGO := wxga <span class="comment">//配置为要用到的logo文件夹名称</span></span><br><span class="line">DEBUG := <span class="number">2</span></span><br><span class="line">#DEFINES += WITH_DEBUG_DCC=<span class="number">1</span></span><br><span class="line">DEFINES += WITH_DEBUG_UART=<span class="number">1</span></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">配置device</span><br><span class="line"></span><br><span class="line">```c</span><br><span class="line">/device/mediateksample/tb8768p1_64_bsp/ProjectConfig.mk <span class="comment">//路径</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//省略部分内容</span></span><br><span class="line">......</span><br><span class="line">BOOT_LOGO = wxga <span class="comment">//配置为要用到的logo文件夹</span></span><br><span class="line">BUILD_AGO_GMS = no</span><br><span class="line">BUILD_KERNEL = yes</span><br><span class="line">BUILD_LK = yes</span><br><span class="line">BUILD_MD32 = no</span><br><span class="line">BUILD_MTK_SDK =</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<blockquote>
<p>device和lk要同时配置成一样的，如果没有配成一样的也没关系，编译器会告诉你，编译会报错。这里的配置决定了使用哪个文件夹的图片，上述配置使用的是 wxga </p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make lk -j8 <span class="comment">//安卓9编译方式</span></span><br><span class="line"></span><br><span class="line">make vnd_images <span class="comment">//安卓11编译方式</span></span><br></pre></td></tr></table></figure>
<h2 id="3、新增自己的图片"><a href="#3、新增自己的图片" class="headerlink" title="3、新增自己的图片"></a>3、新增自己的图片</h2><p>如果我想显示一张里面没有的图片怎么新增呢，首先将我们要的图片做好，然后分辨率改成lcd相同的分辨率放入文件中</p>
<img width=700 src="https://myblog-1258129986.cos.ap-chengdu.myqcloud.com/linux%E9%A9%B1%E5%8A%A8/mtk-logo/4.png?q-sign-algorithm=sha1&q-ak=AKIDhKF3mfZXf8SeirDbHrMiLZbzDlsoqM1W&q-sign-time=1602655665;2466569265&q-key-time=1602655665;2466569265&q-header-list=&q-url-param-list=&q-signature=8a681f2ed06b6c9a79b0b698e1dbd2c0c77f2971" >

<p>图中 wxga_updata.bmp 为新增的图片，增加了图片还需要编译到它，在rules.mk 进行配置</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/vendor/mediatek/proprietary/bootable/bootloader/lk/dev/logo/rules.mk</span><br></pre></td></tr></table></figure>
<p>直接附上文件内容</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">LOCAL_DIR := $(GET_LOCAL_DIR)</span><br><span class="line">BOOT_LOGO_DIR := $(LOCAL_DIR)</span><br><span class="line"></span><br><span class="line"><span class="meta">#fix no boot_logo config</span></span><br><span class="line">#LOCAL_CFLAGS += -DBOOT_LOGO=wvga</span><br><span class="line"></span><br><span class="line">ifeq ($(strip $(BOOT_LOGO)),)</span><br><span class="line">  BOOT_LOGO = fwvga</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">ifeq ($(strip $(MTK_LK_CAMERA_SUPPORT)), yes)</span><br><span class="line">  BOOT_LOGO = fhd</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">$(info BOOT_LOGO = $(BOOT_LOGO))</span><br><span class="line">$(info lk/logo/dir=$(LOCAL_DIR),builddir=$(BUILDDIR))</span><br><span class="line"></span><br><span class="line">ifeq ($(HOST_OS),darwin)</span><br><span class="line">BMP_TO_RAW := $(BOOT_LOGO_DIR)/tool/bmp_to_raw.darwin</span><br><span class="line">ZPIPE := $(BOOT_LOGO_DIR)/tool/zpipe.darwin</span><br><span class="line">MKIMG := $(LOCAL_DIR)/../../scripts/mkimage.darwin</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">BMP_TO_RAW := $(BOOT_LOGO_DIR)/tool/bmp_to_raw</span><br><span class="line">ZPIPE := $(BOOT_LOGO_DIR)/tool/zpipe</span><br><span class="line">MKIMG := $(LOCAL_DIR)/../../scripts/mkimage</span><br><span class="line">endif</span><br><span class="line">IMG_HDR_CFG := $(LOCAL_DIR)/img_hdr_logo.cfg</span><br><span class="line"></span><br><span class="line">EMPTY :=</span><br><span class="line">UNDER_LINE := _</span><br><span class="line">TEMP := $(strip $(subst $(UNDER_LINE), $(EMPTY), $(BOOT_LOGO)))</span><br><span class="line">COUNT := $(words $(TEMP))</span><br><span class="line">BASE_LOGO := $(word $(COUNT),$(TEMP))</span><br><span class="line">EXIST := $(shell <span class="keyword">if</span> [ -e $(BOOT_LOGO_DIR)/$(BASE_LOGO) ]; then echo <span class="string">&quot;exist&quot;</span>; <span class="keyword">else</span> echo <span class="string">&quot;noexist&quot;</span>; fi;)</span><br><span class="line">ifeq ($(EXIST), <span class="string">&quot;noexist&quot;</span>)</span><br><span class="line">  BASE_LOGO := $(BOOT_LOGO)</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">SUPPORT_PUMP_EXPRESS = no</span><br><span class="line">ifeq ($(strip $(MTK_PUMP_EXPRESS_SUPPORT)), yes)</span><br><span class="line">  SUPPORT_PUMP_EXPRESS = yes</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  ifeq ($(strip $(MTK_PUMP_EXPRESS_PLUS_SUPPORT)), yes)</span><br><span class="line">    SUPPORT_PUMP_EXPRESS = yes</span><br><span class="line">  endif</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">BOOT_LOGO_RESOURCE := $(BUILDDIR)/$(BOOT_LOGO_DIR)/$(BOOT_LOGO).raw</span><br><span class="line">LOGO_IMAGE := $(BUILDDIR)/logo.bin</span><br><span class="line"></span><br><span class="line">SUPPORT_PROTOCOL1_RAT_CONFIG = no</span><br><span class="line">SUPPORT_CARRIEREXPRESS_PACK = no</span><br><span class="line">ifdef MTK_CARRIEREXPRESS_PACK</span><br><span class="line">ifneq ($(strip $(MTK_CARRIEREXPRESS_PACK)), no)</span><br><span class="line">	SUPPORT_CARRIEREXPRESS_PACK = yes</span><br><span class="line">	RAT_CONFIG = $(strip $(MTK_PROTOCOL1_RAT_CONFIG))</span><br><span class="line">	ifneq (,$(RAT_CONFIG))</span><br><span class="line">		ifneq (,$(findstring L,$(RAT_CONFIG)))</span><br><span class="line">			SUPPORT_PROTOCOL1_RAT_CONFIG = yes</span><br><span class="line">		endif</span><br><span class="line">	endif</span><br><span class="line">endif</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">ifeq ($(strip $(SUPPORT_CARRIEREXPRESS_PACK)),yes) </span><br><span class="line">RESOLUTION := $(word $(COUNT),$(TEMP))</span><br><span class="line">RESOURCE_OBJ_LIST :=   \</span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_uboot.raw <span class="comment">//第1张图片</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">RESOURCE_OBJ_LIST :=   \</span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_uboot.raw <span class="comment">//第1张图片</span></span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">ifneq ($(strip $(MACH_TYPE)), <span class="number">2701</span>)</span><br><span class="line">ifneq ($(strip $(MTK_ALPS_BOX_SUPPORT)), yes)</span><br><span class="line">RESOURCE_OBJ_LIST +=   \</span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_battery.raw \			<span class="comment">// 第2张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_low_battery.raw \		<span class="comment">// 第3张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_charger_ov.raw \			<span class="comment">// 第4张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_num_0.raw \				<span class="comment">// 第5张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_num_1.raw \				<span class="comment">// 第6张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_num_2.raw \				<span class="comment">// 第7张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_num_3.raw \				<span class="comment">// 第8张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_num_4.raw \				<span class="comment">// 第9张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_num_5.raw \				<span class="comment">// 第10张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_num_6.raw \				<span class="comment">// 第11张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_num_7.raw \				<span class="comment">// 第12张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_num_8.raw \				<span class="comment">// 第13张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_num_9.raw \				<span class="comment">// 第14张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_num_percent.raw \		<span class="comment">// 第15张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_animation_01.raw \	<span class="comment">// 第16张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_animation_02.raw \	<span class="comment">// 第17张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_animation_03.raw \	<span class="comment">// 第18张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_animation_04.raw \	<span class="comment">// 第19张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_animation_05.raw \	<span class="comment">// 第20张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_animation_06.raw \	<span class="comment">// 第21张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_animation_07.raw \	<span class="comment">// 第22张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_animation_08.raw \	<span class="comment">// 第23张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_animation_09.raw \	<span class="comment">// 第24张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_animation_10.raw \	<span class="comment">// 第25张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_10_01.raw \			<span class="comment">// 第26张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_10_02.raw \			<span class="comment">// 第27张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_10_03.raw \			<span class="comment">// 第28张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_10_04.raw \			<span class="comment">// 第29张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_10_05.raw \			<span class="comment">// 第30张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_10_06.raw \			<span class="comment">// 第31张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_10_07.raw \			<span class="comment">// 第32张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_10_08.raw \			<span class="comment">// 第33张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_10_09.raw \			<span class="comment">// 第34张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_10_10.raw \			<span class="comment">// 第35张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_bg.raw \				<span class="comment">// 第36张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_img.raw \			<span class="comment">// 第37张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_bat_100.raw				<span class="comment">// 第39张</span></span><br><span class="line">ifeq ($(strip $(SUPPORT_CARRIEREXPRESS_PACK)),yes)</span><br><span class="line">RESOURCE_OBJ_LIST +=   \</span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_kernel.raw				<span class="comment">//第39张</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">RESOURCE_OBJ_LIST +=   \</span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_kernel.raw				<span class="comment">//第39张</span></span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">RESOURCE_OBJ_LIST +=   \</span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_low_battery01.raw \		<span class="comment">//第40张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_low_battery02.raw \		<span class="comment">//第41张</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_low_battery_remind.raw	<span class="comment">//第42张</span></span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">RESOURCE_OBJ_LIST +=   \</span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_updata.raw	\			<span class="comment">//第43张，后面省略</span></span><br><span class="line">            $(BOOT_LOGO_DIR)/$(BASE_LOGO)/$(BASE_LOGO)_power_off.raw</span><br><span class="line">endif</span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>上面有两个第1张和39张，这两个是二选一，最终只会编译一个，可以看见我将新增的图片放在第43张，图片的顺序就是参数index的值，因此index就为42(index是从0开始的因此第一张图片是index 0)。为什么把图片放在这个位置，因为后面的图片，我这个项目用不着，不会影响前面图片的显示。自己添加的图片尽量加在最后面，这样不会影响前面的图片显示。显示新增的图片代码应该如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;ctype.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;utils/Log.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;dirent.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/i2c.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/i2c-dev.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//logo显示初始化</span></span><br><span class="line">    set_draw_mode(DRAW_ANIM_MODE_FB);</span><br><span class="line">    set_anim_version(VERION_NEW_ANIMATION);</span><br><span class="line">    anim_init();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//显示索引index的图片</span></span><br><span class="line">    anim_show_logo(<span class="number">42</span>); <span class="comment">//这里的42就是我们新增的图片了</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//释放init获取的数据结构</span></span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    anim_deinit();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>注：我们如果要替换里面的图片，一定要删除 out 目录下已经生成的图片bin文件，可能不会生效，重新编译才会生效！！！。</strong></p>
</blockquote>
<h2 id="4、调用简单分析"><a href="#4、调用简单分析" class="headerlink" title="4、调用简单分析"></a>4、调用简单分析</h2><p>对于这个anim_show_logo函数最终是怎么显示图片的呢，我们知道想让lcd显示图片只需将图片写入framebuff，soc的lcd控制器就会帮我们将图片显示出来，对于 anim_show_logo fb调用链如下所示</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">anim_show_logo-&gt;</span><br><span class="line">    fill_animation_logo-&gt;</span><br><span class="line">        这里省略中间调用最后会调用内核的</span><br><span class="line">            mtkfb_pan_display_proxy-&gt;</span><br><span class="line">                mtkfb_pan_display_impl-&gt;</span><br><span class="line">                    primary_display_trigger-&gt;</span><br><span class="line">                        primary_display_trigger_nolock <span class="comment">//这个函数 </span></span><br></pre></td></tr></table></figure>
<p>对于sf的调用链</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">anim_show_logo-&gt;</span><br><span class="line">        这里省略中间调用最后会调用内核的</span><br><span class="line">            primary_display_frame_cfg-&gt;</span><br><span class="line">            primary_display_trigger_nolock <span class="comment">//这个函数 </span></span><br></pre></td></tr></table></figure>
<p>中间省略是因为水平有限，懒得跟代码，我们发现无论是fb 还是 sf显示最终都调用了primary_display_trigger_nolock 这个函数，这个函数的路径</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/kernel<span class="number">-4.9</span>/drivers/misc/mediatek/video/mt6765/videox/primary_display.c</span><br></pre></td></tr></table></figure>
<p>关于充电动画的文件路径</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/vendor/mediatek/proprietary/external/libshowlogo/show_animation_common.c</span><br></pre></td></tr></table></figure>
<h2 id="5、源码阅读"><a href="#5、源码阅读" class="headerlink" title="5、源码阅读"></a>5、源码阅读</h2><p>源码阅读不排版当手册用</p>
<h3 id="1-LCM-SCREEN-T"><a href="#1-LCM-SCREEN-T" class="headerlink" title="1) LCM_SCREEN_T"></a>1) LCM_SCREEN_T</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// dedfine the LCM SCREEM parameters</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">     <span class="keyword">int</span>         width;</span><br><span class="line">     <span class="keyword">int</span>         height;</span><br><span class="line">     <span class="keyword">int</span>         bits_per_pixel;  <span class="comment">// 每个像素多少 bpp ，单位 bit</span></span><br><span class="line">     <span class="keyword">int</span>         rotation;                  <span class="comment">// phical screen rotation:0 , 90, 180, 270</span></span><br><span class="line">     <span class="keyword">int</span>         needAllign;                <span class="comment">// if need adjust the width or height with 32: no need  (0), need (1)</span></span><br><span class="line">     <span class="keyword">int</span>         allignWidth;</span><br><span class="line">     <span class="keyword">int</span>         need180Adjust;             <span class="comment">// if need adjust the drawing logo for 180 roration: no need  (0), need (1)</span></span><br><span class="line">     <span class="keyword">int</span>         fb_size;</span><br><span class="line">     <span class="keyword">int</span>         fill_dst_bits;</span><br><span class="line">     <span class="keyword">int</span>         red_offset;                <span class="comment">// if red_offset is 0: logo use format BGR565 or ABGR8888,  red_offset is 11/16: RGB565, ARGB8888</span></span><br><span class="line">     <span class="keyword">int</span>         blue_offset;               <span class="comment">// if blue_offset is 11/16: logo use format BGR565 or ABGR8888,  blue_offset is 0: RGB565, ARGB8888</span></span><br><span class="line">&#125; LCM_SCREEN_T;</span><br></pre></td></tr></table></figure>
<h3 id="2-anim-logo-init"><a href="#2-anim-logo-init" class="headerlink" title="2) anim_logo_init"></a>2) anim_logo_init</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">anim_logo_init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// read and de-compress logo data here</span></span><br><span class="line">    <span class="keyword">int</span> fd = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">    Fstab fstab;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!ReadDefaultFstab(&amp;fstab)) &#123; </span><br><span class="line">        <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">            SLOGE(<span class="string">&quot;failed to open fstab\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        error_flag = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> rec = GetEntryForMountPoint(&amp;fstab, LOGO_MNT_POINT);</span><br><span class="line">    <span class="keyword">if</span> (rec == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">            SLOGE(<span class="string">&quot;failed to get entry for %s\n&quot;</span>, LOGO_MNT_POINT);</span><br><span class="line">        &#125;</span><br><span class="line">        error_flag = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// &quot;rec-&gt;blk_device&quot; is the path</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;rec-&gt;blk_device: %s\n&quot;</span>,rec-&gt;blk_device.c_str()); <span class="comment">// 获取 logo 的设备路径</span></span><br><span class="line">    fd = open(rec-&gt;blk_device.c_str(), O_RDONLY);  <span class="comment">// 打开 logo 文件是一个块设备</span></span><br><span class="line">    <span class="comment">// get logo patition from fstab end</span></span><br><span class="line">    <span class="keyword">if</span>(fd &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">            SLOGE(<span class="string">&quot;[libshowlogo: %s %d]open logo partition device file fail, errno = %d \n&quot;</span>,__FUNCTION__,__LINE__ , errno);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">goto</span> error_return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//申请 logo 需要的内存空间</span></span><br><span class="line">    logo_addr = (<span class="keyword">unsigned</span> <span class="keyword">int</span>*)<span class="built_in">malloc</span>(LOGO_BUFFER_SIZE);</span><br><span class="line">    <span class="keyword">if</span>(logo_addr == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">            SLOGE(<span class="string">&quot;[libshowlogo: %s %d]allocate logo buffer fail, size=0x%08x \n&quot;</span>,__FUNCTION__,__LINE__ , LOGO_BUFFER_SIZE);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">goto</span> error_return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// (1) skip the image header 读取头部信息</span></span><br><span class="line">    len = read(fd, logo_addr, <span class="number">512</span>);</span><br><span class="line">    <span class="keyword">if</span> (len &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">            SLOGE(<span class="string">&quot;[libshowlogo: %s %d]read from logo addr for 512B is failed! \n&quot;</span>,__FUNCTION__,__LINE__);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">goto</span> error_return;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// get the image //获取照片</span></span><br><span class="line">    len = read(fd, logo_addr, LOGO_BUFFER_SIZE - <span class="number">512</span>);</span><br><span class="line">    <span class="keyword">if</span> (len &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">            SLOGE(<span class="string">&quot;[libshowlogo: %s %d]read from logo addr for buffer is failed! \n&quot;</span>,__FUNCTION__,__LINE__);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">goto</span> error_return;</span><br><span class="line">    &#125;</span><br><span class="line">    close(fd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (show_animationm_ver &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> *pinfo = (<span class="keyword">unsigned</span> <span class="keyword">int</span>*)logo_addr;</span><br><span class="line">        <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">            SLOGD(<span class="string">&quot;[libshowlogo: %s %d]pinfo[0]=%d, pinfo[1]=%d\n&quot;</span>, __FUNCTION__,__LINE__, pinfo[<span class="number">0</span>], pinfo[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((show_animationm_ver == VERION_WIRELESS_CHARGING_ANIMATION) &amp;&amp; (pinfo[<span class="number">0</span>] &lt; ANIM_V2_LOGO_NUM))</span><br><span class="line">        &#123;</span><br><span class="line">            set_anim_version(VERION_NEW_ANIMATION);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (pinfo[<span class="number">0</span>] &lt; ANIM_V1_LOGO_NUM)</span><br><span class="line">        &#123;</span><br><span class="line">            kernel_logo_position = ANIM_V0_LOGO_NUM - <span class="number">1</span>;</span><br><span class="line">            set_anim_version(VERION_OLD_ANIMATION);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">        SLOGD(<span class="string">&quot;[libshowlogo: %s %d]show_animationm_ver =  :%d&quot;</span>,__FUNCTION__,__LINE__ ,show_animationm_ver);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">error_return:</span><br><span class="line">    <span class="keyword">if</span>(fd &gt;= <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        close(fd);</span><br><span class="line">    &#125;</span><br><span class="line">    free_fstab();</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">    error_flag = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">        SLOGD(<span class="string">&quot;[libshowlogo: %s %d] error return !!!\n&quot;</span>,__FUNCTION__,__LINE__);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// to prevent interlace operation with MD reset</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="3-anim-fb-init"><a href="#3-anim-fb-init" class="headerlink" title="3) anim_fb_init"></a>3) anim_fb_init</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">anim_fb_init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">        SLOGD(<span class="string">&quot;[libshowlogo: %s %d]\n&quot;</span>,__FUNCTION__,__LINE__);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fb_fd = open(FB_NODE_PATH, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span>(fb_fd &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">            SLOGE(<span class="string">&quot;[libshowlogo: %s %d]open dev file fail, errno = %d \n&quot;</span>,__FUNCTION__,__LINE__ , errno);</span><br><span class="line">        &#125;</span><br><span class="line">        close(fb_fd);</span><br><span class="line">        error_flag = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 返回 lcd 可变信息</span></span><br><span class="line">    ioctl(fb_fd, FBIOGET_VSCREENINFO, &amp;vinfo);</span><br><span class="line">    <span class="comment">// 返回 lcd 固定信息</span></span><br><span class="line">    ioctl(fb_fd, FBIOGET_FSCREENINFO, &amp;finfo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算fb 的大小</span></span><br><span class="line">    fb_size  = finfo.line_length * vinfo.yres;</span><br><span class="line">    <span class="comment">//分配内存空间</span></span><br><span class="line">    dec_logo_addr = (<span class="keyword">unsigned</span> <span class="keyword">int</span>*) <span class="built_in">malloc</span>(fb_size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将屏幕缓冲区映射到用户空间</span></span><br><span class="line">    lk_fb_addr =(<span class="keyword">unsigned</span> <span class="keyword">int</span>*)mmap(<span class="number">0</span>, fb_size*<span class="number">3</span>, PROT_READ | PROT_WRITE, MAP_SHARED, fb_fd, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第一帧地址用于显示 charging</span></span><br><span class="line">    charging_fb_addr = (<span class="keyword">unsigned</span> <span class="keyword">int</span>*)((<span class="keyword">unsigned</span> <span class="keyword">int</span>)lk_fb_addr + fb_size);</span><br><span class="line">    <span class="comment">// 第二帧地址用于显示 kernel_fb_addr</span></span><br><span class="line">    kernel_fb_addr = (<span class="keyword">unsigned</span> <span class="keyword">int</span>*)((<span class="keyword">unsigned</span> <span class="keyword">int</span>)charging_fb_addr + fb_size);</span><br><span class="line">    fb_addr = lk_fb_addr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123; <span class="comment">// debug</span></span><br><span class="line">        SLOGD(<span class="string">&quot;[libshowlogo: %s %d]vinfo:xres  = %d, yres = %d, xres_virtual =%d, bits_per_pixel = %d,red.offset = %d,blue.offset = %d\n&quot;</span></span><br><span class="line">                ,__FUNCTION__, __LINE__, vinfo.xres,vinfo.yres, vinfo.xres_virtual, vinfo.bits_per_pixel,vinfo.red.offset,vinfo.blue.offset);</span><br><span class="line"></span><br><span class="line">        SLOGD(<span class="string">&quot;[libshowlogo: %s %d]fb_size =%d, fb_addr = %d,charging_fb_addr=%d\n&quot;</span></span><br><span class="line">                ,__FUNCTION__, __LINE__, fb_size,( <span class="keyword">int</span>)fb_addr, (<span class="keyword">int</span>)charging_fb_addr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(fb_addr == <span class="literal">NULL</span> || charging_fb_addr == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">            SLOGE(<span class="string">&quot;ChargingAnimation mmap fail\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        munmap(lk_fb_addr, fb_size*<span class="number">2</span>);</span><br><span class="line">        close(fb_fd);</span><br><span class="line">        error_flag = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取对应的 lcm 参数</span></span><br><span class="line">    phical_screen.bits_per_pixel = vinfo.bits_per_pixel; <span class="comment">// 每个像素多少 bpp ，单位 bit </span></span><br><span class="line">    phical_screen.fill_dst_bits = vinfo.bits_per_pixel;  <span class="comment">// 每个像素多少 bpp ，单位 bit</span></span><br><span class="line">    phical_screen.red_offset = vinfo.red.offset;    <span class="comment">// 红色像素偏移位置</span></span><br><span class="line">    phical_screen.blue_offset = vinfo.blue.offset;  <span class="comment">// 蓝色像素偏移位置</span></span><br><span class="line"></span><br><span class="line">    phical_screen.width = vinfo.xres;  <span class="comment">// 屏幕一行有多少个像素点</span></span><br><span class="line">    phical_screen.height = vinfo.yres; <span class="comment">// 屏幕一列有多少个像素点</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//每一行的像素个数</span></span><br><span class="line">    phical_screen.allignWidth = finfo.line_length/(vinfo.bits_per_pixel/<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    phical_screen.needAllign = <span class="number">1</span>;</span><br><span class="line">    phical_screen.need180Adjust = <span class="number">1</span>;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">//一帧图片的大小</span></span><br><span class="line">    phical_screen.fb_size = fb_size;</span><br><span class="line">    <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">        SLOGD(<span class="string">&quot;[libshowlogo: %s %d]MTK_LCM_PHYSICAL_ROTATION = %s\n&quot;</span>,__FUNCTION__,__LINE__, MTK_LCM_PHYSICAL_ROTATION);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> rotation = getRotation(); <span class="comment">//获取屏幕旋转多少度</span></span><br><span class="line">    <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">        SLOGD(<span class="string">&quot;[libshowlogo: %s %d]rotation = %d\n&quot;</span>,__FUNCTION__,__LINE__, rotation);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(ORIENTATION_270 == rotation)&#123;<span class="comment">//270</span></span><br><span class="line">        phical_screen.rotation = <span class="number">270</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(ORIENTATION_90 == rotation)&#123;<span class="comment">//90</span></span><br><span class="line">        phical_screen.rotation = <span class="number">90</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>((ORIENTATION_180 == rotation) &amp;&amp; (phical_screen.need180Adjust == <span class="number">1</span>))&#123;<span class="comment">//180</span></span><br><span class="line">        phical_screen.rotation = <span class="number">180</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        phical_screen.rotation = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">        SLOGD(<span class="string">&quot;[libshowlogo]phical_screen: width= %d,height= %d,bits_per_pixel =%d,needAllign = %d,allignWidth=%d rotation =%d ,need180Adjust = %d\n&quot;</span>,</span><br><span class="line">                phical_screen.width, phical_screen.height,</span><br><span class="line">                phical_screen.bits_per_pixel, phical_screen.needAllign,</span><br><span class="line">                phical_screen.allignWidth, phical_screen.rotation, phical_screen.need180Adjust);</span><br><span class="line">        SLOGD(<span class="string">&quot;[libshowlogo: %s %d]show old animtion= 1, running show_animationm_ver %d\n&quot;</span>,__FUNCTION__,__LINE__, show_animationm_ver);</span><br><span class="line">        SLOGD(<span class="string">&quot;[libshowlogo: %s %d]draw_anim_mode = 1, running mode %d\n&quot;</span>,__FUNCTION__,__LINE__, draw_anim_mode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="4-anim-set-buffer-address"><a href="#4-anim-set-buffer-address" class="headerlink" title="4) anim_set_buffer_address"></a>4) anim_set_buffer_address</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">anim_set_buffer_address</span><span class="params">(<span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (index == BOOT_LOGO_INDEX) &#123;</span><br><span class="line">        fb_addr = lk_fb_addr;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index == kernel_logo_position) &#123;</span><br><span class="line">        fb_addr = kernel_fb_addr;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        anim_fb_addr_switch();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-anim-show-logo"><a href="#5-anim-show-logo" class="headerlink" title="5) anim_show_logo"></a>5) anim_show_logo</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">anim_show_logo</span><span class="params">(<span class="keyword">int</span> index)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">         SLOGD(<span class="string">&quot;[libshowlogo: %s %d]draw_anim_mode=%d, show  index =  %d\n&quot;</span>,__FUNCTION__,__LINE__,draw_anim_mode,index);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (draw_anim_mode == (DRAW_ANIM_MODE_FB)) &#123;</span><br><span class="line">        anim_set_buffer_address(index); <span class="comment">// 获取显存地址</span></span><br><span class="line">        fill_animation_logo(index, fb_addr, dec_logo_addr, logo_addr,phical_screen);</span><br><span class="line">        anim_fb_disp_update();</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ARect tmpRect;</span><br><span class="line">        tmpRect.left = <span class="number">0</span>;</span><br><span class="line">        tmpRect.top = <span class="number">0</span>;</span><br><span class="line">        tmpRect.right = phical_screen.width;</span><br><span class="line">        tmpRect.bottom = phical_screen.height;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">status_t</span>  lockResult = surface-&gt;lock(&amp;outBuffer, &amp;tmpRect);</span><br><span class="line">        <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">            SLOGD(<span class="string">&quot;[libshowlogo: %s %d]outBuffer.bits = %d\n&quot;</span>,__FUNCTION__,__LINE__, (<span class="keyword">int</span>)outBuffer.bits);</span><br><span class="line">            SLOGD(<span class="string">&quot;[libshowlogo: %s %d]surface-&gt;lock return =  0x%08x,  %d\n&quot;</span>,__FUNCTION__,__LINE__,lockResult,lockResult);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">0</span> == lockResult)</span><br><span class="line">        &#123;</span><br><span class="line">            fill_animation_logo(index, (<span class="keyword">void</span> *)outBuffer.bits, dec_logo_addr, logo_addr,phical_screen);</span><br><span class="line">            surface-&gt;unlockAndPost();</span><br><span class="line">        &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-fill-animation-logo"><a href="#6-fill-animation-logo" class="headerlink" title="6) fill_animation_logo"></a>6) fill_animation_logo</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index 图片索引</span></span><br><span class="line"><span class="comment">// fill_addr 显存地址</span></span><br><span class="line"><span class="comment">// dec_logo_addr </span></span><br><span class="line"><span class="comment">// logo_addr logo.bin 的数据首地址</span></span><br><span class="line"><span class="comment">// phical_screen 内核 获取的 lcd 的信息</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fill_animation_logo</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">void</span> *fill_addr, <span class="keyword">void</span> * dec_logo_addr, <span class="keyword">void</span> * logo_addr, LCM_SCREEN_T phical_screen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LOGO_PARA_T logo_info;</span><br><span class="line">    <span class="keyword">int</span> logo_width;</span><br><span class="line">    <span class="keyword">int</span> logo_height;</span><br><span class="line">    <span class="keyword">int</span> raw_data_size;</span><br><span class="line">    <span class="keyword">int</span> logo_index = index;</span><br><span class="line">    <span class="keyword">int</span> logo_offset = <span class="number">-1</span>;</span><br><span class="line">    g_dec_logo_addr = dec_logo_addr;</span><br><span class="line"></span><br><span class="line">    logo_offset = calculate_logo_offset(index, dec_logo_addr, logo_addr, phical_screen);</span><br><span class="line">    <span class="keyword">if</span>(logo_offset == <span class="number">-1</span>)&#123;</span><br><span class="line">        SLOGD(<span class="string">&quot;[calculate_logo_offset: %s %d]Resolution not supported\n&quot;</span>,__FUNCTION__,__LINE__);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 计算要显示的图片索引</span></span><br><span class="line">    logo_index = logo_index + logo_offset;</span><br><span class="line">    <span class="keyword">if</span>(check_logo_index_valid(logo_index, logo_addr, &amp;logo_info) != CHECK_LOGO_BIN_OK)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将图片解压缩</span></span><br><span class="line">    <span class="comment">// logo_info.inaddr         解压缩前图片地址</span></span><br><span class="line">    <span class="comment">// dec_logo_addr            解压缩后图片地址</span></span><br><span class="line">    <span class="comment">// logo_info.logolen        解压缩前图片长度</span></span><br><span class="line">    <span class="comment">// phical_screen.fb_size    解压缩后图片长度</span></span><br><span class="line">    raw_data_size = decompress_logo((<span class="keyword">void</span>*)logo_info.inaddr, dec_logo_addr, logo_info.logolen, phical_screen.fb_size);</span><br><span class="line">    <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">        SLOGD(<span class="string">&quot;[show_animation_common: %s %d]raw_data_size = %d\n&quot;</span>,__FUNCTION__,__LINE__, raw_data_size);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//RECT_REGION_T rect = &#123;0, 0, phical_screen.width, phical_screen.height&#125;;</span></span><br><span class="line">    logo_width =phical_screen.width;</span><br><span class="line">    logo_height = phical_screen.height;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果旋转图片则交换长宽位置</span></span><br><span class="line">    <span class="keyword">if</span> (phical_screen.rotation == <span class="number">270</span> || phical_screen.rotation == <span class="number">90</span>) &#123;</span><br><span class="line">        logo_width = phical_screen.height;</span><br><span class="line">        logo_height = phical_screen.width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算每一个像素需要的 bit</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">0</span> == bits) &#123;</span><br><span class="line">        <span class="keyword">if</span> (raw_data_size == logo_width*logo_height*<span class="number">4</span>) &#123;</span><br><span class="line">            bits = <span class="number">32</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (raw_data_size == logo_width*logo_height*<span class="number">2</span>) &#123;</span><br><span class="line">            bits = <span class="number">16</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">                SLOGE(<span class="string">&quot;[show_animation_common: %s %d]Logo data error\n&quot;</span>,__FUNCTION__,__LINE__);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">            SLOGD(<span class="string">&quot;[show_animation_common: %s %d]bits = %d\n&quot;</span>,__FUNCTION__,__LINE__, bits);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//设置显示区域大小</span></span><br><span class="line">    RECT_REGION_T rect = &#123;<span class="number">0</span>, <span class="number">0</span>, logo_width, logo_height&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将数据填充到 fb 显示图片</span></span><br><span class="line">    fill_rect_with_content(fill_addr, rect, dec_logo_addr, phical_screen, bits);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="7-fill-rect-with-content"><a href="#7-fill-rect-with-content" class="headerlink" title="7) fill_rect_with_content"></a>7) fill_rect_with_content</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fill_rect_with_content</span><span class="params">(<span class="keyword">void</span> *fill_addr, RECT_REGION_T rect, <span class="keyword">void</span> *src_addr, LCM_SCREEN_T phical_screen, <span class="keyword">unsigned</span> <span class="keyword">int</span> bits)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">        SLOGD(<span class="string">&quot;[show_logo_common: %s %d]\n&quot;</span>,__FUNCTION__,__LINE__);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (check_rect_valid(rect) != CHECK_RECT_OK)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">if</span> (bits == <span class="number">32</span>) &#123; <span class="comment">//32 位</span></span><br><span class="line">        <span class="keyword">if</span> (phical_screen.fill_dst_bits == <span class="number">16</span>) &#123; <span class="comment">// fb 每个像素需要16bit</span></span><br><span class="line">            fill_rect_with_content_by_16bit_argb8888((<span class="keyword">unsigned</span> <span class="keyword">short</span> *)fill_addr, rect, (<span class="keyword">unsigned</span> <span class="keyword">int</span> *)src_addr, phical_screen);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (phical_screen.fill_dst_bits == <span class="number">32</span>)&#123; <span class="comment">//// fb 每个像素需要16bit</span></span><br><span class="line">            fill_rect_with_content_by_32bit_argb8888((<span class="keyword">unsigned</span> <span class="keyword">int</span> *)fill_addr, rect, (<span class="keyword">unsigned</span> <span class="keyword">int</span> *)src_addr, phical_screen, bits);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">                SLOGD(<span class="string">&quot;[show_logo_common %s %d]unsupported phical_screen.fill_dst_bits =%d\n&quot;</span>,__FUNCTION__,__LINE__, phical_screen.fill_dst_bits );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (phical_screen.fill_dst_bits == <span class="number">16</span>) &#123;</span><br><span class="line">            fill_rect_with_content_by_16bit_rgb565((<span class="keyword">unsigned</span> <span class="keyword">short</span> *)fill_addr, rect, (<span class="keyword">unsigned</span> <span class="keyword">short</span> *)src_addr, phical_screen);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (phical_screen.fill_dst_bits == <span class="number">32</span>)&#123;</span><br><span class="line">            fill_rect_with_content_by_32bit_rgb565((<span class="keyword">unsigned</span> <span class="keyword">int</span> *)fill_addr, rect, (<span class="keyword">unsigned</span> <span class="keyword">short</span> *)src_addr, phical_screen, bits);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">                SLOGD(<span class="string">&quot;[show_logo_common %s %d]unsupported phical_screen.fill_dst_bits =%d\n&quot;</span>,__FUNCTION__,__LINE__, phical_screen.fill_dst_bits );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="8-fill-rect-with-content-by-32bit-argb8888"><a href="#8-fill-rect-with-content-by-32bit-argb8888" class="headerlink" title="8) fill_rect_with_content_by_32bit_argb8888"></a>8) fill_rect_with_content_by_32bit_argb8888</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fill_rect_with_content_by_32bit_argb8888</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *fill_addr, RECT_REGION_T rect, <span class="keyword">unsigned</span> <span class="keyword">int</span> *src_addr, LCM_SCREEN_T phical_screen, <span class="keyword">unsigned</span> <span class="keyword">int</span> bits)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">        SLOGD(<span class="string">&quot;[show_logo_common: %s %d]\n&quot;</span>,__FUNCTION__,__LINE__);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> virtual_width = phical_screen.needAllign == <span class="number">0</span>? phical_screen.width:phical_screen.allignWidth;</span><br><span class="line">    <span class="keyword">int</span> virtual_height = phical_screen.height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> * dst_addr = fill_addr;  <span class="comment">// 要填充的显存地址</span></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> * color_addr = src_addr; <span class="comment">// 要显示的图片地址</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// left, top, right, bottom</span></span><br><span class="line">    <span class="comment">// RECT_REGION_T rect = &#123;0, 0, logo_width, logo_height&#125;;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 0 - logo_height</span></span><br><span class="line">    <span class="keyword">for</span>(i = rect.top; i &lt; rect.bottom; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 0 - logo_width</span></span><br><span class="line">        <span class="keyword">for</span>(j = rect.left; j &lt; rect.right; j++) <span class="comment">// 逐行显示</span></span><br><span class="line">        &#123;</span><br><span class="line">            color_addr = (<span class="keyword">unsigned</span> <span class="keyword">int</span> *)src_addr; <span class="comment">// 获取要显示的地址</span></span><br><span class="line">            src_addr++;</span><br><span class="line">            <span class="keyword">switch</span> (phical_screen.rotation)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">90</span>:</span><br><span class="line">                    dst_addr = fill_addr + (virtual_width * j  + phical_screen.width - i - <span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">270</span>:</span><br><span class="line">                    dst_addr = fill_addr + ((virtual_width * (virtual_height - j - <span class="number">1</span>)+ i));</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">180</span>:</span><br><span class="line">                    <span class="comment">// adjust fill in address</span></span><br><span class="line">                    dst_addr = fill_addr + virtual_width * (virtual_height - i)- j<span class="number">-1</span>-(virtual_width-phical_screen.width);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">default</span>:</span><br><span class="line">                    dst_addr = fill_addr + virtual_width * i + j;</span><br><span class="line">            &#125;</span><br><span class="line">            fill_point_buffer(dst_addr, *color_addr, phical_screen, bits);</span><br><span class="line">            <span class="keyword">if</span>((i == rect.top &amp;&amp; j == rect.left) || (i == rect.bottom - <span class="number">1</span> &amp;&amp; j == rect.left) ||</span><br><span class="line">               (i == rect.top &amp;&amp; j == rect.right - <span class="number">1</span>) || (i == rect.bottom - <span class="number">1</span> &amp;&amp; j == rect.right - <span class="number">1</span>))&#123;</span><br><span class="line">                <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">                    SLOGD(<span class="string">&quot;[show_logo_common]dst_addr= 0x%08x, color_addr= 0x%08x, i= %d, j=%d\n&quot;</span>, *dst_addr, *color_addr, i , j);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="9-fill-point-buffer"><a href="#9-fill-point-buffer" class="headerlink" title="9) fill_point_buffer"></a>9) fill_point_buffer</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fill_point_buffer</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *fill_addr, <span class="keyword">unsigned</span> <span class="keyword">int</span> src_color, LCM_SCREEN_T phical_screen, <span class="keyword">unsigned</span> <span class="keyword">int</span> bits)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="number">32</span> == phical_screen.bits_per_pixel) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">32</span> == bits) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="number">16</span> == phical_screen.blue_offset) &#123;</span><br><span class="line">                *fill_addr = ARGB8888_TO_ABGR8888(src_color);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                *fill_addr = src_color;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="number">16</span> == phical_screen.blue_offset) &#123;</span><br><span class="line">                *fill_addr = RGB565_TO_ARGB8888(src_color);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                *fill_addr = RGB565_TO_ABGR8888(src_color);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">            SLOGD(<span class="string">&quot;[show_logo_common %s %d]not support bits_per_pixel = %d \n&quot;</span>,__FUNCTION__,__LINE__,(<span class="keyword">int</span>)phical_screen.bits_per_pixel);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="10-calculate-logo-offset"><a href="#10-calculate-logo-offset" class="headerlink" title="10) calculate_logo_offset"></a>10) calculate_logo_offset</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index 图片索引</span></span><br><span class="line"><span class="comment">// dec_logo_addr 图片解压缩后的图片地址</span></span><br><span class="line"><span class="comment">// logo_addr logo.bin 的数据首地址</span></span><br><span class="line"><span class="comment">// phical_screen 内核获取的屏参数</span></span><br><span class="line"><span class="comment">// 返货图片索引的偏移位置</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calculate_logo_offset</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> index, <span class="keyword">void</span> * dec_logo_addr, <span class="keyword">void</span> * logo_addr, LCM_SCREEN_T phical_screen)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    LOGO_PARA_T logo_info;</span><br><span class="line">    <span class="keyword">int</span> logo_width = phical_screen.width;</span><br><span class="line">    <span class="keyword">int</span> logo_height = phical_screen.height;</span><br><span class="line">    <span class="keyword">int</span> raw_data_size;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> *pinfo;</span><br><span class="line">    <span class="keyword">int</span> logo_index = index;</span><br><span class="line">    <span class="keyword">int</span> total_logo_entries = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(logo_offset != <span class="number">-1</span>)</span><br><span class="line">        <span class="keyword">return</span> logo_offset;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取 logo.bin 的数据首地址</span></span><br><span class="line">    pinfo = (<span class="keyword">unsigned</span> <span class="keyword">int</span>*)logo_addr;</span><br><span class="line">    logo_offset = <span class="number">0</span>;</span><br><span class="line">    total_logo_entries = get_total_logo_images_entries(); <span class="comment">// 获取 logo 的长度</span></span><br><span class="line">    SLOGD(<span class="string">&quot;[calculate_logo_offset: %s %d]pinfo[0] = %d\n&quot;</span>,__FUNCTION__,__LINE__, pinfo[<span class="number">0</span>]); <span class="comment">// 打印所有的图片有多少张</span></span><br><span class="line"></span><br><span class="line">    SLOGD(<span class="string">&quot;[calculate_logo_offset: %s %d]TOTAL_LOG0_COUNT = %d , initial index = %d\n&quot;</span>,__FUNCTION__,__LINE__, total_logo_entries, logo_index);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(logo_index &lt;  pinfo[<span class="number">0</span>])&#123; <span class="comment">//如果显示的索引是否小于图片数量</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// logo_info-&gt;logonum   获取图片数量</span></span><br><span class="line">        <span class="comment">// logo_info-&gt;logolen   获取要显示的图片长度</span></span><br><span class="line">        <span class="comment">// logo_info-&gt;inaddr    获取要显示的图片的地址</span></span><br><span class="line">        <span class="keyword">if</span>(check_logo_index_valid(logo_index, logo_addr, &amp;logo_info) != CHECK_LOGO_BIN_OK)&#123;</span><br><span class="line">            SLOGD(<span class="string">&quot;[calculate_logo_offset: %s %d][Error]Resolution not supported&quot;</span>,</span><br><span class="line">                  __FUNCTION__,__LINE__);</span><br><span class="line">            logo_offset = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将图片解压缩</span></span><br><span class="line">        <span class="comment">// logo_info.inaddr         解压缩前图片地址</span></span><br><span class="line">        <span class="comment">// dec_logo_addr            解压缩后图片地址</span></span><br><span class="line">        <span class="comment">// logo_info.logolen        解压缩前图片长度</span></span><br><span class="line">        <span class="comment">// phical_screen.fb_size    解压缩后图片长度</span></span><br><span class="line">        raw_data_size = decompress_logo((<span class="keyword">void</span>*)logo_info.inaddr, dec_logo_addr, logo_info.logolen，phical_screen.fb_size);</span><br><span class="line"></span><br><span class="line">        SLOGD(<span class="string">&quot;[calculate_logo_offset: %s %d]Width = %d\n  Height = %d\n  raw_data_size = %d\n  logo_index = %d\n&quot;</span>,</span><br><span class="line">              __FUNCTION__,__LINE__, logo_width, logo_height, raw_data_size, logo_index);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//获取每个像素的像素点</span></span><br><span class="line">        <span class="keyword">if</span> (raw_data_size == logo_width*logo_height*<span class="number">4</span>) &#123;</span><br><span class="line">            bits = <span class="number">32</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (raw_data_size == logo_width*logo_height*<span class="number">2</span>) &#123;</span><br><span class="line">            bits = <span class="number">16</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logo_offset += total_logo_entries;<span class="comment">// Add number of logos entries</span></span><br><span class="line">            logo_index += total_logo_entries;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        SLOGD(<span class="string">&quot;[calculate_logo_offset: %s %d]bits = %d\n&quot;</span>,__FUNCTION__,__LINE__, bits);</span><br><span class="line">        SLOGD(<span class="string">&quot;[calculate_logo_offset: %s %d]logo_offset = %d  logo_index = %d\n&quot;</span>,__FUNCTION__,__LINE__, logo_offset,logo_index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SLOGD(<span class="string">&quot;[calculate_logo_offset: %s %d] final logo_offset = %d logo_index = %d\n&quot;</span>,__FUNCTION__,__LINE__, logo_offset,logo_index);</span><br><span class="line">    <span class="keyword">return</span> logo_offset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="11-check-logo-index-valid"><a href="#11-check-logo-index-valid" class="headerlink" title="11) check_logo_index_valid"></a>11) check_logo_index_valid</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Check logo.bin address if valid, and get logo related info</span></span><br><span class="line"><span class="comment"> * pinfo[0] : the number of all pictures in logo.bin</span></span><br><span class="line"><span class="comment"> * pinf0[1] : the whole length of logo.bin</span></span><br><span class="line"><span class="comment"> * pinf0[2] : the index = 0 picture&#x27;s length</span></span><br><span class="line"><span class="comment"> * pinfo[3+index] - pinfo[2+index] : means index length</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">check_logo_index_valid</span><span class="params">(<span class="keyword">int</span> index, <span class="keyword">void</span> * logo_addr, LOGO_PARA_T *logo_info)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> *pinfo = (<span class="keyword">unsigned</span> <span class="keyword">int</span>*)logo_addr;</span><br><span class="line">    logo_info-&gt;logonum = pinfo[<span class="number">0</span>]; <span class="comment">// 获取图片数量</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">        SLOGD(<span class="string">&quot;[show_animation_common: %s %d]logonum =%d, index =%d\n&quot;</span>, __FUNCTION__,__LINE__,logo_info-&gt;logonum, index);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (index &gt;= logo_info-&gt;logonum)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">            SLOGE(<span class="string">&quot;[show_animation_common: %s %d]unsupported logo, index =%d\n&quot;</span>, __FUNCTION__,__LINE__, index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> CHECK_LOGO_BIN_ERROR;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(index &lt; logo_info-&gt;logonum - <span class="number">1</span>) &#123;</span><br><span class="line">        logo_info-&gt;logolen = pinfo[<span class="number">3</span>+index] - pinfo[<span class="number">2</span>+index]; <span class="comment">// 获取要显示的图片长度</span></span><br><span class="line">        <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">            SLOGD(<span class="string">&quot;show_animation_common, pinfo[1]=%d, pinfo[3+index] - pinfo[2+index]= %d\n&quot;</span>,</span><br><span class="line">                   pinfo[<span class="number">1</span>], pinfo[<span class="number">3</span>+index] - pinfo[<span class="number">2</span>+index]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        logo_info-&gt;logolen = pinfo[<span class="number">1</span>] - pinfo[<span class="number">2</span>+index]; <span class="comment">// 获取要显示的图片长度</span></span><br><span class="line">        <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">            SLOGD(<span class="string">&quot;show_animation_common, pinfo[1]=%d, pinfo[1] - pinfo[2+index] =%d \n&quot;</span>,</span><br><span class="line">                   pinfo[<span class="number">1</span>], pinfo[<span class="number">1</span>] - pinfo[<span class="number">2</span>+index]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取要显示的图片的地址</span></span><br><span class="line">    logo_info-&gt;inaddr = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)logo_addr + pinfo[<span class="number">2</span>+index];</span><br><span class="line">    <span class="keyword">if</span> (MTK_LOG_ENABLE == <span class="number">1</span>) &#123;</span><br><span class="line">        SLOGD(<span class="string">&quot;show_animation_common, logo_addr=0x%08x , in_addr=0x%08x,  logolen=%d\n&quot;</span>,</span><br><span class="line">                    (<span class="keyword">unsigned</span> <span class="keyword">int</span>)logo_addr, logo_info-&gt;inaddr,  logo_info-&gt;logolen);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> CHECK_LOGO_BIN_OK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="13-get-total-logo-images-entries"><a href="#13-get-total-logo-images-entries" class="headerlink" title="13) get_total_logo_images_entries"></a>13) get_total_logo_images_entries</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_total_logo_images_entries</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> total_logo_entries = <span class="number">0</span>;</span><br><span class="line">    total_logo_entries = LOGOS_COUNT_NORMAL;</span><br><span class="line">    <span class="keyword">int</span> to_include_fast_charging = getValue(<span class="string">&quot;ro.vendor.mtk_pump_express_plus_support&quot;</span> , <span class="string">&quot;0&quot;</span>);</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    #if defined(MTK_PUMP_EXPRESS_SUPPORT) || defined(MTK_PUMP_EXPRESS_PLUS_SUPPORT) || defined(MTK_PUMP_EXPRESS_PLUS_20_SUPPORT)</span></span><br><span class="line"><span class="comment">        total_logo_entries += LOGOS_COUNT_FAST_CHARGING;</span></span><br><span class="line"><span class="comment">    #endif</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">if</span>(to_include_fast_charging == <span class="number">1</span>)</span><br><span class="line">    total_logo_entries += LOGOS_COUNT_FAST_CHARGING;</span><br><span class="line">  <span class="meta">#<span class="meta-keyword">if</span> defined(MTK_WIRELESS_CHARGER_SUPPORT)</span></span><br><span class="line">        total_logo_entries += LOGOS_COUNT_WIRELESS;</span><br><span class="line">  <span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">   SLOGD(<span class="string">&quot;[get_total_logo_images_entries: %s %d] total_logo_entries = %d to_include_fast_charging = %d\n&quot;</span>,__FUNCTION__,__LINE__, total_logo_entries , to_include_fast_charging);</span><br><span class="line">    <span class="keyword">return</span> total_logo_entries;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6、在屏上显示任意绘制点"><a href="#6、在屏上显示任意绘制点" class="headerlink" title="6、在屏上显示任意绘制点"></a>6、在屏上显示任意绘制点</h2><p>看了这个源码我就想我能不能自己在屏上画出点，于是捯饬了一下，整理得到下面的代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/fb.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/input.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// use for nmap framebuffer</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> *fb_addr = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> *lk_fb_addr = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> *charging_fb_addr = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> *kernel_fb_addr = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> v_width = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">fb_var_screeninfo</span> <span class="title">vinfo</span>;</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">fb_fix_screeninfo</span> <span class="title">finfo</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> fb_size = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> fb_fd = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清屏函数，将屏幕颜色设置为 color</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clearScreen</span> <span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *pfb, <span class="keyword">unsigned</span> <span class="keyword">int</span> width, <span class="keyword">unsigned</span> <span class="keyword">int</span> height, <span class="keyword">unsigned</span> <span class="keyword">int</span> color)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> x, y;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;draw_back, %p , %d, %d\n&quot;</span>,pfb , width, height);</span><br><span class="line">    <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; height; y++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; width; x++)</span><br><span class="line">        &#123;</span><br><span class="line">            *(pfb + y * width + x) = color;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制对应的点</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw_point</span><span class="params">(<span class="keyword">int</span> x ,<span class="keyword">int</span> y, <span class="keyword">int</span> color)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i  = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> j  = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;x: %d y: %d\n&quot;</span>,x,y);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(y &gt; <span class="number">2400</span>) <span class="comment">// 防止越界</span></span><br><span class="line">        y = <span class="number">2400</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(x &gt; <span class="number">1080</span>) <span class="comment">// 防止越界</span></span><br><span class="line">        x = <span class="number">1080</span>;</span><br><span class="line"></span><br><span class="line">    *(fb_addr + y * v_width + x) = color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以 x , y 为中心绘制10x10的小方块</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">drawCube</span> <span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> xmin = x<span class="number">-10</span>;</span><br><span class="line">    <span class="keyword">int</span> xmax = x+<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> ymin = y<span class="number">-10</span>;</span><br><span class="line">    <span class="keyword">int</span> ymax = y+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(xmin &lt; <span class="number">0</span>)</span><br><span class="line">        xmin = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(ymin &lt; <span class="number">0</span>)</span><br><span class="line">        ymin = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = ymin; i&lt; ymax; i++)</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="keyword">for</span>(j = xmin; j &lt; xmax; j++)</span><br><span class="line">       &#123;</span><br><span class="line">           draw_point(j,i,<span class="number">0xFF</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化 fb 相关信息</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">myFbInit</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//unsigned int color = 0;</span></span><br><span class="line">    fb_fd = open(<span class="string">&quot;/dev/graphics/fb0&quot;</span>, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span>(fb_fd &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;fb open err\n&quot;</span>);</span><br><span class="line">        close(fb_fd);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ioctl(fb_fd, FBIOGET_VSCREENINFO, &amp;vinfo);</span><br><span class="line">    ioctl(fb_fd, FBIOGET_FSCREENINFO, &amp;finfo);</span><br><span class="line"></span><br><span class="line">    fb_size  = finfo.line_length * vinfo.yres;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 映射对应的显存到用户空间</span></span><br><span class="line">    lk_fb_addr =(<span class="keyword">unsigned</span> <span class="keyword">int</span>*)mmap(<span class="number">0</span>, fb_size*<span class="number">3</span>, PROT_READ | PROT_WRITE, MAP_SHARED, fb_fd, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    charging_fb_addr = (<span class="keyword">unsigned</span> <span class="keyword">int</span>*)((<span class="keyword">unsigned</span> <span class="keyword">int</span>)lk_fb_addr + fb_size);</span><br><span class="line"></span><br><span class="line">    kernel_fb_addr = (<span class="keyword">unsigned</span> <span class="keyword">int</span>*)((<span class="keyword">unsigned</span> <span class="keyword">int</span>)charging_fb_addr + fb_size);</span><br><span class="line"></span><br><span class="line">    fb_addr = charging_fb_addr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算出显示区域的宽度</span></span><br><span class="line">    v_width = finfo.line_length/(vinfo.bits_per_pixel/<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 告诉内核刷新 fb</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fbShow</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (fb_addr == charging_fb_addr) &#123;</span><br><span class="line">        vinfo.yoffset = vinfo.yres;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fb_addr == kernel_fb_addr) &#123;</span><br><span class="line">        vinfo.yoffset = vinfo.yres * <span class="number">2</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        vinfo.yoffset = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    vinfo.activate |= (FB_ACTIVATE_FORCE | FB_ACTIVATE_NOW);</span><br><span class="line">    <span class="keyword">if</span> (ioctl(fb_fd, FBIOPUT_VSCREENINFO, &amp;vinfo) &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;ioctl FBIOPUT_VSCREENINFO flip failed\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    myFbInit();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 清屏</span></span><br><span class="line">    clearScreen(fb_addr, vinfo.xres, vinfo.yres, <span class="number">0xFF0000</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 在 300,300 处画个 10x10 小方块</span></span><br><span class="line">    drawCube(<span class="number">300</span>,<span class="number">300</span>,<span class="number">0xFF</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//刷新 fb 显示</span></span><br><span class="line">    fbShow();</span><br><span class="line"></span><br><span class="line">    munmap(lk_fb_addr, fb_size*<span class="number">2</span>); <span class="comment">// 释放映射的内存空间</span></span><br><span class="line">    close(fb_db);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个代码验证有问题，原因就是安卓也在刷图会将我的图刷掉，于是为了简单直接如下操作</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">primary_display_frame_cfg</span><span class="params">(struct <span class="keyword">disp_frame_cfg_t</span> *cfg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> ret; <span class="comment">// 啥也不干直接返回</span></span><br><span class="line"></span><br><span class="line">    s_info = disp_get_session_sync_info_for_debug(cfg-&gt;session_id);</span><br><span class="line">    <span class="keyword">if</span> (s_info) &#123;</span><br><span class="line">        input_event = &amp;s_info-&gt;event_setinput;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>于是再次验证就可以了。</p>
<h2 id="7、在屏幕上面绘制"><a href="#7、在屏幕上面绘制" class="headerlink" title="7、在屏幕上面绘制"></a>7、在屏幕上面绘制</h2><p>利用 input 子系统就可以在屏幕上面进行绘制</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ioctl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/fb.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;errno.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/epoll.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/input.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// use for nmap framebuffer</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> *fb_addr = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> *lk_fb_addr = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> *charging_fb_addr = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> *kernel_fb_addr = <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> v_width = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">fb_var_screeninfo</span> <span class="title">vinfo</span>;</span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">fb_fix_screeninfo</span> <span class="title">finfo</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> fb_size = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> fb_fd = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 清屏函数，将屏幕颜色设置为 color</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clearScreen</span> <span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> *pfb, <span class="keyword">unsigned</span> <span class="keyword">int</span> width, <span class="keyword">unsigned</span> <span class="keyword">int</span> height, <span class="keyword">unsigned</span> <span class="keyword">int</span> color)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> x, y;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;draw_back, %p , %d, %d\n&quot;</span>,pfb , width, height);</span><br><span class="line">    <span class="keyword">for</span> (y = <span class="number">0</span>; y &lt; height; y++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (x = <span class="number">0</span>; x &lt; width; x++)</span><br><span class="line">        &#123;</span><br><span class="line">            *(pfb + y * width + x) = color;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绘制对应的点</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">draw_point</span><span class="params">(<span class="keyword">int</span> x ,<span class="keyword">int</span> y, <span class="keyword">int</span> color)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i  = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> j  = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;x: %d y: %d\n&quot;</span>,x,y);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(y &gt; <span class="number">2400</span>) <span class="comment">// 防止越界</span></span><br><span class="line">        y = <span class="number">2400</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(x &gt; <span class="number">1080</span>) <span class="comment">// 防止越界</span></span><br><span class="line">        x = <span class="number">1080</span>;</span><br><span class="line"></span><br><span class="line">    *(fb_addr + y * v_width + x) = color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以 x , y 为中心绘制10x10的小方块</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">drawCube</span> <span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> xmin = x<span class="number">-10</span>;</span><br><span class="line">    <span class="keyword">int</span> xmax = x+<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> ymin = y<span class="number">-10</span>;</span><br><span class="line">    <span class="keyword">int</span> ymax = y+<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(xmin &lt; <span class="number">0</span>)</span><br><span class="line">        xmin = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(ymin &lt; <span class="number">0</span>)</span><br><span class="line">        ymin = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(i = ymin; i&lt; ymax; i++)</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="keyword">for</span>(j = xmin; j &lt; xmax; j++)</span><br><span class="line">       &#123;</span><br><span class="line">           draw_point(j,i,<span class="number">0xFF</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化 fb 相关信息</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">myFbInit</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//unsigned int color = 0;</span></span><br><span class="line">    fb_fd = open(<span class="string">&quot;/dev/graphics/fb0&quot;</span>, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span>(fb_fd &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;fb open err\n&quot;</span>);</span><br><span class="line">        close(fb_fd);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ioctl(fb_fd, FBIOGET_VSCREENINFO, &amp;vinfo);</span><br><span class="line">    ioctl(fb_fd, FBIOGET_FSCREENINFO, &amp;finfo);</span><br><span class="line"></span><br><span class="line">    fb_size  = finfo.line_length * vinfo.yres;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 映射对应的显存到用户空间</span></span><br><span class="line">    lk_fb_addr =(<span class="keyword">unsigned</span> <span class="keyword">int</span>*)mmap(<span class="number">0</span>, fb_size*<span class="number">3</span>, PROT_READ | PROT_WRITE, MAP_SHARED, fb_fd, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    charging_fb_addr = (<span class="keyword">unsigned</span> <span class="keyword">int</span>*)((<span class="keyword">unsigned</span> <span class="keyword">int</span>)lk_fb_addr + fb_size);</span><br><span class="line"></span><br><span class="line">    kernel_fb_addr = (<span class="keyword">unsigned</span> <span class="keyword">int</span>*)((<span class="keyword">unsigned</span> <span class="keyword">int</span>)charging_fb_addr + fb_size);</span><br><span class="line"></span><br><span class="line">    fb_addr = charging_fb_addr;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 计算出显示区域的宽度</span></span><br><span class="line">    v_width = finfo.line_length/(vinfo.bits_per_pixel/<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 告诉内核刷新 fb</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">fbShow</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (fb_addr == charging_fb_addr) &#123;</span><br><span class="line">        vinfo.yoffset = vinfo.yres;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fb_addr == kernel_fb_addr) &#123;</span><br><span class="line">        vinfo.yoffset = vinfo.yres * <span class="number">2</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        vinfo.yoffset = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    vinfo.activate |= (FB_ACTIVATE_FORCE | FB_ACTIVATE_NOW);</span><br><span class="line">    <span class="keyword">if</span> (ioctl(fb_fd, FBIOPUT_VSCREENINFO, &amp;vinfo) &lt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;ioctl FBIOPUT_VSCREENINFO flip failed\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">input_event</span> <span class="title">ev</span>;</span></span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">80</span>];</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> y = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    myFbInit();</span><br><span class="line">    clearScreen(fb_addr, vinfo.xres, vinfo.yres, <span class="number">0xFF0000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打开设备</span></span><br><span class="line">    fd = open(<span class="string">&quot;/dev/input/event5&quot;</span>, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span>(fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;open err\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ioctl(fd, EVIOCGNAME(<span class="keyword">sizeof</span>(name) - <span class="number">1</span>), name);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;find device name = %s\n&quot;</span>, name);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 循环读取</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// 读取数据</span></span><br><span class="line">        read(fd, &amp;ev, <span class="keyword">sizeof</span>(struct input_event));</span><br><span class="line">        <span class="comment">// 打印当前触发类型</span></span><br><span class="line">       <span class="comment">// printf(&quot;ev ==  %x \n&quot;,ev.type );</span></span><br><span class="line">        <span class="keyword">switch</span>(ev.type) &#123;</span><br><span class="line">        <span class="keyword">case</span> EV_SYN:</span><br><span class="line">         <span class="comment">//   printf(&quot;-------------------------\n&quot;);</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;do x: %d, y: %d\n&quot;</span>,x,y);</span><br><span class="line">            drawCube(x,y);</span><br><span class="line">            fbShow();</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 按键</span></span><br><span class="line">        <span class="keyword">case</span> EV_KEY:</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;key down / up: %d \n&quot;</span>,ev.code );</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 鼠标</span></span><br><span class="line">        <span class="keyword">case</span> EV_REL:</span><br><span class="line">          <span class="comment">//  printf(&quot;mouse: &quot;);</span></span><br><span class="line">            <span class="keyword">if</span> (ev.code == REL_X) &#123;</span><br><span class="line">              <span class="comment">// printf(&quot; x -- %d\n&quot;, ev.value);</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ev.code == REL_Y) &#123;</span><br><span class="line">              <span class="comment">// printf(&quot; y -- %d\n&quot;, ev.value);</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 触摸屏</span></span><br><span class="line">        <span class="keyword">case</span> EV_ABS:</span><br><span class="line">            <span class="comment">//printf(&quot;ts: &quot;);</span></span><br><span class="line">            <span class="keyword">if</span>(ev.code == ABS_MT_POSITION_X) &#123;</span><br><span class="line">                <span class="comment">//printf(&quot; x -- %d\n&quot;, ev.value);</span></span><br><span class="line">                x = ev.value;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ev.code == ABS_MT_POSITION_Y) &#123;</span><br><span class="line">                <span class="comment">// printf(&quot; y -- %d\n&quot;, ev.value);</span></span><br><span class="line">                y = ev.value;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (ev.code == ABS_PRESSURE) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot; pressure: %d\n&quot;</span>, ev.value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    munmap(lk_fb_addr, fb_size*<span class="number">2</span>); <span class="comment">// 释放映射的内存空间</span></span><br><span class="line"></span><br><span class="line">    close(fd);</span><br><span class="line">    close(fb_fd);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>于是就可以在屏上画图了</p>
<img src="https://myblog-1258129986.cos.ap-chengdu.myqcloud.com/linux%E9%A9%B1%E5%8A%A8/mtk-logo/%E7%94%BB%E5%9B%BE.jpg?q-sign-algorithm=sha1&q-ak=AKIDhKF3mfZXf8SeirDbHrMiLZbzDlsoqM1W&q-sign-time=1626260415;10266174015&q-key-time=1626260415;10266174015&q-header-list=&q-url-param-list=&q-signature=6a279df81113702caddbff933964042f587ac202" >

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>braon-z
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://example.com/2021/07/03/mtk%E5%B9%B3%E5%8F%B0-lcd%E6%98%BE%E7%A4%BA%E6%8E%A5%E5%8F%A3/" title="番外篇-mtk平台logo显示接口">https://example.com/2021/07/03/mtk平台-lcd显示接口/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/mtk/" rel="tag"><i class="fa fa-tag"></i> mtk</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/06/16/%E9%A1%B9%E7%9B%AE%E6%9D%82%E8%AE%B0/" rel="prev" title="linux驱动-项目杂记">
                  <i class="fa fa-chevron-left"></i> linux驱动-项目杂记
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">braon-z</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">427k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">6:28</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





<script>
NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({"enable":true,"appId":"VsC1eQwQ4Xltm5eA9iYGp3VU-gzGzoHsz","appKey":"kyfyE4RWl6aIojedbxcuJa3V","serverURLs":null,"placeholder":"Just go go","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":false,"comment_count":true,"recordIP":false,"enableQQ":false,"requiredFields":[]}, {
      el: '#valine-comments',
      path: "/2021/07/03/mtk%E5%B9%B3%E5%8F%B0-lcd%E6%98%BE%E7%A4%BA%E6%8E%A5%E5%8F%A3/",
      serverURLs: "https://vsc1eqwq.api.lncldglobal.com"
    }));
  }, window.Valine);
});
</script>




  <script src="/js/activate-power-mode.min.js"></script>
  <script>
    POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);
  </script>
<div class="moon-menu">
  <div class="moon-menu-items">
    
    <div class="moon-menu-item" onclick="back2bottom()">
      <i class='fa fa-chevron-down'></i>    </div>
    
    <div class="moon-menu-item" onclick="back2top()">
      <i class='fa fa-chevron-up'></i>    </div>
    
  </div>
  <div class="moon-menu-button">
    <svg class="moon-menu-bg">
      <circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle>
      <circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle>
    </svg>
    <div class="moon-menu-content">
      <div class="moon-menu-icon"><i class='fas fa-ellipsis-v'></i></div>
      <div class="moon-menu-text"></div>
    </div>
  </div>
</div><script src="/js/injector.js"></script>
</body>
</html>

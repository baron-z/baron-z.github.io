<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","version":"8.1.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":"ture","mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}};
  </script>
<meta name="description" content="记录makefile基本知识">
<meta property="og:type" content="article">
<meta property="og:title" content="makefile专题">
<meta property="og:url" content="https://example.com/2021/01/18/makfile%E4%B8%93%E9%A2%98/index.html">
<meta property="og:site_name" content="braon-z&#39;s blog">
<meta property="og:description" content="记录makefile基本知识">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/1.png">
<meta property="og:image" content="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/2.png">
<meta property="og:image" content="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/11.jpg">
<meta property="og:image" content="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/3.png">
<meta property="og:image" content="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/4.png">
<meta property="og:image" content="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/5.png">
<meta property="og:image" content="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/6.png">
<meta property="og:image" content="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/7.jpg">
<meta property="og:image" content="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/8.jpg">
<meta property="og:image" content="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/9.jpg">
<meta property="og:image" content="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/10.jpg">
<meta property="article:published_time" content="2021-01-18T01:21:23.619Z">
<meta property="article:modified_time" content="2020-01-06T14:40:23.950Z">
<meta property="article:author" content="braon-z">
<meta property="article:tag" content="基础知识">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/1.png">


<link rel="canonical" href="https://example.com/2021/01/18/makfile%E4%B8%93%E9%A2%98/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<title>makefile专题 | braon-z's blog</title>
  




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">braon-z's blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%80%E3%80%81make-%E5%92%8C-makefile"><span class="nav-text">一、make 和 makefile</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-make%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F"><span class="nav-text">1. make是一个应用程序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-makefile%E7%9A%84%E6%9C%AC%E8%B4%A8"><span class="nav-text">2. makefile的本质</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-make%E5%92%8Cmakefile%E4%B9%8B%E9%97%B4%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-text">3. make和makefile之间的关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84makefle"><span class="nav-text">4. 最简单的makefle</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84makefile%E7%A8%8B%E5%BA%8F"><span class="nav-text">1）最简单的makefile程序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E8%BF%90%E8%A1%8Cmakefile"><span class="nav-text">2）运行makefile</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%88%9D%E8%AF%86makefile%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-text">二、初识makefile的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-makefile%E7%9A%84%E6%84%8F%E4%B9%89"><span class="nav-text">1. makefile的意义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E4%BE%9D%E8%B5%96%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-text">2. 依赖的定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Makefile%E4%B8%AD%E7%9A%84%E5%85%83%E7%B4%A0%E5%90%AB%E4%B9%89"><span class="nav-text">3. Makefile中的元素含义</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89targets"><span class="nav-text">1）targets</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89prerequisite"><span class="nav-text">2）prerequisite</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%BC%89command"><span class="nav-text">3）command</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%EF%BC%89%E8%A7%84%E5%88%99%E4%B8%AD%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-text">4）规则中的注意事项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-makefile%E4%BE%9D%E8%B5%96%E7%A4%BA%E4%BE%8B"><span class="nav-text">3. makefile依赖示例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E4%BE%9D%E8%B5%96%E8%A7%84%E5%88%99"><span class="nav-text">4. 依赖规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E7%AC%AC%E4%B8%80%E4%B8%AAmake%E7%9A%84%E7%BC%96%E8%AF%91%E6%A1%88%E4%BE%8B"><span class="nav-text">5. 第一个make的编译案例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E4%BC%AA%E7%9B%AE%E6%A0%87%E7%9A%84%E5%BC%95%E5%85%A5"><span class="nav-text">三、伪目标的引入</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-makefile%E4%B8%AD%E7%9B%AE%E6%A0%87%E7%9A%84%E5%90%AB%E4%B9%89"><span class="nav-text">1. makefile中目标的含义</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89%E9%BB%98%E8%AE%A4%E6%83%85%E5%86%B5%E4%B8%8B"><span class="nav-text">1）默认情况下</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89makefile%E4%B8%AD%E7%9A%84%E4%BC%AA%E7%9B%AE%E6%A0%87"><span class="nav-text">2）makefile中的伪目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%BC%89%E4%BC%AA%E7%9B%AE%E6%A0%87%E7%9A%84%E8%AF%AD%E6%B3%95"><span class="nav-text">3）伪目标的语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E4%BC%AA%E7%9B%AE%E6%A0%87%E7%9A%84%E6%9C%AC%E8%B4%A8"><span class="nav-text">4) 伪目标的本质</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E7%BB%95%E5%BC%80-PHONY%E5%85%B3%E9%94%AE%E5%AD%97%E5%AE%9A%E4%B9%89%E4%BC%AA%E7%9B%AE%E6%A0%87"><span class="nav-text">2. 绕开.PHONY关键字定义伪目标</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%8F%98%E9%87%8F%E5%92%8C%E4%B8%8D%E5%90%8C%E7%9A%84%E8%B5%8B%E5%80%BC%E6%96%B9%E5%BC%8F"><span class="nav-text">四、变量和不同的赋值方式</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-makefile%E4%B8%AD%E7%9A%84%E5%8F%98%E9%87%8F"><span class="nav-text">1. makefile中的变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-makefile%E4%B8%AD%E5%8F%98%E9%87%8F%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99"><span class="nav-text">2. makefile中变量命名规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-makefile%E4%B8%AD%E5%8F%98%E9%87%8F%E7%9A%84%E8%B5%8B%E5%80%BC%E6%96%B9%E5%BC%8F"><span class="nav-text">3. makefile中变量的赋值方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%AE%80%E5%8D%95%E8%B5%8B%E5%80%BC"><span class="nav-text">1)    简单赋值 :&#x3D;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%80%92%E5%BD%92%E8%B5%8B%E5%80%BC"><span class="nav-text">2)    递归赋值 &#x3D;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%9D%A1%E4%BB%B6%E8%B5%8B%E5%80%BC"><span class="nav-text">3) 条件赋值 ?&#x3D;</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E8%BF%BD%E5%8A%A0%E8%B5%8B%E5%80%BC"><span class="nav-text">4) 追加赋值 +&#x3D;</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E9%A2%84%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">五、预定义变量的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E8%87%AA%E5%8A%A8%E5%8F%98%E9%87%8F"><span class="nav-text">1. 自动变量</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%87%AA%E5%8A%A8%E5%8F%98%E9%87%8F%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text">2. 自动变量的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E7%89%B9%E6%AE%8A%E5%8F%98%E9%87%8F"><span class="nav-text">2. 特殊变量</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%8F%98%E9%87%8F%E7%9A%84%E9%AB%98%E7%BA%A7%E4%B8%BB%E9%A2%98"><span class="nav-text">六、变量的高级主题</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%B8%B8%E7%94%A8%E8%AF%AD%E6%B3%95"><span class="nav-text">1. 常用语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89-%E5%8F%98%E9%87%8F%E5%80%BC%E7%9A%84%E6%9B%BF%E6%8D%A2"><span class="nav-text">1） 变量值的替换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E5%8F%98%E9%87%8F%E7%9A%84%E6%A8%A1%E5%BC%8F%E6%9B%BF%E6%8D%A2"><span class="nav-text">2）变量的模式替换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%BC%89%E8%A7%84%E5%88%99%E4%B8%AD%E7%9A%84%E6%A8%A1%E5%BC%8F%E6%9B%BF%E6%8D%A2"><span class="nav-text">3）规则中的模式替换</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a%EF%BC%89%E7%9B%B4%E6%8E%A5%E6%A8%A1%E5%BC%8F%E6%9B%BF%E6%8D%A2%EF%BC%88%E8%87%AA%E5%B7%B1%E8%B5%B7%E7%9A%84%E5%90%8D%E5%AD%97%EF%BC%89"><span class="nav-text">a）直接模式替换（自己起的名字）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b%EF%BC%89%E9%97%B4%E6%8E%A5%E6%A8%A1%E5%BC%8F%E6%9B%BF%E6%8D%A2%EF%BC%88%E8%87%AA%E5%B7%B1%E8%B5%B7%E7%9A%84%E5%90%8D%E5%AD%97%EF%BC%89"><span class="nav-text">b）间接模式替换（自己起的名字）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%EF%BC%89%E5%8F%98%E9%87%8F%E5%80%BC%E7%9A%84%E5%B5%8C%E5%A5%97%E5%BC%95%E7%94%A8"><span class="nav-text">4）变量值的嵌套引用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5%EF%BC%89%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%98%E9%87%8F"><span class="nav-text">5）命令行变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6%EF%BC%89override%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">6）override关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7%EF%BC%89define%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">7）define关键字</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%EF%BC%88%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F%EF%BC%89"><span class="nav-text">2. 环境变量（全局变量）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E7%9B%AE%E6%A0%87%E5%8F%98%E9%87%8F%EF%BC%88%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%EF%BC%89"><span class="nav-text">3. 目标变量（局部变量）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%A8%A1%E5%BC%8F%E5%8F%98%E9%87%8F%EF%BC%88%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%EF%BC%89"><span class="nav-text">4. 模式变量（局部变量）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%8F%98%E9%87%8F%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%9A%84makefile%E4%B8%AD%E7%9A%84%E4%BC%A0%E9%80%92%E6%96%B9%E5%BC%8F"><span class="nav-text">3. 变量在不同的makefile中的传递方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5"><span class="nav-text">七、条件判断语句</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-makefile%E4%B8%AD%E7%9A%84%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5"><span class="nav-text">1. makefile中的条件判断语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%A1%A8%E7%8E%B0%E5%BD%A2%E5%BC%8F"><span class="nav-text">2. 表现形式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">3. 条件判断关键字</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%B7%A5%E7%A8%8B%E4%BD%BF%E7%94%A8%E5%B0%8F%E7%BB%93"><span class="nav-text">4. 工程使用小结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E4%B8%BE%E4%BE%8B%E8%AF%B4%E6%98%8E"><span class="nav-text">5.举例说明</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E5%85%B3%E9%94%AE%E5%AD%97%E7%A8%8B%E5%BA%8F%E5%AE%9E%E4%BE%8B"><span class="nav-text">1）条件判断关键字程序实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E5%85%B3%E9%94%AE%E5%AD%97%E5%BC%82%E5%B8%B8%E5%88%86%E6%9E%90"><span class="nav-text">2）条件判断关键字异常分析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a%EF%BC%89%E5%BC%82%E5%B8%B8%E6%83%85%E5%86%B51"><span class="nav-text">a）异常情况1</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b%EF%BC%89%E5%BC%82%E5%B8%B8%E6%83%85%E5%86%B52"><span class="nav-text">b）异常情况2</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#c%EF%BC%89%E5%BC%82%E5%B8%B8%E6%83%85%E5%86%B53"><span class="nav-text">c）异常情况3</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E5%87%BD%E6%95%B0%E7%9A%84%E5%AE%9A%E4%B9%89%E4%BB%A5%E5%8F%8A%E8%B0%83%E7%94%A8"><span class="nav-text">八、函数的定义以及调用</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-makefile%E6%94%AF%E6%8C%81%E5%87%BD%E6%95%B0%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-text">1. makefile支持函数的概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0%E8%AF%AD%E6%B3%95"><span class="nav-text">2. 自定义函数语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="nav-text">3. 深入理解自定义函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%AE%9E%E4%BE%8B%E5%88%86%E6%9E%90"><span class="nav-text">4. 实例分析</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%B9%9D%E3%80%81%E5%8F%98%E9%87%8F%E4%B8%8E%E5%87%BD%E6%95%B0%E7%9A%84%E7%BB%BC%E5%90%88%E7%A4%BA%E4%BE%8B"><span class="nav-text">九、变量与函数的综合示例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%AE%9E%E6%88%98%E9%9C%80%E6%B1%82"><span class="nav-text">1. 实战需求</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%B7%A5%E5%85%B7%E5%8E%9F%E6%96%99"><span class="nav-text">2. 工具原料</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%85%B3%E9%94%AE%E6%8A%80%E5%B7%A7"><span class="nav-text">3. 关键技巧</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E7%BC%96%E8%AF%91%E8%A7%84%E5%88%99%E7%9A%84%E4%BE%9D%E8%B5%96"><span class="nav-text">4. 编译规则的依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-text">5. 编程实现</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%81%E3%80%81sed%E6%B5%81%E7%BC%96%E8%BE%91%E5%99%A8"><span class="nav-text">十、sed流编辑器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Linux%E4%B8%AD%E7%9A%84sed%E5%91%BD%E4%BB%A4"><span class="nav-text">1. Linux中的sed命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-sed%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%9B%BF%E6%8D%A2%E5%AE%9E%E4%BE%8B"><span class="nav-text">2. sed字符串替换实例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-sed%E6%94%AF%E6%8C%81%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-text">3. sed支持正则表达式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%81%E4%B8%80%E3%80%81makefile%E5%B0%8F%E7%9F%A5%E8%AF%86"><span class="nav-text">十一、makefile小知识</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E7%94%9F%E6%88%90%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB"><span class="nav-text">1. 生成依赖关系</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%8B%86%E5%88%86%E7%9B%AE%E6%A0%87%E7%9A%84%E4%BE%9D%E8%B5%96"><span class="nav-text">2. 拆分目标的依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-make%E4%B8%AD%E7%9A%84%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6"><span class="nav-text">3. make中的命令执行机制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-makefile%E4%B8%AD%E5%B5%8C%E5%85%A5shell%E7%9A%84for%E5%BE%AA%E7%8E%AF"><span class="nav-text">4. makefile中嵌入shell的for循环</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99"><span class="nav-text">1）语法规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E7%BC%96%E7%A8%8B%E5%AE%9E%E9%AA%8C"><span class="nav-text">2）编程实验</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81makefile%E4%B8%AD%E7%9A%84include%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">十二、makefile中的include关键字</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-makefile%E5%AF%B9include%E5%85%B3%E9%94%AE%E5%AD%97%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-text">1. makefile对include关键字的处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89%E6%90%9C%E7%B4%A2%E6%88%90%E5%8A%9F"><span class="nav-text">1）搜索成功</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E7%A8%8B%E5%AE%9E%E9%AA%8C"><span class="nav-text">编程实验</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E6%90%9C%E7%B4%A2%E5%A4%B1%E8%B4%A5"><span class="nav-text">2）搜索失败</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#a%EF%BC%89%E8%A7%84%E5%88%99%E5%AD%98%E5%9C%A8"><span class="nav-text">a）规则存在</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#b%EF%BC%89%E8%A7%84%E5%88%99%E4%B8%8D%E5%AD%98%E5%9C%A8"><span class="nav-text">b）规则不存在</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-include%E5%85%B3%E9%94%AE%E5%AD%97%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93"><span class="nav-text">2. include关键字使用总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89%E5%BD%93%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6%E4%B8%8D%E5%AD%98%E5%9C%A8"><span class="nav-text">1）当目标文件不存在</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E5%BD%93%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6%E5%AD%98%E5%9C%A8"><span class="nav-text">2）当目标文件存在</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%81%E4%B8%89%E3%80%81%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB"><span class="nav-text">十三、自动生成依赖关系</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E7%BC%96%E8%AF%91%E8%A1%8C%E4%B8%BA%E5%B8%A6%E6%9D%A5%E7%9A%84%E7%BC%BA%E9%99%B7"><span class="nav-text">1. 编译行为带来的缺陷</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%AE%9E%E9%AA%8C%E4%B8%AD%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E4%B8%8E%E9%97%AE%E9%A2%98"><span class="nav-text">2. 实验中解决方案与问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%80%9D%E8%80%83%E6%98%AF%E5%90%A6%E5%8F%AF%E4%BB%A5%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E4%BE%9D%E8%B5%96%E8%A7%A3%E5%86%B3"><span class="nav-text">3.思考是否可以自动生成依赖解决</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90-dep%E4%BE%9D%E8%B5%96%E6%96%87%E4%BB%B6"><span class="nav-text">4. 自动生成.dep依赖文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89%E5%BE%97%E5%88%B0%E4%BE%9D%E8%B5%96%E6%96%87%E4%BB%B6"><span class="nav-text">1）得到依赖文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E4%BE%9D%E8%B5%96%E6%96%87%E4%BB%B6"><span class="nav-text">2）自动生成依赖文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%BC%89%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-text">3）编程实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E9%9B%86%E4%B8%AD%E7%AE%A1%E7%90%86-dep%E6%96%87%E4%BB%B6"><span class="nav-text">5. 集中管理.dep文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89%E5%BD%93include%E5%8F%91%E7%8E%B0-dep%E6%96%87%E4%BB%B6%E4%B8%8D%E5%AD%98%E5%9C%A8"><span class="nav-text">1）当include发现.dep文件不存在</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="nav-text">2）编程实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%BC%89%E4%B8%80%E4%BA%9B-dep%E6%96%87%E4%BB%B6%E4%BC%9A%E8%A2%AB%E9%87%8D%E5%A4%8D%E5%88%9B%E5%BB%BA%E5%A4%9A%E6%AC%A1"><span class="nav-text">3）一些.dep文件会被重复创建多次</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E4%BE%9D%E8%B5%96%E7%9A%84%E6%9C%80%E7%BB%88%E5%AE%9E%E7%8E%B0"><span class="nav-text">6. 自动生成依赖的最终实现</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%81%E5%9B%9B%E3%80%81make%E7%9A%84%E9%9A%90%E5%BC%8F%E8%A7%84%E5%88%99"><span class="nav-text">十四、make的隐式规则</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-makfile%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%90%8C%E5%90%8D%E7%9B%AE%E6%A0%87%E6%97%B6"><span class="nav-text">1. makfile中出现同名目标时</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E9%9A%90%E5%BC%8F%E8%A7%84%E5%88%99"><span class="nav-text">2. 隐式规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E9%9A%90%E5%BC%8F%E8%A7%84%E5%88%99%E7%9A%84%E5%89%AF%E4%BD%9C%E7%94%A8"><span class="nav-text">3. 隐式规则的副作用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E6%9F%A5%E7%9C%8B%E9%9A%90%E5%BC%8F%E8%A7%84%E5%88%99"><span class="nav-text">4. 查看隐式规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E9%9A%90%E5%BC%8F%E8%A7%84%E5%88%99%E7%9A%84%E7%A6%81%E7%94%A8"><span class="nav-text">5. 隐式规则的禁用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E5%90%8E%E7%BC%80%E8%A7%84%E5%88%99"><span class="nav-text">6. 后缀规则</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89%E5%90%8E%E7%BC%80%E8%A7%84%E5%88%99%E7%AE%80%E4%BB%8B"><span class="nav-text">1）后缀规则简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E5%8F%8C%E5%90%8E%E7%BC%80%E8%A7%84%E5%88%99"><span class="nav-text">2）双后缀规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%BC%89%E5%8D%95%E5%90%8E%E7%BC%80%E8%A7%84%E5%88%99"><span class="nav-text">3）单后缀规则</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E5%90%8E%E7%BC%80%E8%A7%84%E5%88%99%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-text">7. 后缀规则注意事项</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%81%E4%BA%94%E3%80%81makefile%E4%B8%AD%E7%9A%84%E8%B7%AF%E5%BE%84%E6%90%9C%E7%B4%A2"><span class="nav-text">十五、makefile中的路径搜索</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E7%89%B9%E6%AE%8A%E7%9A%84%E9%A2%84%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8FVPATH%EF%BC%88%E5%85%A8%E5%A4%A7%E5%86%99%EF%BC%89"><span class="nav-text">1. 特殊的预定义变量VPATH（全大写）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89VPATH%E8%AF%B4%E6%98%8E"><span class="nav-text">1）VPATH说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89make%E5%AF%B9%E4%BA%8EVAPATH%E5%80%BC%E5%BE%97%E5%A4%84%E7%90%86%E6%96%B9%E5%BC%8F"><span class="nav-text">2）make对于VAPATH值得处理方式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%BC%89VAPATH%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="nav-text">3）VAPATH使用实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-vapath%E5%85%B3%E9%94%AE%E5%AD%97%EF%BC%88%E5%85%A8%E5%B0%8F%E5%86%99%EF%BC%89"><span class="nav-text">2. vapath关键字（全小写）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%8F%96%E6%B6%88%E6%90%9C%E7%B4%A2%E8%A7%84%E5%88%99"><span class="nav-text">3. 取消搜索规则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="nav-text">4. 问题分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-1"><span class="nav-text">1) 常见问题 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-2"><span class="nav-text">2）常见问题 2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%BC%89%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-3"><span class="nav-text">3）常见问题 3</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%B7%A5%E7%A8%8B%E5%BB%BA%E8%AE%AE"><span class="nav-text">5.工程建议</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%81%E5%85%AD%E3%80%81%E8%B7%AF%E5%BE%84%E6%90%9C%E7%B4%A2%E7%9A%84%E7%BB%BC%E5%90%88%E7%A4%BA%E4%BE%8B"><span class="nav-text">十六、路径搜索的综合示例</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E9%9C%80%E6%B1%82%E5%88%86%E6%9E%90"><span class="nav-text">1. 需求分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E9%A1%B9%E7%9B%AE%E7%B1%BB%E5%9E%8B%E5%88%86%E6%9E%90"><span class="nav-text">2. 项目类型分析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%B7%A5%E5%85%B7%E5%8E%9F%E6%96%99"><span class="nav-text">3. 工具原料</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%85%B3%E9%94%AE%E6%8A%80%E5%B7%A7"><span class="nav-text">4. 关键技巧</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0-1"><span class="nav-text">5.编程实现</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8D%81%E4%B8%83%E3%80%81%E6%89%93%E9%80%A0%E4%B8%93%E4%B8%9A%E7%9A%84%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83"><span class="nav-text">十七、打造专业的编译环境</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%A4%A7%E5%9E%8B%E9%A1%B9%E7%9B%AE%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84-%E6%97%A0%E7%AC%AC%E4%B8%89%E5%BA%93"><span class="nav-text">1. 大型项目目录结构(无第三库)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E9%9C%80%E8%A6%81%E6%89%93%E9%80%A0%E7%9A%84%E7%BC%96%E8%AF%91%E7%8E%AF%E5%A2%83"><span class="nav-text">2. 需要打造的编译环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E5%88%86%E6%9E%90"><span class="nav-text">3. 项目架构设计分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89%E9%A1%B9%E7%9B%AE%E8%A2%AB%E5%88%92%E5%88%86%E4%B8%BA%E5%A4%9A%E4%B8%AA%E4%B8%8D%E5%90%8C%E6%A8%A1%E5%9D%97"><span class="nav-text">1）项目被划分为多个不同模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E5%AE%9E%E7%8E%B0%E9%98%B6%E6%AE%B5%E5%88%86%E6%9E%90"><span class="nav-text">2）实现阶段分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-Compile%E9%98%B6%E6%AE%B5%E5%AE%9E%E7%8E%B0"><span class="nav-text">4. Compile阶段实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89%E5%85%B3%E9%94%AE%E7%9A%84%E5%AE%9E%E7%8E%B0%E8%A6%81%E7%82%B9"><span class="nav-text">1）关键的实现要点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E6%A8%A1%E5%9D%97%E4%B8%AD%E7%9A%84makefile%E6%9E%84%E6%88%90"><span class="nav-text">2）模块中的makefile构成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%BC%89%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0-1"><span class="nav-text">3）编程实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Link%E9%98%B6%E6%AE%B5%E5%AE%9E%E7%8E%B0"><span class="nav-text">5. Link阶段实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89%E5%BC%80%E5%8F%91%E4%B8%AD%E7%9A%84%E7%BB%8F%E9%AA%8C%E5%81%87%E8%AE%BE"><span class="nav-text">1）开发中的经验假设</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E8%AE%BE%E8%AE%A1%E6%80%9D%E8%B7%AF"><span class="nav-text">2）设计思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%BC%89%E7%BC%96%E7%A8%8B%E5%AE%9E%E7%8E%B0-2"><span class="nav-text">3）编程实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E4%B8%8A%E8%BF%B0makefile%E5%AD%98%E5%9C%A8%E6%BD%9C%E5%9C%A8%E9%97%AE%E9%A2%98"><span class="nav-text">6. 上述makefile存在潜在问题</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%EF%BC%89%E9%97%AE%E9%A2%98-1"><span class="nav-text">1）问题 1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%EF%BC%89%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-text">2）解决方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%EF%BC%89%E9%97%AE%E9%A2%98-2"><span class="nav-text">3）问题 2</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%AA%E5%AE%8C%E5%BE%85%E7%BB%AD%EF%BC%81%EF%BC%81%EF%BC%81"><span class="nav-text">未完待续！！！</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="braon-z"
      src="/images/wallhaven.jfif">
  <p class="site-author-name" itemprop="name">braon-z</p>
  <div class="site-description" itemprop="description"> 爱一个人，攀一座山，追一次梦<br>不妨大胆一点，有很多事没有答案</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">8</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/yourname" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;yourname" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:yourname@gmail.com" title="E-Mail → mailto:yourname@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


<div style="">
  <canvas id="canvas" style="width:60%;">当前浏览器不支持canvas，请更换浏览器后再试</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();
</script>
        </div>
      </div>
        <div class="back-to-top animated" role="button">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://example.com/2021/01/18/makfile%E4%B8%93%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/wallhaven.jfif">
      <meta itemprop="name" content="braon-z">
      <meta itemprop="description" content=" 爱一个人，攀一座山，追一次梦<br>不妨大胆一点，有很多事没有答案">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="braon-z's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          makefile专题
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-01-18 09:21:23" itemprop="dateCreated datePublished" datetime="2021-01-18T09:21:23+08:00">2021-01-18</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-01-06 22:40:23" itemprop="dateModified" datetime="2020-01-06T22:40:23+08:00">2020-01-06</time>
      </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
    <span class="post-meta-item-icon">
      <i class="far fa-comment"></i>
    </span>
    <span class="post-meta-item-text">Valine：</span>
  
    <a title="valine" href="/2021/01/18/makfile%E4%B8%93%E9%A2%98/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2021/01/18/makfile%E4%B8%93%E9%A2%98/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
      </div>
      <div class="post-meta">
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>21k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>19 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>记录makefile基本知识</p>
<a id="more"></a>
<h1 id="一、make-和-makefile"><a href="#一、make-和-makefile" class="headerlink" title="一、make 和 makefile"></a><div align=center>一、make 和 makefile</h1><h2 id="1-make是一个应用程序"><a href="#1-make是一个应用程序" class="headerlink" title="1. make是一个应用程序"></a>1. make是一个应用程序</h2><ul>
<li><strong>解析源程序之间的依赖关系</strong></li>
<li><strong>根据依赖关系自动维护编译工作</strong></li>
<li><strong>执行宿主操作系统中的各种命令</strong><h2 id="2-makefile的本质"><a href="#2-makefile的本质" class="headerlink" title="2. makefile的本质"></a>2. makefile的本质</h2></li>
<li><strong>makefile是一个描述文件</strong></li>
<li><strong>makefile可以定义一系列的规则来指定源文件编译的先后顺序</strong></li>
<li><strong>makefile拥有特定的语法规则，支持函数定义和函数调用</strong></li>
<li><strong>makefile能够直接集成操作系统中的各种命令</strong><h2 id="3-make和makefile之间的关系"><a href="#3-make和makefile之间的关系" class="headerlink" title="3. make和makefile之间的关系"></a>3. make和makefile之间的关系</h2></li>
<li><strong>makefile中的描述用于指导make如何完成工作</strong></li>
<li><strong>make根据makefile中的规则执行命令，最后完成编译输出</strong><h2 id="4-最简单的makefle"><a href="#4-最简单的makefle" class="headerlink" title="4. 最简单的makefle"></a>4. 最简单的makefle</h2><h3 id="1）最简单的makefile程序"><a href="#1）最简单的makefile程序" class="headerlink" title="1）最简单的makefile程序"></a>1）最简单的makefile程序</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hello </span>: </span><br><span class="line">	<span class="variable">@echo</span> “hello makefile”</span><br></pre></td></tr></table></figure>
程序说明：<br>&nbsp; &nbsp;&nbsp;hello –&gt; 目标<br>&nbsp; &nbsp;&nbsp;@echo “hello makefile” -&gt; 实现目标所需要执行的命令<blockquote>
<p>注意：目标后的命令需要用tab键（’\t’）隔开！</p>
</blockquote>
<h3 id="2）运行makefile"><a href="#2）运行makefile" class="headerlink" title="2）运行makefile"></a>2）运行makefile</h3>要运行makefile在linux下执行以下命令： <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">make</span> –<span class="selector-tag">f</span> <span class="selector-tag">mf</span><span class="selector-class">.txt</span> <span class="selector-tag">hello</span></span><br></pre></td></tr></table></figure>
命令功能说明：以hello关键字作为目标查找mf.txt文件，并执行hello处的命令<h1 id="二、初识makefile的结构"><a href="#二、初识makefile的结构" class="headerlink" title="二、初识makefile的结构"></a><div align=center>二、初识makefile的结构</h1><h2 id="1-makefile的意义"><a href="#1-makefile的意义" class="headerlink" title="1. makefile的意义"></a>1. makefile的意义</h2>makefile用于定义源文件之间的依赖关系<br>makefile说明如何编译各个源文件并生成可执行文件<h2 id="2-依赖的定义"><a href="#2-依赖的定义" class="headerlink" title="2. 依赖的定义"></a>2. 依赖的定义</h2><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">targets : prerequisite ; comma<span class="symbol">nd1</span></span><br><span class="line">	‘\t’ comma<span class="symbol">nd2</span></span><br></pre></td></tr></table></figure>
<h2 id="3-Makefile中的元素含义"><a href="#3-Makefile中的元素含义" class="headerlink" title="3. Makefile中的元素含义"></a>3. Makefile中的元素含义</h2><h3 id="1）targets"><a href="#1）targets" class="headerlink" title="1）targets"></a>1）targets</h3>通常是需要生成的目标文件名<br>make所需执行的命令名称<br>可以包含多个目标，使用空格对将多个目标隔开<h3 id="2）prerequisite"><a href="#2）prerequisite" class="headerlink" title="2）prerequisite"></a>2）prerequisite</h3>当前目标所依赖的其他目标或文件<br>可以包含多个依赖，使用空格对将多个依赖隔开<h3 id="3）command"><a href="#3）command" class="headerlink" title="3）command"></a>3）command</h3>完成目标所需要执行的命令<h3 id="4）规则中的注意事项"><a href="#4）规则中的注意事项" class="headerlink" title="4）规则中的注意事项"></a>4）规则中的注意事项</h3></li>
<li>*[tab]键：’\t’**<br>&nbsp;&nbsp;&nbsp;&nbsp;每一个命令必须以[tab]字符开始<br>&nbsp;&nbsp;&nbsp;&nbsp;[tab]字符告诉make此行是一个命令行</li>
<li><em>续行符：*</em><br>&nbsp;&nbsp;&nbsp;&nbsp;可以将内容分开写到下一行，提高可读性<h2 id="3-makefile依赖示例"><a href="#3-makefile依赖示例" class="headerlink" title="3. makefile依赖示例"></a>3. makefile依赖示例</h2><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">all : test</span><br><span class="line">	echo “make all”</span><br><span class="line"><span class="keyword">test </span>: </span><br><span class="line">	echo “make test”</span><br></pre></td></tr></table></figure>
说明：上述makefile定义了两条依赖规则，all这个目标依赖于test，如果test这个目标成立，就执行 echo “make all” 这个命令，如果test不成立，就会去寻找test这个子目标，test没有子目标因此只需执行 echo “make test”  test这个子目标就完成了。<h2 id="4-依赖规则"><a href="#4-依赖规则" class="headerlink" title="4. 依赖规则"></a>4. 依赖规则</h2>当目标对应的文件不存在，执行对应命令<br>当依赖在时间上比目标更新，执行对应命令<br>当依赖关系连续发生时，对比依赖链上每一个目标<blockquote>
<p>小技巧：makfile中可以在命令的前面加上@符，作用为命令无回显。</p>
</blockquote>
<h2 id="5-第一个make的编译案例"><a href="#5-第一个make的编译案例" class="headerlink" title="5. 第一个make的编译案例"></a>5. 第一个make的编译案例</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">hello</span><span class="selector-class">.out</span> : <span class="selector-tag">main</span><span class="selector-class">.o</span> <span class="selector-tag">func</span><span class="selector-class">.o</span></span><br><span class="line">	<span class="selector-tag">gcc</span> <span class="selector-tag">-o</span> <span class="selector-tag">hello</span><span class="selector-class">.out</span> <span class="selector-tag">main</span><span class="selector-class">.o</span> <span class="selector-tag">func</span><span class="selector-class">.o</span></span><br><span class="line"><span class="selector-tag">main</span><span class="selector-class">.o</span> : </span><br><span class="line">	<span class="selector-tag">gcc</span> <span class="selector-tag">-o</span> <span class="selector-tag">main</span><span class="selector-class">.o</span> <span class="selector-tag">-c</span> <span class="selector-tag">main</span><span class="selector-class">.c</span></span><br><span class="line"><span class="selector-tag">func</span><span class="selector-class">.o</span> : </span><br><span class="line">	<span class="selector-tag">gcc</span> <span class="selector-tag">-o</span> <span class="selector-tag">func</span><span class="selector-class">.o</span> <span class="selector-tag">-c</span> <span class="selector-tag">func</span><span class="selector-class">.c</span></span><br></pre></td></tr></table></figure>
小技巧：工程开发中可以将最终可执行文件名和all同时作为makefile中第一条规则<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">hello</span><span class="selector-class">.out</span> <span class="selector-tag">all</span> : <span class="selector-tag">main</span><span class="selector-class">.o</span> <span class="selector-tag">func</span><span class="selector-class">.o</span> </span><br><span class="line">	<span class="selector-tag">gcc</span> <span class="selector-tag">-o</span> <span class="selector-tag">hello</span><span class="selector-class">.out</span> <span class="selector-tag">main</span><span class="selector-class">.o</span> <span class="selector-tag">fun</span><span class="selector-class">.o</span></span><br></pre></td></tr></table></figure>
当我们想手动编译时执行make all 就会编译，直接make则会检测hello.out。<h1 id="三、伪目标的引入"><a href="#三、伪目标的引入" class="headerlink" title="三、伪目标的引入"></a><div align=center>三、伪目标的引入</h1><h2 id="1-makefile中目标的含义"><a href="#1-makefile中目标的含义" class="headerlink" title="1. makefile中目标的含义"></a>1. makefile中目标的含义</h2><h3 id="1）默认情况下"><a href="#1）默认情况下" class="headerlink" title="1）默认情况下"></a>1）默认情况下</h3>make 认为目标对应着一个文件<br>make 比较目标文件和依赖文件的新旧关系，决定是否执行命令<br>make 以文件处理作为第一优先级<h3 id="2）makefile中的伪目标"><a href="#2）makefile中的伪目标" class="headerlink" title="2）makefile中的伪目标"></a>2）makefile中的伪目标</h3>通过.PHONY关键字声明一个伪目标<br>伪目标不对应任何实际的文件<br>不管目标的依赖是否更新，命令总是执行<h3 id="3）伪目标的语法"><a href="#3）伪目标的语法" class="headerlink" title="3）伪目标的语法"></a>3）伪目标的语法</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : <span class="type">Target</span> </span><br></pre></td></tr></table></figure>
<h3 id="4-伪目标的本质"><a href="#4-伪目标的本质" class="headerlink" title="4) 伪目标的本质"></a>4) 伪目标的本质</h3>伪目标是make中特殊目标.PHONY的依赖，先声明、后使用。<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : <span class="type">clean</span> rebuild <span class="keyword">all</span> </span><br><span class="line"></span><br><span class="line">## other rules ## </span><br><span class="line"></span><br><span class="line">rebuile : <span class="type">clean</span> <span class="keyword">all</span></span><br><span class="line"></span><br><span class="line">clean : </span><br><span class="line">	rm *o hello.<span class="keyword">out</span></span><br></pre></td></tr></table></figure>
原理：当一个目标的依赖包含伪目标时，伪目标所定义的命令总是会被执行<h2 id="2-绕开-PHONY关键字定义伪目标"><a href="#2-绕开-PHONY关键字定义伪目标" class="headerlink" title="2. 绕开.PHONY关键字定义伪目标"></a>2. 绕开.PHONY关键字定义伪目标</h2>如果一个规则没有命令或者依赖，并且它的目标不是一个存在的文件名；在执行此规则时，目标总是被认为是最新的。<figure class="highlight vhdl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">clean : <span class="keyword">FORCE</span></span><br><span class="line">	rm *.o hello.<span class="keyword">out</span></span><br><span class="line"><span class="keyword">FORCE</span> :</span><br></pre></td></tr></table></figure>
<h1 id="四、变量和不同的赋值方式"><a href="#四、变量和不同的赋值方式" class="headerlink" title="四、变量和不同的赋值方式"></a><div align=center>四、变量和不同的赋值方式</h1><h2 id="1-makefile中的变量"><a href="#1-makefile中的变量" class="headerlink" title="1. makefile中的变量"></a>1. makefile中的变量</h2>makefile中支持程序设计语言中变量的概念<br>makefile中变量只代表文本数据<h2 id="2-makefile中变量命名规则"><a href="#2-makefile中变量命名规则" class="headerlink" title="2. makefile中变量命名规则"></a>2. makefile中变量命名规则</h2>变量名大小写敏感<br>变量名可以包含字符，数字，下划线<br>不能包含 ”:” , “#” , “=” , 或 ” ”<br>makefile未定义的变量的值为空值<h2 id="3-makefile中变量的赋值方式"><a href="#3-makefile中变量的赋值方式" class="headerlink" title="3. makefile中变量的赋值方式"></a>3. makefile中变量的赋值方式</h2><h3 id="1-简单赋值"><a href="#1-简单赋值" class="headerlink" title="1)    简单赋值 :="></a>1)    简单赋值 :=</h3>程序设计语言中的通用赋值方式<br>只针对当前语句变量有效<figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">x</span> := foo</span><br><span class="line"><span class="symbol">y</span> := $(<span class="symbol">x</span>)b</span><br><span class="line"><span class="symbol">x</span> := new</span><br><span class="line"></span><br><span class="line">.PHONY : test</span><br><span class="line">test :</span><br><span class="line">	@echo “<span class="symbol">x</span> = $(<span class="symbol">x</span>)”</span><br><span class="line">	@echo “<span class="symbol">y</span> = $(<span class="symbol">y</span>)”</span><br><span class="line"></span><br><span class="line">输出结果：</span><br><span class="line">	<span class="symbol">x</span> = new</span><br><span class="line">	<span class="symbol">y</span> = foob</span><br></pre></td></tr></table></figure>
<h3 id="2-递归赋值"><a href="#2-递归赋值" class="headerlink" title="2)    递归赋值 ="></a>2)    递归赋值 =</h3>赋值操作可能影响多个其他变量<br>所有与目标变量相关的其他变量将受到影响<figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">x</span> = foo</span><br><span class="line"><span class="symbol">y</span> = $(<span class="symbol">x</span>)b</span><br><span class="line"><span class="symbol">x</span> = new</span><br><span class="line"></span><br><span class="line">.PHONY : test</span><br><span class="line">test :</span><br><span class="line">	@echo “<span class="symbol">x</span> = $(<span class="symbol">x</span>)”</span><br><span class="line">	@echo “<span class="symbol">y</span> = $(<span class="symbol">y</span>)”</span><br><span class="line"></span><br><span class="line">输出结果：</span><br><span class="line">	<span class="symbol">x</span> = new</span><br><span class="line">	<span class="symbol">y</span> = newb</span><br></pre></td></tr></table></figure>
<h3 id="3-条件赋值"><a href="#3-条件赋值" class="headerlink" title="3) 条件赋值 ?="></a>3) 条件赋值 ?=</h3>如果变量未定义，使用赋值符号中的值定义变量<br>如果变量已经定义，赋值无效<figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">x</span> := foo</span><br><span class="line"><span class="symbol">y</span> := $(<span class="symbol">x</span>)b</span><br><span class="line"><span class="symbol">x</span> ?= new</span><br><span class="line"></span><br><span class="line">.PHONY : test</span><br><span class="line">test :</span><br><span class="line">	@echo “<span class="symbol">x</span> = $(<span class="symbol">x</span>)”</span><br><span class="line">	@echo “<span class="symbol">y</span> = $(<span class="symbol">y</span>)”</span><br><span class="line"></span><br><span class="line">输出结果：</span><br><span class="line">	<span class="symbol">x</span> = foo</span><br><span class="line">	<span class="symbol">y</span> = foob</span><br></pre></td></tr></table></figure>
<h3 id="4-追加赋值"><a href="#4-追加赋值" class="headerlink" title="4) 追加赋值 +="></a>4) 追加赋值 +=</h3>原变量值之后加上一个新值<br>原变量值与新值之间由空格隔开<figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">x</span> := foo</span><br><span class="line"><span class="symbol">y</span> := $(<span class="symbol">x</span>)b</span><br><span class="line"><span class="symbol">x</span> += $(<span class="symbol">y</span>)</span><br><span class="line"></span><br><span class="line">.PHONY : test</span><br><span class="line">test :</span><br><span class="line">	@echo “<span class="symbol">x</span> = $(<span class="symbol">x</span>)”</span><br><span class="line">	@echo “<span class="symbol">y</span> = $(<span class="symbol">y</span>)”</span><br><span class="line"></span><br><span class="line">输出结果：</span><br><span class="line">	<span class="symbol">x</span> = foo foob</span><br><span class="line">	<span class="symbol">y</span> = foob</span><br></pre></td></tr></table></figure>
<h1 id="五、预定义变量的使用"><a href="#五、预定义变量的使用" class="headerlink" title="五、预定义变量的使用"></a><div align=center>五、预定义变量的使用</h1><h2 id="1-自动变量"><a href="#1-自动变量" class="headerlink" title="1. 自动变量"></a>1. 自动变量</h2>$@  当前规则中触发命令被执行的目标<br>$^  当前规则中的所有依赖<br>$&lt;  当前规则中的第一个依赖<h2 id="2-自动变量的使用"><a href="#2-自动变量的使用" class="headerlink" title="2. 自动变量的使用"></a>2. 自动变量的使用</h2><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PHONY : <span class="keyword">all</span> first second third</span><br><span class="line"></span><br><span class="line"><span class="keyword">all</span> : first second third</span><br><span class="line">	@echo “\<span class="symbol">$</span><span class="symbol">$</span>@ =&gt; <span class="symbol">$</span>@”</span><br><span class="line">	@echo “<span class="symbol">$</span><span class="symbol">$</span>^ =&gt; <span class="symbol">$</span><span class="symbol">$</span>^”</span><br><span class="line">	@echo “<span class="symbol">$</span><span class="symbol">$</span>&lt; =&gt; <span class="symbol">$</span>&lt;”</span><br><span class="line"></span><br><span class="line">first :</span><br><span class="line">second : </span><br><span class="line">third : </span><br><span class="line"></span><br><span class="line">输出结果：</span><br><span class="line">	<span class="symbol">$</span>@ =&gt; <span class="keyword">all</span></span><br><span class="line">	<span class="symbol">$</span>^ =&gt; first second third</span><br><span class="line">	<span class="symbol">$</span>&lt; =&gt; first</span><br></pre></td></tr></table></figure>
小贴士：<br>&nbsp;&nbsp;&nbsp;&nbsp;“$”对于makefile有特殊含义，输出时加上一个$进行转义<br>&nbsp;&nbsp;&nbsp;&nbsp;“$@”对于Bash Shell 有特殊含义，输出时加上”\”进行转义<h2 id="2-特殊变量"><a href="#2-特殊变量" class="headerlink" title="2. 特殊变量"></a>2. 特殊变量</h2></li>
<li><strong>$(MAKE)</strong><br>当前make解释器的文件名</li>
<li><strong>$(MAKECMDGOALS)</strong><br>命令中指定的目标名（make的命令行参数）</li>
<li><strong>$(MAKEFILE_LIST)</strong><br>make所需要处理的makefile文件列表<br>当前makefile的文件名总是位于列表的最后<br>文件名之间以空格进行划分</li>
<li><strong>$(MAKE_VERSION)</strong><br>当前make解释器的版本</li>
<li>**$(CURDIR) **<br>当前make解释器的工作目录</li>
<li><strong>$(.VARIABLES)</strong><br>所有已经定义的变量名列表，其中包括预定义变量和自定义变量<h1 id="六、变量的高级主题"><a href="#六、变量的高级主题" class="headerlink" title="六、变量的高级主题"></a><div align=center>六、变量的高级主题</h1><h2 id="1-常用语法"><a href="#1-常用语法" class="headerlink" title="1. 常用语法"></a>1. 常用语法</h2><h3 id="1）-变量值的替换"><a href="#1）-变量值的替换" class="headerlink" title="1） 变量值的替换"></a>1） 变量值的替换</h3>使用指定字符（串）替换变量中的后缀字符（串）<br>语法格式<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(var:<span class="attribute">a</span>=b)或$&#123;var:<span class="attribute">a</span>=b&#125;</span><br></pre></td></tr></table></figure>
替换表达式中不能有任何的空格<br>make中支持使用${}对变量进行取值<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">src := a.cc b.cc c.cc</span><br><span class="line">obj := $(src:cc=o)</span><br><span class="line"><span class="keyword">test </span>:</span><br><span class="line">	@echo ”obj =&gt; $(obj)”</span><br><span class="line"></span><br><span class="line">输出结果：obj = &gt; a.o b.o c.o</span><br></pre></td></tr></table></figure>
<h3 id="2）变量的模式替换"><a href="#2）变量的模式替换" class="headerlink" title="2）变量的模式替换"></a>2）变量的模式替换</h3>使用%保留变量值中的指定字符，替换其他字符<br>语法格式<figure class="highlight gml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">var</span>:a%b=<span class="symbol">x</span>%<span class="symbol">y</span>)或$&#123;<span class="keyword">var</span>:a%b=<span class="symbol">x</span>%<span class="symbol">y</span>&#125;</span><br></pre></td></tr></table></figure>
替换表达式中不能有任何的空格<br>make中支持使用${}对变量进行取值<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">src :<span class="operator">=</span> a<span class="number">1</span>b.<span class="keyword">c</span> a<span class="number">2</span>b.<span class="keyword">c</span> a<span class="number">3</span>b.<span class="keyword">c</span></span><br><span class="line"></span><br><span class="line">obj :<span class="operator">=</span> $(src:a<span class="variable">%b.c</span><span class="operator">=</span><span class="keyword">x</span><span class="variable">%y</span>)</span><br><span class="line"></span><br><span class="line">.PHONY : test</span><br><span class="line"></span><br><span class="line">test :</span><br><span class="line">	<span class="title">@echo</span> <span class="string">&quot;obj =&gt; $(obj)&quot;</span></span><br><span class="line"></span><br><span class="line">输出结果：</span><br><span class="line">	obj <span class="operator">=</span>&gt; <span class="keyword">x</span><span class="number">1</span>y <span class="keyword">x</span><span class="number">2</span>y <span class="keyword">x</span><span class="number">3</span>y</span><br></pre></td></tr></table></figure>
<h3 id="3）规则中的模式替换"><a href="#3）规则中的模式替换" class="headerlink" title="3）规则中的模式替换"></a>3）规则中的模式替换</h3><h4 id="a）直接模式替换（自己起的名字）"><a href="#a）直接模式替换（自己起的名字）" class="headerlink" title="a）直接模式替换（自己起的名字）"></a>a）直接模式替换（自己起的名字）</h4><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">targets-<span class="built_in">pattern</span> : prereq-<span class="built_in">pattern</span></span><br><span class="line">	command1</span><br><span class="line">	command2</span><br><span class="line">	…</span><br></pre></td></tr></table></figure>
在当前路径查找满足条件的依赖并与目标构成完整的规则<br>实例说明<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : test</span><br><span class="line"></span><br><span class="line"><span class="keyword">test </span>: a.o b.o</span><br><span class="line"></span><br><span class="line">a.o :</span><br><span class="line">	@echo &quot;I&#x27;m rule of a.o&quot;</span><br><span class="line"></span><br><span class="line">%.o : %.c</span><br><span class="line">	gcc -o $@ -c $^</span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">	I&#x27;m rule of a.o</span><br><span class="line">	gcc -o b.o -c b.c</span><br></pre></td></tr></table></figure>
如果未对a.o、b.O进行规则声明，则默认生成以下规则<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span><span class="selector-class">.o</span> : <span class="selector-tag">a</span>.c</span><br><span class="line">	gcc -o <span class="selector-tag">a</span><span class="selector-class">.o</span> -c <span class="selector-tag">a</span>.c</span><br><span class="line"><span class="selector-tag">b</span><span class="selector-class">.o</span> : <span class="selector-tag">b</span>.c</span><br><span class="line">	gcc -o <span class="selector-tag">b</span><span class="selector-class">.o</span> -c <span class="selector-tag">b</span>.o</span><br></pre></td></tr></table></figure>
但此处对a.o已经有了自己的模式规则因此，上述代码等价于<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.PHONY</span> : test</span><br><span class="line"></span><br><span class="line">test : <span class="selector-tag">a</span><span class="selector-class">.o</span> <span class="selector-tag">b</span>.o</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-class">.o</span> :</span><br><span class="line">	@echo <span class="string">&quot;I&#x27;m rule of a.o&quot;</span></span><br><span class="line"><span class="selector-tag">b</span><span class="selector-class">.o</span> : <span class="selector-tag">b</span>.c</span><br><span class="line">	gcc -o <span class="selector-tag">b</span><span class="selector-class">.o</span> -c <span class="selector-tag">b</span>.o</span><br></pre></td></tr></table></figure>
<h4 id="b）间接模式替换（自己起的名字）"><a href="#b）间接模式替换（自己起的名字）" class="headerlink" title="b）间接模式替换（自己起的名字）"></a>b）间接模式替换（自己起的名字）</h4><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">targets : <span class="type">targets</span>-pattern : <span class="type">prereq</span>-pattern</span><br><span class="line">	command1</span><br><span class="line">	command2</span><br><span class="line">	…</span><br></pre></td></tr></table></figure>
通过targets-pattern从targets中匹配子目标<br>再通过prereq-pattern从子目标生成依赖,进而构成完整的规则<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">OBJS : func.o main.o</span><br><span class="line"></span><br><span class="line">$(OBJS) : %.o : %.c</span><br><span class="line">	gcc -o $@ -c $^</span><br></pre></td></tr></table></figure>
等价于<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">OBJS : func<span class="selector-class">.o</span> main.o</span><br><span class="line"></span><br><span class="line">func<span class="selector-class">.o</span> : func.c</span><br><span class="line">	gcc -o $@ -c $^</span><br><span class="line">main<span class="selector-class">.o</span> : main.c</span><br><span class="line">	gcc -o $@ -c $^</span><br></pre></td></tr></table></figure>
<h3 id="4）变量值的嵌套引用"><a href="#4）变量值的嵌套引用" class="headerlink" title="4）变量值的嵌套引用"></a>4）变量值的嵌套引用</h3>一个变量名之中可以包含对其他变量的引用<br>嵌套引用的本质是使用一个变量表示另一个变量<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">x := y</span><br><span class="line">y := z</span><br><span class="line">a := $($(x))</span><br><span class="line"></span><br><span class="line"><span class="keyword">test </span>:</span><br><span class="line">	@echo &quot;a ==&gt; $(a)&quot;</span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">	a ==&gt; z</span><br></pre></td></tr></table></figure>
<h3 id="5）命令行变量"><a href="#5）命令行变量" class="headerlink" title="5）命令行变量"></a>5）命令行变量</h3>运行make时，在命令行定义变量<br>命令行变量默认覆盖makefile中定义的变量<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hm := hello makefile</span><br><span class="line"><span class="keyword">test </span>:</span><br><span class="line">	@echo “hm =&gt; $(hm)”</span><br><span class="line"></span><br><span class="line">执行：make hm := cmd</span><br><span class="line"></span><br><span class="line">运行结果：hm =&gt; cmd</span><br></pre></td></tr></table></figure>
<h3 id="6）override关键字"><a href="#6）override关键字" class="headerlink" title="6）override关键字"></a>6）override关键字</h3>用于指示makefile中定义的变量不能被覆盖<br>变量的定义和赋值都要用到override关键字<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">override var := test</span><br><span class="line"><span class="keyword">test </span>: </span><br><span class="line">	@echo “var =&gt; $(var)”</span><br><span class="line"></span><br><span class="line">执行：make var:=cmd</span><br><span class="line"></span><br><span class="line">执行结果：hm =&gt; test</span><br></pre></td></tr></table></figure>
<h3 id="7）define关键字"><a href="#7）define关键字" class="headerlink" title="7）define关键字"></a>7）define关键字</h3>用于在makefile中定义多行变量<br>多行变量的定义从变量名开始到endef结束<br>可以使用override关键字防止变量被覆盖<br>define定义的变量等价于使用=定义的变量<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">define foo</span><br><span class="line">I’m fool:</span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line">override define <span class="keyword">cmd</span></span><br><span class="line"><span class="bash">@<span class="built_in">echo</span> <span class="string">&quot;run cmd begin ...&quot;</span></span></span><br><span class="line">@echo <span class="string">&quot;run cmd end ...&quot;</span></span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line">test :</span><br><span class="line">	@echo <span class="string">&quot;$(foo)&quot;</span></span><br><span class="line">	$(<span class="keyword">cmd</span><span class="bash">)</span></span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">	I’m fool:</span><br><span class="line">	<span class="keyword">run</span><span class="bash"> cmd begin ...</span></span><br><span class="line">	<span class="keyword">run</span><span class="bash"> cmd end ...</span></span><br></pre></td></tr></table></figure>
<h2 id="2-环境变量（全局变量）"><a href="#2-环境变量（全局变量）" class="headerlink" title="2. 环境变量（全局变量）"></a>2. 环境变量（全局变量）</h2>makefile中能够直接使用环境变量的值<br>定义了同名变量，默认环境变量将被覆盖<br>运行make时指定”-e”选项使用系统默认环境变量<br>环境变量可以在所有的makefile中使用<br>过多的依赖环境变量会使系统的移植性降低<h2 id="3-目标变量（局部变量）"><a href="#3-目标变量（局部变量）" class="headerlink" title="3. 目标变量（局部变量）"></a>3. 目标变量（局部变量）</h2>作用域只在指定目标及连带规则中</li>
<li>*语法格式**<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target : <span class="keyword">variable</span><span class="number">_n</span>ame := <span class="keyword">variable</span>-<span class="keyword">value</span></span><br></pre></td></tr></table></figure></li>
<li>*举例说明**<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var : D.T.Software</span><br><span class="line"><span class="keyword">test </span>: var := test-var</span><br><span class="line"><span class="keyword">test </span>: </span><br><span class="line">	@echo “test:”</span><br><span class="line">	@echo “var =&gt; $(var)”</span><br></pre></td></tr></table></figure>
<h2 id="4-模式变量（局部变量）"><a href="#4-模式变量（局部变量）" class="headerlink" title="4. 模式变量（局部变量）"></a>4. 模式变量（局部变量）</h2>模式变量是目标变量的扩展<br>作用域只在符合模式的目标及连带规则中</li>
<li>*语法格式**<figure class="highlight ceylon"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%target : <span class="keyword">variable</span><span class="number">_n</span>ame := <span class="keyword">variable</span>-<span class="keyword">value</span></span><br></pre></td></tr></table></figure></li>
<li>*举例说明**<br>当前要定义一个名为new的局部变量，new的作用域是所有已e结尾的目标及连带规则。<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> := TDelphi</span><br><span class="line">%e : <span class="keyword">override</span> <span class="keyword">new</span> := test-<span class="keyword">new</span></span><br><span class="line">rule : </span><br><span class="line"><span class="keyword">@echo</span> “rule:”</span><br><span class="line">	<span class="keyword">@echo</span> ”<span class="keyword">new</span> =&gt; $(<span class="keyword">new</span>)”</span><br></pre></td></tr></table></figure>
<h2 id="3-变量在不同的makefile中的传递方式"><a href="#3-变量在不同的makefile中的传递方式" class="headerlink" title="3. 变量在不同的makefile中的传递方式"></a>3. 变量在不同的makefile中的传递方式</h2>直接在外部定义环境变量进行传递<br>使用explort定义变量进行传递（定义零时环境变量）<br>定义make命令行进行环境变量传递（推荐）<h1 id="七、条件判断语句"><a href="#七、条件判断语句" class="headerlink" title="七、条件判断语句"></a><div align=center>七、条件判断语句</h1><h2 id="1-makefile中的条件判断语句"><a href="#1-makefile中的条件判断语句" class="headerlink" title="1. makefile中的条件判断语句"></a>1. makefile中的条件判断语句</h2>可以根据条件值来决定make的执行<br>可以比较两个不同变量或变量和常量值<h2 id="2-表现形式"><a href="#2-表现形式" class="headerlink" title="2. 表现形式"></a>2. 表现形式</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ifxxx</span> (arg<span class="number">1</span>,arg<span class="number">2</span>)</span><br><span class="line"> <span class="comment"># for true</span></span><br><span class="line"><span class="attribute">else</span></span><br><span class="line"> <span class="comment"># for false</span></span><br><span class="line"><span class="attribute">endif</span></span><br></pre></td></tr></table></figure>
其他合法形式<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">ifxxx</span> “arg<span class="number">1</span>” “arg<span class="number">2</span>”</span><br><span class="line"><span class="attribute">ifxxx</span> “arg<span class="number">1</span>” ‘arg<span class="number">2</span>’</span><br><span class="line"><span class="attribute">ifxxx</span> ‘arg<span class="number">1</span>’ “arg<span class="number">2</span>”</span><br><span class="line"><span class="attribute">ifxxx</span> ‘arg<span class="number">1</span>’ “arg<span class="number">2</span>’</span><br></pre></td></tr></table></figure>
<h2 id="3-条件判断关键字"><a href="#3-条件判断关键字" class="headerlink" title="3. 条件判断关键字"></a>3. 条件判断关键字</h2></li>
</ul>
<table>
<thead>
<tr>
<th>关键字</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>ifeq  ($(x),$(y))</td>
<td>判断参数是否相等，相等为true，否则为false</td>
</tr>
<tr>
<td>ifneq ($(x),$(y))</td>
<td>判断参数是否不相等，不相等则为true，否则为false</td>
</tr>
<tr>
<td>ifdef  x</td>
<td>判断变量是否有值，有值为true，否则为false</td>
</tr>
<tr>
<td>ifndef x</td>
<td>判断变量是否没有值，没有为true，否则为false</td>
</tr>
</tbody></table>
<blockquote>
<p>注意：条件判断语句只能用与控制make中实际执行的语句；但是，不能控制规则中命令的执行过程。</p>
</blockquote>
<h2 id="4-工程使用小结"><a href="#4-工程使用小结" class="headerlink" title="4. 工程使用小结"></a>4. 工程使用小结</h2><p>条件判断语句之前可以有空格，但不能有tab字符（’t\’）<br>在条件判断语句中不要用自动变量（$@,$^,$&lt;）<br>一条完整的条件语句必须位于同一个makefile中<br>条件判断类似于c语言中的宏，预处理阶段有效，执行阶段无效<br>make在加载makefile时首先计算表达式的值（赋值方式不同计算方式不同）<br>根据判断语句的表达式决定执行的内容</p>
<h2 id="5-举例说明"><a href="#5-举例说明" class="headerlink" title="5.举例说明"></a>5.举例说明</h2><h3 id="1）条件判断关键字程序实例"><a href="#1）条件判断关键字程序实例" class="headerlink" title="1）条件判断关键字程序实例"></a>1）条件判断关键字程序实例</h3><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : test  </span><br><span class="line">	  </span><br><span class="line">var1 := cmd</span><br><span class="line">var2 := $(var1)</span><br><span class="line"></span><br><span class="line">test:  </span><br><span class="line">    ife<span class="string">q ($(var1)</span>,$(var2))</span><br><span class="line">	@echo <span class="string">&quot;var1 == var2&quot;</span></span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">	@echo <span class="string">&quot;var1 != var2&quot;</span></span><br><span class="line">    endif</span><br><span class="line"></span><br><span class="line">    ifne<span class="string">q ($(var1)</span>,$(var2))</span><br><span class="line">	@echo <span class="string">&quot;var1 != var2&quot;</span></span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">	@echo <span class="string">&quot;var1 == var2&quot;</span></span><br><span class="line">    endif</span><br><span class="line">    </span><br><span class="line">    ifdef var1</span><br><span class="line">	@echo <span class="string">&quot;var1 is NOT empty&quot;</span> </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">	@echo <span class="string">&quot;var1 is empty&quot;</span></span><br><span class="line">    endif</span><br><span class="line">	</span><br><span class="line">    ifndef var1</span><br><span class="line">	@echo <span class="string">&quot;var1 is empty&quot;</span> </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">	@echo <span class="string">&quot;var1 is NOT empty&quot;</span></span><br><span class="line">    endif</span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">	var1 == var2</span><br><span class="line">	var1 == var2</span><br><span class="line">	var1 is NOT empty</span><br><span class="line">	var1 is NOT empty</span><br></pre></td></tr></table></figure>
<h3 id="2）条件判断关键字异常分析"><a href="#2）条件判断关键字异常分析" class="headerlink" title="2）条件判断关键字异常分析"></a>2）条件判断关键字异常分析</h3><h4 id="a）异常情况1"><a href="#a）异常情况1" class="headerlink" title="a）异常情况1"></a>a）异常情况1</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : test</span><br><span class="line"></span><br><span class="line">var3 =</span><br><span class="line">var4 = <span class="variable">$(</span>var3)</span><br><span class="line"></span><br><span class="line"><span class="symbol">test:</span></span><br><span class="line">    <span class="keyword">if</span><span class="function"><span class="keyword">def</span> <span class="title">var3</span> </span></span><br><span class="line">	<span class="variable">@echo</span> <span class="string">&quot;var3 is defined&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">	<span class="variable">@echo</span> <span class="string">&quot;var3 is NOT defined&quot;</span></span><br><span class="line">    endif</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span><span class="function"><span class="keyword">def</span> <span class="title">var4</span></span></span><br><span class="line">	<span class="variable">@echo</span> <span class="string">&quot;var4 is defined&quot;</span>    </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">	<span class="variable">@echo</span> <span class="string">&quot;var4 is NOT defined&quot;</span>    </span><br><span class="line">    endif</span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">	var3 is NOT <span class="function"><span class="keyword">def</span><span class="title">ined</span></span></span><br><span class="line">	var4 is <span class="function"><span class="keyword">def</span><span class="title">ined</span></span></span><br></pre></td></tr></table></figure>
<p><strong>运行结果分析</strong><br>我们所期望的运行结果是var3与var4都是未定义，但这里运行结果表示var4的值为定义。<br><strong>原因分析</strong><br>产生这个结果的原因就是，make在加载makefile时首先计算表达式的值，由于我们使用的赋值表达式为 = 因此，makfile在预处理 ifdef var4 时无法确定var4的值是否定义，因此make解释器在这里默认为var4的值为已定义的值。</p>
<h4 id="b）异常情况2"><a href="#b）异常情况2" class="headerlink" title="b）异常情况2"></a>b）异常情况2</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : test</span><br><span class="line"></span><br><span class="line">var3 =</span><br><span class="line">var4 = <span class="variable">$(</span>var3)</span><br><span class="line"></span><br><span class="line"><span class="symbol">test:</span></span><br><span class="line">    <span class="keyword">if</span><span class="function"><span class="keyword">def</span> <span class="title">var3</span></span></span><br><span class="line">	<span class="variable">@echo</span> <span class="string">&quot;var3 is defined&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">	<span class="variable">@echo</span> <span class="string">&quot;var3 is NOT defined&quot;</span></span><br><span class="line">    endif</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span><span class="function"><span class="keyword">def</span> <span class="title">var4</span></span></span><br><span class="line">	<span class="variable">@echo</span> <span class="string">&quot;var4 is defined&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">	<span class="variable">@echo</span> <span class="string">&quot;var4 is NOT defined&quot;</span></span><br><span class="line">    endif</span><br><span class="line">    </span><br><span class="line">var3 = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">	var3 is NOT <span class="function"><span class="keyword">def</span><span class="title">ined</span></span></span><br><span class="line">	var4 is <span class="function"><span class="keyword">def</span><span class="title">ined</span></span></span><br></pre></td></tr></table></figure>
<h4 id="c）异常情况3"><a href="#c）异常情况3" class="headerlink" title="c）异常情况3"></a>c）异常情况3</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : test</span><br><span class="line"></span><br><span class="line">var3 =</span><br><span class="line">var4 = <span class="variable">$(</span>var3)</span><br><span class="line">var3 = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">test:</span></span><br><span class="line">    <span class="keyword">if</span><span class="function"><span class="keyword">def</span> <span class="title">var3</span></span></span><br><span class="line">	<span class="variable">@echo</span> <span class="string">&quot;var3 is defined&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">	<span class="variable">@echo</span> <span class="string">&quot;var3 is NOT defined&quot;</span></span><br><span class="line">    endif</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span><span class="function"><span class="keyword">def</span> <span class="title">var4</span></span></span><br><span class="line">	<span class="variable">@echo</span> <span class="string">&quot;var4 is defined&quot;</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">	<span class="variable">@echo</span> <span class="string">&quot;var4 is NOT defined&quot;</span></span><br><span class="line">    endif</span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">	var3 is <span class="function"><span class="keyword">def</span><span class="title">ined</span></span></span><br><span class="line">	var4 is <span class="function"><span class="keyword">def</span><span class="title">ined</span></span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>小贴士：<br>a为不对var3赋值<br>b、c为var赋值的位置不同产生的结果不同</p>
</blockquote>
<h1 id="八、函数的定义以及调用"><a href="#八、函数的定义以及调用" class="headerlink" title="八、函数的定义以及调用"></a><div align=center>八、函数的定义以及调用</h1><h2 id="1-makefile支持函数的概念"><a href="#1-makefile支持函数的概念" class="headerlink" title="1. makefile支持函数的概念"></a>1. makefile支持函数的概念</h2><p>make解释器提供了一系列的函数供makefile调用<br>在makefile中支持自定义函数实现，并调用执行<br>通过define关键字实现自定义函数</p>
<h2 id="2-自定义函数语法"><a href="#2-自定义函数语法" class="headerlink" title="2. 自定义函数语法"></a>2. 自定义函数语法</h2><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">define func1</span><br><span class="line">	<span class="meta">@echo</span> “My name <span class="keyword">is</span> $(<span class="number">0</span>)”</span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line">define func2</span><br><span class="line">	<span class="meta">@echo</span> “My name <span class="keyword">is</span> $(<span class="number">0</span>)”</span><br><span class="line">	<span class="meta">@echo</span> “Param =&gt; $(<span class="number">1</span>)”</span><br><span class="line">endef</span><br></pre></td></tr></table></figure>
<p>函数调用：</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">test </span>: </span><br><span class="line">	$(call func1)</span><br><span class="line">	$(call func2,D.T.Software)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>函数通过call关键字调用，$(0)、$(1)、$(3)、…代表依次传入的参数</p>
</blockquote>
<h2 id="3-深入理解自定义函数"><a href="#3-深入理解自定义函数" class="headerlink" title="3. 深入理解自定义函数"></a>3. 深入理解自定义函数</h2><p>自定义函数是一个多行变量，无法直接调用<br>自定义函数是一个过程调用，没有任何返回值<br>自定义函数用于定义命令集合，并应用于规则中</p>
<h2 id="4-实例分析"><a href="#4-实例分析" class="headerlink" title="4. 实例分析"></a>4. 实例分析</h2><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">define func1</span><br><span class="line">	@<span class="built_in">echo</span> <span class="string">&quot;My name is $(0)&quot;</span></span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line">define func2</span><br><span class="line">	@<span class="built_in">echo</span> <span class="string">&quot;My name is $(0)&quot;</span></span><br><span class="line">	@<span class="built_in">echo</span> <span class="string">&quot;Param =&gt; $(1)&quot;</span></span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line">.PHONY : test</span><br><span class="line"></span><br><span class="line">test :</span><br><span class="line">	$(func1)</span><br><span class="line">	$(func2)</span><br><span class="line">	@<span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line">	$(<span class="built_in">call</span> func1)</span><br><span class="line">	$(<span class="built_in">call</span> func2, Delphi)</span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">	My <span class="built_in">name</span> is </span><br><span class="line">	My <span class="built_in">name</span> is </span><br><span class="line">	<span class="built_in">Param</span> =&gt; </span><br><span class="line">	</span><br><span class="line">	My <span class="built_in">name</span> is func1</span><br><span class="line">	My <span class="built_in">name</span> is func2</span><br><span class="line">	<span class="built_in">Param</span> =&gt;  Delphi</span><br></pre></td></tr></table></figure>
<p>函数调用的本质就是宏替换的过程，通过call可以将相应的”形参”替换成”实参” $(0)、$(1)、$(3)、…，因此上述代码在运行的时候等价于</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">define func1</span><br><span class="line">	@<span class="built_in">echo</span> <span class="string">&quot;My name is <span class="subst">$(0)</span>&quot;</span></span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line">define func2</span><br><span class="line">	@<span class="built_in">echo</span> <span class="string">&quot;My name is <span class="subst">$(0)</span>&quot;</span></span><br><span class="line">	@<span class="built_in">echo</span> <span class="string">&quot;Param =&gt; <span class="subst">$(1)</span>&quot;</span></span><br><span class="line">endef</span><br><span class="line"></span><br><span class="line">.PHONY : <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">test</span> :</span><br><span class="line">	@<span class="built_in">echo</span> <span class="string">&quot;My name is &quot;</span></span><br><span class="line">	@<span class="built_in">echo</span> <span class="string">&quot;My name is &quot;</span></span><br><span class="line">	@<span class="built_in">echo</span> <span class="string">&quot;Param =&gt; &quot;</span></span><br><span class="line">	@<span class="built_in">echo</span> <span class="string">&quot;&quot;</span></span><br><span class="line">	@<span class="built_in">echo</span> <span class="string">&quot;My name is func1&quot;</span></span><br><span class="line">	@<span class="built_in">echo</span> <span class="string">&quot;My name is func2&quot;</span></span><br><span class="line">	@<span class="built_in">echo</span> <span class="string">&quot;Param =&gt; Delphi&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="九、变量与函数的综合示例"><a href="#九、变量与函数的综合示例" class="headerlink" title="九、变量与函数的综合示例"></a><div align=center>九、变量与函数的综合示例</h1><h2 id="1-实战需求"><a href="#1-实战需求" class="headerlink" title="1. 实战需求"></a>1. 实战需求</h2><p>自动生成target文件夹存放可执行文件<br>自动生成bojs文件夹存放编译生成的目标文件（*.o）<br>支持调试版本的编译选项<br>考虑代码的扩展性</p>
<h2 id="2-工具原料"><a href="#2-工具原料" class="headerlink" title="2. 工具原料"></a>2. 工具原料</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constructor">$(<span class="params">wildcard</span> <span class="params">_pattern</span>)</span></span><br></pre></td></tr></table></figure>
<p>获取当前工作目录中满足_pattern的文件或目录列表</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constructor">$(<span class="params">addprefix</span> <span class="params">_prefix</span>, <span class="params">_names</span>)</span></span><br></pre></td></tr></table></figure>
<p>给名字列表_name中的每一个名字增加前缀_prefix</p>
<h2 id="3-关键技巧"><a href="#3-关键技巧" class="headerlink" title="3. 关键技巧"></a>3. 关键技巧</h2><ul>
<li><strong>1) 自动获取当前目录小的文件列表（函数调用）</strong><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SRCS := <span class="variable">$(<span class="built_in">wildcard</span> *.c)</span></span><br></pre></td></tr></table></figure></li>
<li><strong>2) 根据源文件列表生成目标文件列表（变量的值替换）</strong><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">OBJS :</span>= $(<span class="attr">SRCS:</span>.c=.o)</span><br></pre></td></tr></table></figure></li>
<li><strong>3) 对每个目标文件加上前缀路径（函数调用）</strong><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">addprefix</span> apth/,<span class="variable">$(OBJS)</span>)</span></span><br></pre></td></tr></table></figure>
<h2 id="4-编译规则的依赖"><a href="#4-编译规则的依赖" class="headerlink" title="4. 编译规则的依赖"></a>4. 编译规则的依赖</h2></li>
</ul>
<img width=600 src="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/1.png" >

<h2 id="5-编程实现"><a href="#5-编程实现" class="headerlink" title="5. 编程实现"></a>5. 编程实现</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">DIR_OBJS := objs</span><br><span class="line">DIR_TARGET := target</span><br><span class="line">DIRS := <span class="variable">$(DIR_OBJS)</span> <span class="variable">$(DIR_TARGET)</span></span><br><span class="line"></span><br><span class="line">APP := <span class="variable">$(DIR_TARGET)</span>/app.out</span><br><span class="line"></span><br><span class="line">RM := rm -rf</span><br><span class="line">CC := gcc</span><br><span class="line">MKDIR := mkdir</span><br><span class="line"></span><br><span class="line">SRCE := <span class="variable">$(<span class="built_in">wildcard</span> *.c)</span></span><br><span class="line">OBJS := $(SRCE:.c=.o)</span><br><span class="line">OBJS := <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(DIR_OBJS)</span>/,<span class="variable">$(OBJS)</span>)</span></span><br><span class="line"></span><br><span class="line">DEBUG :=</span><br><span class="line"></span><br><span class="line">CFLAGS := </span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(DEBUG)</span>,true)</span><br><span class="line">CFLAGS += -g</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line">.PHONY : all clean rebuild</span><br><span class="line"></span><br><span class="line">all : <span class="variable">$(DIRS)</span> <span class="variable">$(APP)</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(APP)</span> : <span class="variable">$(OBJS)</span></span><br><span class="line">	<span class="variable">$(CC)</span> -o <span class="variable">$@</span> <span class="variable">$(OBJS)</span></span><br><span class="line">	@echo <span class="string">&quot;target ==&gt; <span class="variable">$@</span>&quot;</span></span><br><span class="line">	@echo <span class="string">&quot;&quot;</span></span><br><span class="line">	@./<span class="variable">$(APP)</span></span><br><span class="line">	</span><br><span class="line"><span class="variable">$(DIRS)</span> :</span><br><span class="line">	<span class="variable">$(MKDIR)</span> <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(DIR_OBJS)</span>/%.o : %.c</span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -o <span class="variable">$@</span> -c <span class="variable">$^</span></span><br><span class="line"></span><br><span class="line">clean :</span><br><span class="line">	<span class="variable">$(RM)</span> <span class="variable">$(DIRS)</span></span><br><span class="line">	</span><br><span class="line">rebuild : clean all</span><br><span class="line">	</span><br></pre></td></tr></table></figure>
<p>在当前目录下创建objs target文件，编译链接当前目录下.C文件，将生成的.o文件存放到objs文件夹，生成的可执行文件app.out存放在target文件夹，最后运行可执行程序app.out。其中当DEBUG=true时添加编译选项 -g 实现调试功能</p>
<h1 id="十、sed流编辑器"><a href="#十、sed流编辑器" class="headerlink" title="十、sed流编辑器"></a><div align=center>十、sed流编辑器</h1><h2 id="1-Linux中的sed命令"><a href="#1-Linux中的sed命令" class="headerlink" title="1. Linux中的sed命令"></a>1. Linux中的sed命令</h2><p>sed是一个流编辑器，用于流文本的修改（增/删/查/改）<br>sed可以用于流文本中的字符串替换<br>sed字符串替换方式为：sed ‘s:src:des:g’</p>
<h2 id="2-sed字符串替换实例"><a href="#2-sed字符串替换实例" class="headerlink" title="2. sed字符串替换实例"></a>2. sed字符串替换实例</h2><figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : test</span><br><span class="line"></span><br><span class="line"><span class="keyword">test </span>:</span><br><span class="line">	@echo &quot;test = &gt; abc+abc=abc&quot; | sed &#x27;s:abc:xyz:g&#x27;</span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">	test =&gt; xyz+xyz=xyz</span><br></pre></td></tr></table></figure>
<h2 id="3-sed支持正则表达式"><a href="#3-sed支持正则表达式" class="headerlink" title="3. sed支持正则表达式"></a>3. sed支持正则表达式</h2><p>在sed中可以用正则表达式匹配替换目标<br>并且可以使用匹配的目标生成替换结果</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &#x27;s,<span class="symbol">\(</span>.*<span class="symbol">\)</span><span class="symbol">\.</span>o[ :]*,objs/<span class="symbol">\1</span>.o : ,g&#x27;</span><br></pre></td></tr></table></figure>
<p>该表达式的结果为将流文本中的.o文件加上路径前缀 objs/</p>
<h1 id="十一、makefile小知识"><a href="#十一、makefile小知识" class="headerlink" title="十一、makefile小知识"></a><div align=center>十一、makefile小知识</h1><h2 id="1-生成依赖关系"><a href="#1-生成依赖关系" class="headerlink" title="1. 生成依赖关系"></a>1. 生成依赖关系</h2><p>获取目标的完整依赖关系</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -M <span class="keyword">test</span>.c</span><br></pre></td></tr></table></figure>
<p>获取目标的部分依赖关系</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -MM <span class="keyword">test</span>.c</span><br></pre></td></tr></table></figure>
<h2 id="2-拆分目标的依赖"><a href="#2-拆分目标的依赖" class="headerlink" title="2. 拆分目标的依赖"></a>2. 拆分目标的依赖</h2><p>将目标的完整依赖拆分为多个部分依赖</p>
<img width=600 src="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/2.png" >

<h2 id="3-make中的命令执行机制"><a href="#3-make中的命令执行机制" class="headerlink" title="3. make中的命令执行机制"></a>3. make中的命令执行机制</h2><p>规则中的每个命令默认是在一个新的进程中执行（shell）</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : all</span><br><span class="line"></span><br><span class="line">all :</span><br><span class="line">	<span class="keyword">mkdir</span> <span class="keyword">test</span></span><br><span class="line">	<span class="keyword">cd</span> <span class="keyword">test</span> </span><br><span class="line">	<span class="keyword">mkdir</span> subtest</span><br></pre></td></tr></table></figure>
<p><strong>运行结果：</strong><br>期待的运行结果为，创建一个文件夹test，在test中创建子文件夹subtest，但实际运行结果为在当前目录下创建出两个文件夹分别为test和subtest<br><strong>运行结果分析：</strong><br>make创建一个进程执行 mkdir test，执行完后进程结束，回到当前目录。make又创建一个进程执行 cd test，执行完后进程结束，回到当前目录。make再次创建一个进程执行 mkdir subtest，执行完后进程结束，回到当前目录。因此最终结果在当前目录下创建两个文件夹test和subtest。<br><strong>解决方案</strong><br>set-e指定发生错误后立即退出执行<br>可以通过分号 ; 和接续符 \ 将多个命令组合成一个命令<br>组合的命令一次在同一个进程中被执行，无论是否出错<br><strong>代码修改</strong></p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : all</span><br><span class="line"></span><br><span class="line">all :</span><br><span class="line">	<span class="keyword">set</span> -<span class="keyword">e</span>; \</span><br><span class="line">	<span class="keyword">mkdir</span> <span class="keyword">test</span>; \</span><br><span class="line">	<span class="keyword">cd</span> <span class="keyword">test</span>; \</span><br><span class="line">	<span class="keyword">mkdir</span> subtest</span><br></pre></td></tr></table></figure>
<h2 id="4-makefile中嵌入shell的for循环"><a href="#4-makefile中嵌入shell的for循环" class="headerlink" title="4. makefile中嵌入shell的for循环"></a>4. makefile中嵌入shell的for循环</h2><h3 id="1）语法规则"><a href="#1）语法规则" class="headerlink" title="1）语法规则"></a>1）语法规则</h3><img width=600 src="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/11.jpg" >

<blockquote>
<p><strong>说明：</strong><br>makefile中嵌入shell代码时，如果用到shell变量的值，必须在变量名前加上$$(例：$$dir)</p>
</blockquote>
<h3 id="2）编程实验"><a href="#2）编程实验" class="headerlink" title="2）编程实验"></a>2）编程实验</h3><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">MODULES := common <span class="string">\</span></span><br><span class="line">           main <span class="string">\</span></span><br><span class="line">           <span class="built_in">module</span></span><br><span class="line">           </span><br><span class="line">compile : </span><br><span class="line">	@set -e;<span class="string">\</span></span><br><span class="line">	<span class="keyword">for</span> dir <span class="keyword">in</span> $(MODULES);<span class="string">\</span></span><br><span class="line">	<span class="keyword">do</span><span class="string">\</span></span><br><span class="line">		echo $$dir;<span class="string">\</span></span><br><span class="line">	done</span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">	common</span><br><span class="line">	main</span><br><span class="line">	<span class="built_in">module</span></span><br></pre></td></tr></table></figure>
<h1 id="十二、makefile中的include关键字"><a href="#十二、makefile中的include关键字" class="headerlink" title="十二、makefile中的include关键字"></a><div align=center>十二、makefile中的include关键字</h1><h2 id="1-makefile对include关键字的处理"><a href="#1-makefile对include关键字的处理" class="headerlink" title="1. makefile对include关键字的处理"></a>1. makefile对include关键字的处理</h2><p>在当前目录搜索或指定目录搜索目标文件</p>
<h3 id="1）搜索成功"><a href="#1）搜索成功" class="headerlink" title="1）搜索成功"></a>1）搜索成功</h3><p>类似于c语言中include关键字，将文件内容直接搬到makefile中</p>
<h4 id="编程实验"><a href="#编程实验" class="headerlink" title="编程实验"></a>编程实验</h4><p>test.txt文件中的内容</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">test </span>:</span><br><span class="line">	<span class="variable">@echo</span> <span class="string">&quot;this is test&quot;</span></span><br></pre></td></tr></table></figure>
<p>makefile内容</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : <span class="keyword">all</span> clean</span><br><span class="line"></span><br><span class="line">include test.txt </span><br><span class="line"> </span><br><span class="line"><span class="keyword">all</span> :</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;this is all&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">make</span> <span class="keyword">all</span> 运行结果：</span><br><span class="line">	this <span class="keyword">is</span> test</span><br></pre></td></tr></table></figure>
<h3 id="2）搜索失败"><a href="#2）搜索失败" class="headerlink" title="2）搜索失败"></a>2）搜索失败</h3><p>产生警告，以文件作为目标查找并执行相应规则，当文件名对应的规则不存在时，最终产生错误</p>
<h4 id="a）规则存在"><a href="#a）规则存在" class="headerlink" title="a）规则存在"></a>a）规则存在</h4><p>test.txt文件不存在</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">include test.txt </span><br><span class="line"> </span><br><span class="line"><span class="keyword">all</span> :</span><br><span class="line">	@echo <span class="string">&quot;this is all&quot;</span></span><br><span class="line"></span><br><span class="line">test.txt :</span><br><span class="line">	@echo <span class="string">&quot;test.txt is not exist&quot;</span></span><br><span class="line"></span><br><span class="line">make <span class="keyword">all</span> 运行结果：</span><br><span class="line">	makefile:<span class="number">2</span>: test.txt: 没有那个文件或目录</span><br><span class="line">	test.txt <span class="keyword">is</span> <span class="keyword">not</span> exist</span><br><span class="line">	this <span class="keyword">is</span> <span class="keyword">all</span></span><br></pre></td></tr></table></figure>
<h4 id="b）规则不存在"><a href="#b）规则不存在" class="headerlink" title="b）规则不存在"></a>b）规则不存在</h4><p>test.txt文件不存在</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">include</span> <span class="selector-tag">test</span><span class="selector-class">.txt</span> </span><br><span class="line"> </span><br><span class="line"><span class="selector-tag">all</span> :</span><br><span class="line">	<span class="keyword">@echo</span> <span class="string">&quot;this is all&quot;</span></span><br><span class="line"></span><br><span class="line">make all 运行结果：</span><br><span class="line">	<span class="attribute">makefile:</span><span class="number">2</span>: test.<span class="attribute">txt:</span> 没有那个文件或目录</span><br><span class="line">	<span class="attribute">make:</span> *** 没有规则可以创建目标“test.txt”。 停止。</span><br></pre></td></tr></table></figure>
<h2 id="2-include关键字使用总结"><a href="#2-include关键字使用总结" class="headerlink" title="2. include关键字使用总结"></a>2. include关键字使用总结</h2><h3 id="1）当目标文件不存在"><a href="#1）当目标文件不存在" class="headerlink" title="1）当目标文件不存在"></a>1）当目标文件不存在</h3><img width=800 src="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/3.png" >

<h3 id="2）当目标文件存在"><a href="#2）当目标文件存在" class="headerlink" title="2）当目标文件存在"></a>2）当目标文件存在</h3><img width=1000 src="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/4.png" >

<h1 id="十三、自动生成依赖关系"><a href="#十三、自动生成依赖关系" class="headerlink" title="十三、自动生成依赖关系"></a><div align=center>十三、自动生成依赖关系</h1><h2 id="1-编译行为带来的缺陷"><a href="#1-编译行为带来的缺陷" class="headerlink" title="1. 编译行为带来的缺陷"></a>1. 编译行为带来的缺陷</h2><p>预处理器直接将头文件中的代码直接插入源文件<br>编译器只通过预处理后的源文件产生目标文件<br>因此，规则中以源文件为依赖，修改头文件后，命令可能无法执行</p>
<h2 id="2-实验中解决方案与问题"><a href="#2-实验中解决方案与问题" class="headerlink" title="2. 实验中解决方案与问题"></a>2. 实验中解决方案与问题</h2><ul>
<li><strong>解决方案</strong><br>头文件作为依赖条件出现于每一个目标对应的规则中<br>当头文件改动，任何源文件都将被重新编译（编译低效）</li>
<li><strong>存在问题</strong><br>当项目中头文件数量巨大时，makefile将很难维护<h2 id="3-思考是否可以自动生成依赖解决"><a href="#3-思考是否可以自动生成依赖解决" class="headerlink" title="3.思考是否可以自动生成依赖解决"></a>3.思考是否可以自动生成依赖解决</h2>通过命令自动生成对头文件的依赖<br>将生成的依赖自动包含进makefile中<br>当头文件改动后，自动确认需要重新编译的文件<h2 id="4-自动生成-dep依赖文件"><a href="#4-自动生成-dep依赖文件" class="headerlink" title="4. 自动生成.dep依赖文件"></a>4. 自动生成.dep依赖文件</h2><h3 id="1）得到依赖文件"><a href="#1）得到依赖文件" class="headerlink" title="1）得到依赖文件"></a>1）得到依赖文件</h3>通过gcc -MM 和 sed 得到.dep依赖文件（目标的部分依赖）</li>
<li>*技术点：**规则中命令的连续执行<h3 id="2）自动生成依赖文件"><a href="#2）自动生成依赖文件" class="headerlink" title="2）自动生成依赖文件"></a>2）自动生成依赖文件</h3>通过include指令包含所有的.dep依赖文件</li>
<li>*技术点：**当.dep依赖文件不存在时,使用规则自动生成<h3 id="3）编程实现"><a href="#3）编程实现" class="headerlink" title="3）编程实现"></a>3）编程实现</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : all clean</span><br><span class="line"></span><br><span class="line">CC := gcc</span><br><span class="line">RM := rm -rf</span><br><span class="line">MKDIR := mkdir</span><br><span class="line"></span><br><span class="line">SRCS := <span class="variable">$(<span class="built_in">wildcard</span> *.c)</span></span><br><span class="line">DEPS := $(SRCS:.c=.dep)</span><br><span class="line"></span><br><span class="line"><span class="keyword">-include</span> <span class="variable">$(DEPS)</span></span><br><span class="line"></span><br><span class="line">all :</span><br><span class="line">	@echo all</span><br><span class="line"></span><br><span class="line">%.dep : %.c</span><br><span class="line">	@echo <span class="string">&quot;Creating <span class="variable">$@</span>...&quot;</span></span><br><span class="line">	set -e;\</span><br><span class="line">	<span class="variable">$(CC)</span> -MM <span class="variable">$^</span> | sed &#x27;s,\(.*\)\.o[ :]*,objs/\1.o : ,g&#x27; &gt; <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	<span class="variable">$(RM)</span> *.dep</span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">	creat sub.dep ...</span><br><span class="line">	creat add.dep ...</span><br><span class="line">	creat a.dep ...</span><br><span class="line">	all</span><br></pre></td></tr></table></figure>
<h2 id="5-集中管理-dep文件"><a href="#5-集中管理-dep文件" class="headerlink" title="5. 集中管理.dep文件"></a>5. 集中管理.dep文件</h2><h3 id="1）当include发现-dep文件不存在"><a href="#1）当include发现-dep文件不存在" class="headerlink" title="1）当include发现.dep文件不存在"></a>1）当include发现.dep文件不存在</h3>通过规则和命令创建deps文件夹<br>将所有的.dep文件创建到deps文件夹<br>.dep文件中记录目标文件的依赖关系<h3 id="2）编程实现"><a href="#2）编程实现" class="headerlink" title="2）编程实现"></a>2）编程实现</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : all clean</span><br><span class="line"></span><br><span class="line">MKDIR := mkdir</span><br><span class="line">RM := rm -fr</span><br><span class="line">CC := gcc</span><br><span class="line"></span><br><span class="line">DIR_DEPS := deps</span><br><span class="line"></span><br><span class="line">SRCS := <span class="variable">$(<span class="built_in">wildcard</span> *.c)</span></span><br><span class="line">DEPS := $(SRCS:.c=.dep)</span><br><span class="line">DEPS := <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(DIR_DEPS)</span>/,<span class="variable">$(DEPS)</span>)</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">-include</span> <span class="variable">$(DEPS)</span></span><br><span class="line"></span><br><span class="line">all :</span><br><span class="line">	@echo <span class="string">&quot;all&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(DIR_DEPS)</span>:</span><br><span class="line">	<span class="variable">$(MKDIR)</span> <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(<span class="built_in">wildcard</span> <span class="variable">$(DIR_DEPS)</span>)</span>, )</span><br><span class="line"><span class="variable">$(DIR_DEPS)</span>/%.dep : <span class="variable">$(DIR_DEPS)</span> %.c</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="variable">$(DIR_DEPS)</span>/%.dep : %.c</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line">	@echo <span class="string">&quot;Creating <span class="variable">$@</span> ...&quot;</span></span><br><span class="line">	@set -e; \</span><br><span class="line">	<span class="variable">$(CC)</span> -MM -E <span class="variable">$(<span class="built_in">filter</span> %.c, <span class="variable">$^</span>)</span> | sed &#x27;s,\(.*\)\.o[ :]*,objs/\1.o : ,g&#x27; &gt; <span class="variable">$@</span></span><br><span class="line">	</span><br><span class="line">clean :</span><br><span class="line">	<span class="variable">$(RM)</span> <span class="variable">$(DIR_DEPS)</span></span><br><span class="line"></span><br><span class="line">运行结果：</span><br><span class="line">	mkdir deps</span><br><span class="line">	Creating deps/sub.dep ...</span><br><span class="line">	Creating deps/add.dep ...</span><br><span class="line">	Creating deps/a.dep ...</span><br><span class="line">	Creating deps/sub.dep ...</span><br><span class="line">	all	</span><br></pre></td></tr></table></figure>
<h3 id="3）一些-dep文件会被重复创建多次"><a href="#3）一些-dep文件会被重复创建多次" class="headerlink" title="3）一些.dep文件会被重复创建多次"></a>3）一些.dep文件会被重复创建多次</h3>deps文件夹的时间属性会因为依赖文件创建而发生改变<br>make发现deps文件夹比对应的目标更新<br>触发相应规则的重新解析和命令的执行</li>
<li>*解决方案**<br>添加宏代码块进行判断，当不存在deps文件添加文件依赖关系，否则取消文件依赖关系<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ifeq ($(wildcard $(DIR_DEPS)), )</span><br><span class="line">$(DIR_DEPS)/%.dep : $(DIR_DEPS) %.c</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">$(DIR_DEPS)/%.dep : %.c</span><br></pre></td></tr></table></figure>
<h2 id="6-自动生成依赖的最终实现"><a href="#6-自动生成依赖的最终实现" class="headerlink" title="6. 自动生成依赖的最终实现"></a>6. 自动生成依赖的最终实现</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : all clean</span><br><span class="line"></span><br><span class="line">MKDIR := mkdir</span><br><span class="line">RM := rm -fr</span><br><span class="line">CC := gcc</span><br><span class="line"></span><br><span class="line">DIR_DEPS := deps</span><br><span class="line">DIR_OBJS := objs</span><br><span class="line">DIR_EXE  := exes</span><br><span class="line">DIRS := <span class="variable">$(DIR_OBJS)</span> <span class="variable">$(DIR_EXE)</span></span><br><span class="line"></span><br><span class="line">APP = <span class="variable">$(DIR_EXE)</span>/app.out</span><br><span class="line"></span><br><span class="line">SRCS := <span class="variable">$(<span class="built_in">wildcard</span> *.c)</span></span><br><span class="line">DEPS := $(SRCS:.c=.dep)</span><br><span class="line">DEPS := <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(DIR_DEPS)</span>/,<span class="variable">$(DEPS)</span>)</span></span><br><span class="line">OBJS := $(SRCS:.c=.o)</span><br><span class="line">OBJS := <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(DIR_OBJS)</span>/,<span class="variable">$(OBJS)</span>)</span></span><br><span class="line">	</span><br><span class="line">all : <span class="variable">$(APP)</span></span><br><span class="line">	./<span class="variable">$(APP)</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(APP)</span> : <span class="variable">$(DIRS)</span> <span class="variable">$(OBJS)</span></span><br><span class="line">	@echo <span class="string">&quot;target ==&gt; <span class="variable">$@</span>&quot;</span></span><br><span class="line">	<span class="variable">$(CC)</span> -o <span class="variable">$@</span> <span class="variable">$(OBJS)</span></span><br><span class="line">	</span><br><span class="line"><span class="variable">$(DIRS)</span> :</span><br><span class="line">	<span class="variable">$(MKDIR)</span> <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(DIR_OBJS)</span>/%.o : %.c</span><br><span class="line">	<span class="variable">$(CC)</span> -c <span class="variable">$(<span class="built_in">filter</span> %.c, <span class="variable">$^</span>)</span> -o <span class="variable">$@</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">ifeq</span> (<span class="string">&quot;<span class="variable">$(MAKECMDGOALS)</span>&quot;</span>,<span class="string">&quot;all&quot;</span>)</span><br><span class="line"><span class="keyword">-include</span> <span class="variable">$(DEPS)</span> </span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="string">&quot;<span class="variable">$(MAKECMDGOALS)</span>&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">-include</span> <span class="variable">$(DEPS)</span> </span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$(DIR_DEPS)</span>:</span><br><span class="line">	<span class="variable">$(MKDIR)</span> <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(<span class="built_in">wildcard</span> <span class="variable">$(DIR_DEPS)</span>)</span>, )</span><br><span class="line"><span class="variable">$(DIR_DEPS)</span>/%.dep : <span class="variable">$(DIR_DEPS)</span> %.c</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="variable">$(DIR_DEPS)</span>/%.dep : %.c</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line">	@echo <span class="string">&quot;Creating <span class="variable">$@</span> ...&quot;</span></span><br><span class="line">	@set -e; \</span><br><span class="line">	<span class="variable">$(CC)</span> -MM -E <span class="variable">$(<span class="built_in">filter</span> %.c, <span class="variable">$^</span>)</span> | sed &#x27;s,\(.*\)\.o[ :]*,objs/\1.o : ,g&#x27; &gt; <span class="variable">$@</span></span><br><span class="line">	</span><br><span class="line">clean :</span><br><span class="line">	<span class="variable">$(RM)</span> <span class="variable">$(DIR_DEPS)</span> <span class="variable">$(DIRS)</span></span><br></pre></td></tr></table></figure>
代码存在问题，当头文件中包含其他头文件时可能出现修改头文件，make无法执行的情况，解决方案，在生成的依赖中加入dep文件目标，即修改上述代码52行,在冒号前加入$@<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(CC) -MM -E $(<span class="keyword">filter</span> %.c, $^) | sed <span class="string">&#x27;s,\(.*\)\.o[ :]*,objs/\1.o $@: ,g&#x27;</span> &gt; $@</span><br></pre></td></tr></table></figure>
<h1 id="十四、make的隐式规则"><a href="#十四、make的隐式规则" class="headerlink" title="十四、make的隐式规则"></a><div align=center>十四、make的隐式规则</h1><h2 id="1-makfile中出现同名目标时"><a href="#1-makfile中出现同名目标时" class="headerlink" title="1. makfile中出现同名目标时"></a>1. makfile中出现同名目标时</h2></li>
<li>*依赖：**所有的依赖合并在一起，成为目标的最终依赖</li>
<li>*命令：**当多处出现同一目标命令时，make发出警告所有之前定义的命令被最后定义的命令取代<blockquote>
<p>注意事项：<br>当使用include关键字包含其他文件时，需要确保被包含文件中的同名目标只有依赖，没有命令否则，同名文件将被覆盖！</p>
</blockquote>
<h2 id="2-隐式规则"><a href="#2-隐式规则" class="headerlink" title="2. 隐式规则"></a>2. 隐式规则</h2>make提供了一些常用的，例行的规则实现<br>make提供了生成目标文件的隐式规则<br>隐式规则会使用预定义变量完成编译工作<br>改变预定义变量将部分改变隐式规则的行为<br>当存在自定义规则时，不在使用隐式规则<br>当相应目标的规则未提供时，make尝试使用隐式规则<h2 id="3-隐式规则的副作用"><a href="#3-隐式规则的副作用" class="headerlink" title="3. 隐式规则的副作用"></a>3. 隐式规则的副作用</h2></li>
<li><strong>编译行为难以控制</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;大量使用隐式规则可能产生意想不到的编译行为</li>
<li><strong>编译效率低下</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;make从隐式规则和自定义规则中选择最终使用的规则</li>
<li><strong>隐式规则链</strong><br>&nbsp;&nbsp;&nbsp;&nbsp;当依赖目标存在时，make会极力组合各种隐式规则对目标进行创建，进而产生意料之外的编译行为！<h2 id="4-查看隐式规则"><a href="#4-查看隐式规则" class="headerlink" title="4. 查看隐式规则"></a>4. 查看隐式规则</h2></li>
<li>*查看所有**<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">make -p</span></span><br></pre></td></tr></table></figure></li>
<li>*查看具体规则**<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">make</span> -<span class="keyword">p</span> | <span class="keyword">grep</span> <span class="string">&quot;XXX&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="5-隐式规则的禁用"><a href="#5-隐式规则的禁用" class="headerlink" title="5. 隐式规则的禁用"></a>5. 隐式规则的禁用</h2>在makefile中自定义规则<br>在makefile中自定义模式（如：%.o : %.c）<br>全局禁用：make -r<h2 id="6-后缀规则"><a href="#6-后缀规则" class="headerlink" title="6. 后缀规则"></a>6. 后缀规则</h2><h3 id="1）后缀规则简介"><a href="#1）后缀规则简介" class="headerlink" title="1）后缀规则简介"></a>1）后缀规则简介</h3>后缀规则是旧式的“模式规则”<br>可以通过后缀描述的方式自定义规则</li>
</ul>
<img width=400 src="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/5.png">

<h3 id="2）双后缀规则"><a href="#2）双后缀规则" class="headerlink" title="2）双后缀规则"></a>2）双后缀规则</h3><p>定义一对文件后缀（依赖文件后缀和目标文件后缀）</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">.cpp.o</span> &lt;==&gt; %<span class="string">.o</span> : %<span class="string">.cpp</span></span><br></pre></td></tr></table></figure>
<h3 id="3）单后缀规则"><a href="#3）单后缀规则" class="headerlink" title="3）单后缀规则"></a>3）单后缀规则</h3><p>定义单个后缀文件（源文件后缀）</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.c  &lt;==&gt; <span class="meta">%</span> : <span class="meta">%</span>.c</span><br></pre></td></tr></table></figure>
<h2 id="7-后缀规则注意事项"><a href="#7-后缀规则注意事项" class="headerlink" title="7. 后缀规则注意事项"></a>7. 后缀规则注意事项</h2><p>后缀规则中不允许有依赖<br>后缀规则必须有命令，否则无意义<br>后缀规则将逐步被模式规则取代</p>
<h1 id="十五、makefile中的路径搜索"><a href="#十五、makefile中的路径搜索" class="headerlink" title="十五、makefile中的路径搜索"></a><div align=center>十五、makefile中的路径搜索</h1><p>项目中的makefile必须能够正确的定位源文件和依赖文件，最终编译生成可执行程序。</p>
<h2 id="1-特殊的预定义变量VPATH（全大写）"><a href="#1-特殊的预定义变量VPATH（全大写）" class="headerlink" title="1. 特殊的预定义变量VPATH（全大写）"></a>1. 特殊的预定义变量VPATH（全大写）</h2><h3 id="1）VPATH说明"><a href="#1）VPATH说明" class="headerlink" title="1）VPATH说明"></a>1）VPATH说明</h3><p>VPATH变量的值用于指示make如何查找文件<br>不同文件夹可作为VPATH的值同时出现<br>文件夹的名字需要使用分隔符进行区分</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">VPATH :</span>= inc src （空格）</span><br><span class="line"><span class="attr">VPATH :</span>= inc;src （分号）</span><br><span class="line"><span class="attr">VPATH :</span>= <span class="attr">inc:</span>src （冒号）</span><br></pre></td></tr></table></figure>
<h3 id="2）make对于VAPATH值得处理方式"><a href="#2）make对于VAPATH值得处理方式" class="headerlink" title="2）make对于VAPATH值得处理方式"></a>2）make对于VAPATH值得处理方式</h3><p>当前文件夹找不到需要的文件时，VPATH会被使用<br>make会在VPATH指定的文件夹中依次搜索文件<br>当多个文件夹存在同名文件时，选择第一次搜索到的文件</p>
<blockquote>
<p><strong>注意事项：</strong><br>   VPATH只能决定make的搜索路径，无法决定命令的搜索路径<br>   对于特定的编译命令（gcc），需要独立指定编译搜索路径<br>   <strong>语法：gcc -I include-path</strong></p>
</blockquote>
<h3 id="3）VAPATH使用实例"><a href="#3）VAPATH使用实例" class="headerlink" title="3）VAPATH使用实例"></a>3）VAPATH使用实例</h3><p>.c文件存放于src文件夹，.o文件存放于inc文件夹，make自动搜索相关路径生成可执行文件app.out</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : all clean</span><br><span class="line"></span><br><span class="line">MKDIR := mkdir</span><br><span class="line">RM := rm -rf</span><br><span class="line">CC := gcc</span><br><span class="line"></span><br><span class="line">APP := app.out</span><br><span class="line"></span><br><span class="line">DIR_INC := inc</span><br><span class="line">DIR_SRC := src</span><br><span class="line"></span><br><span class="line">VPATH := inc src</span><br><span class="line"></span><br><span class="line">CFLAGS := -I<span class="variable">$(DIR_INC)</span></span><br><span class="line"></span><br><span class="line">all : <span class="variable">$(APP)</span> </span><br><span class="line">	@echo <span class="string">&quot;target ==&gt; <span class="variable">$(APP)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(APP)</span> : a.o sub.o add.o</span><br><span class="line">	<span class="variable">$(CC)</span> -o <span class="variable">$@</span> <span class="variable">$^</span></span><br><span class="line">	</span><br><span class="line">%.o : %.c</span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -c <span class="variable">$^</span> -o <span class="variable">$@</span></span><br><span class="line">	</span><br><span class="line">clean :</span><br><span class="line">	<span class="variable">$(RM)</span> *.o *.out</span><br></pre></td></tr></table></figure>
<p><strong>VPATH存在问题</strong><br>当inc文件意外出现源文件（c/cpp文件），那可能出现编译错误！<br><strong>解决方案</strong><br>使用vpath为不同类型的文件指定不同的搜索路径</p>
<h2 id="2-vapath关键字（全小写）"><a href="#2-vapath关键字（全小写）" class="headerlink" title="2. vapath关键字（全小写）"></a>2. vapath关键字（全小写）</h2><ul>
<li><strong>语法</strong><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">vpath</span> <span class="built_in">Pattern</span> <span class="built_in">Directory</span></span><br></pre></td></tr></table></figure>
在Directory下搜索符合Pattern的规则文件</li>
<li><strong>将上述VPATH修改为vpath</strong><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vpath %</span>.h inc</span><br><span class="line"><span class="built_in">vpath %</span>.c src</span><br></pre></td></tr></table></figure>
<h2 id="3-取消搜索规则"><a href="#3-取消搜索规则" class="headerlink" title="3. 取消搜索规则"></a>3. 取消搜索规则</h2>取消已经设置的某个搜索规则</li>
<li><strong>语法</strong><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vpath <span class="built_in">Pattern</span></span><br></pre></td></tr></table></figure></li>
<li><strong>示例</strong><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vpath %.h <span class="keyword">inc</span>  <span class="meta">#在inc中搜索.h文件</span></span><br><span class="line">Vpath %h       <span class="meta">#不在inc中搜索.h文件</span></span><br></pre></td></tr></table></figure></li>
<li><strong>取消所有已经设置的规则</strong><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">vpath</span></span><br></pre></td></tr></table></figure>
<h2 id="4-问题分析"><a href="#4-问题分析" class="headerlink" title="4. 问题分析"></a>4. 问题分析</h2><h3 id="1-常见问题-1"><a href="#1-常见问题-1" class="headerlink" title="1) 常见问题 1"></a>1) 常见问题 1</h3></li>
<li>*当VPATH和vpath关键字同时出现，make会如何处理？**<br>make首先在当前文件夹下搜索需要的文件<br>如果失败:<br>&nbsp;&nbsp;&nbsp;&nbsp;make首先在vpath提供的路径下寻搜索目标文件<br>&nbsp;&nbsp;&nbsp;&nbsp;当搜索失败时，转而搜索VPATH指定的文件夹<h3 id="2）常见问题-2"><a href="#2）常见问题-2" class="headerlink" title="2）常见问题 2"></a>2）常见问题 2</h3></li>
<li>*当使用vpath对同一个Pattern指定多个文件夹时，make会如何处理？**<br>make首先在当前文件夹搜索需要的文件<br>如果失败：<br>&nbsp;&nbsp;&nbsp;&nbsp;make以自上而下的顺序搜索vpath指定的文件夹<br>&nbsp;&nbsp;&nbsp;&nbsp;当找到目标文件，搜索结束<blockquote>
<p>小贴士：<br>在实际工程开发中优先选择vpath关键字预防make隐式规则的副作用</p>
</blockquote>
<h3 id="3）常见问题-3"><a href="#3）常见问题-3" class="headerlink" title="3）常见问题 3"></a>3）常见问题 3</h3></li>
<li>*通过VPATH变量指定搜索路径后，make如何决定目标文件的最终位置？**</li>
<li>*当app.out完全不存在:**<br>&nbsp;&nbsp;&nbsp;&nbsp;make在当前文件夹下创建app.out</li>
<li>*当src文件中存在app.out**<br>&nbsp;&nbsp;&nbsp;&nbsp;所有目标依赖的新旧关系不变，make不会创建app.out<br>&nbsp;&nbsp;&nbsp;&nbsp;当依赖文件被更新，make在当前文件夹下创建app.out<blockquote>
<p><strong>解决方案</strong><br>使用GPATH特殊变量指定目标文件夹 <strong>GPATH := src</strong><br>当app.out完全不存在,make默认在当前文件夹创建app.out。当app.out存在于src，且依赖文件被更新。make在src中创建app.out</p>
</blockquote>
<h2 id="5-工程建议"><a href="#5-工程建议" class="headerlink" title="5.工程建议"></a>5.工程建议</h2>尽量使用vpath为不同文件指定搜索路径<br>不要在源代码文件夹中生成目标文件<br>为编译得到的结果创立独立的文件夹<br>避免VTPAH和GPATH特殊变量的使用<br>只要使用VPATH就要考虑是否使用GPATH<h1 id="十六、路径搜索的综合示例"><a href="#十六、路径搜索的综合示例" class="headerlink" title="十六、路径搜索的综合示例"></a><div align=center>十六、路径搜索的综合示例</h1><h2 id="1-需求分析"><a href="#1-需求分析" class="headerlink" title="1. 需求分析"></a>1. 需求分析</h2>1）工程项目中不希望源码文件夹在编译过程中被改动（只读文件夹）<br>2）在编译时自动创建文件夹（build）用于存放编译的结果<br>3）编译过程能够自动搜索需要的文件<br>4）makefile易于扩展，能够复用于相同类型的项目<br>5）支持调试版本的编译选项<h2 id="2-项目类型分析"><a href="#2-项目类型分析" class="headerlink" title="2. 项目类型分析"></a>2. 项目类型分析</h2></li>
</ul>
<img width=600 src="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/6.png">

<h2 id="3-工具原料"><a href="#3-工具原料" class="headerlink" title="3. 工具原料"></a>3. 工具原料</h2><p>1）获取$(DIR)文件夹中满足_pattern的文件</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$(<span class="built_in">wildcard</span> <span class="variable">$(DIR)</span>/_pattern)</span></span><br></pre></td></tr></table></figure>
<p>2）去除_names中每一个文件名的路径前缀</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constructor">$(<span class="params">notdir</span> <span class="params">_names</span>)</span></span><br></pre></td></tr></table></figure>
<p>3）将_text中符合_pattern的部分替换为replacement</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constructor">$(<span class="params">patsubst</span> <span class="params">_pattern</span>, <span class="params">replacement</span>, <span class="params">_text</span>)</span></span><br></pre></td></tr></table></figure>
<h2 id="4-关键技巧"><a href="#4-关键技巧" class="headerlink" title="4. 关键技巧"></a>4. 关键技巧</h2><ol>
<li>自动获取源文件列表（函数调用）<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SRCS := <span class="variable">$(<span class="built_in">wildcard</span> src/*.c)</span></span><br></pre></td></tr></table></figure></li>
<li>根据源文件列表生成目标文件列表（变量值的替换）<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">OBJS :</span>= $(<span class="attr">SRCS:</span>.c=.o)</span><br></pre></td></tr></table></figure></li>
<li>替换每一个目标的路径前缀（函数调用）<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OBJS := <span class="variable">$(<span class="built_in">patsubst</span> src/%,build/% , <span class="variable">$(OBJS)</span>)</span></span><br></pre></td></tr></table></figure>
<h2 id="5-编程实现-1"><a href="#5-编程实现-1" class="headerlink" title="5.编程实现"></a>5.编程实现</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : all clean</span><br><span class="line"></span><br><span class="line">MKDIR := mkdir</span><br><span class="line">RM := rm -rf</span><br><span class="line">CC := gcc</span><br><span class="line"></span><br><span class="line">DIR_INC := inc</span><br><span class="line">DIR_SRC := src</span><br><span class="line">DIR_BUILDS := build</span><br><span class="line"></span><br><span class="line">TYPE_INT := .h</span><br><span class="line">TYPE_SRC := .c</span><br><span class="line">TYPE_OBJ := .o</span><br><span class="line"></span><br><span class="line">DEBUG := </span><br><span class="line"></span><br><span class="line">LFLAGS := </span><br><span class="line">CFLAGS := -I<span class="variable">$(DIR_INC)</span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(DEBUG)</span>,true)</span><br><span class="line">CFLAGS += -g</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line">APP := <span class="variable">$(DIR_BUILDS)</span>/app.out</span><br><span class="line"></span><br><span class="line">SCRS := <span class="variable">$(<span class="built_in">wildcard</span> <span class="variable">$(DIR_SRC)</span>/*<span class="variable">$(TYPE_SRC)</span>)</span></span><br><span class="line">OBJS := $(SCRS:<span class="variable">$(TYPE_SRC)</span>=<span class="variable">$(TYPE_OBJ)</span>)</span><br><span class="line">OBJS := <span class="variable">$(<span class="built_in">patsubst</span> <span class="variable">$(DIR_SRC)</span>/%,<span class="variable">$(DIR_BUILDS)</span>/%,<span class="variable">$(OBJS)</span>)</span></span><br><span class="line">HDRS := <span class="variable">$(<span class="built_in">wildcard</span> <span class="variable">$(DIR_INC)</span>/*<span class="variable">$(TYPE_INC)</span>)</span></span><br><span class="line">HDRS := <span class="variable">$(<span class="built_in">notdir</span> <span class="variable">$(HDRS)</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">vpath</span> %<span class="variable">$(TYPE_INC)</span> <span class="variable">$(DIR_INC)</span></span><br><span class="line"><span class="keyword">vpath</span> %<span class="variable">$(TYPE_SRC)</span> <span class="variable">$(DIR_SRC)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">all : <span class="variable">$(DIR_BUILDS)</span> <span class="variable">$(APP)</span> </span><br><span class="line">	./<span class="variable">$(APP)</span></span><br><span class="line">	</span><br><span class="line"><span class="variable">$(DIR_BUILDS)</span> :</span><br><span class="line">	<span class="variable">$(MKDIR)</span> <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(APP)</span> : <span class="variable">$(OBJS)</span></span><br><span class="line">	@echo <span class="string">&quot;target ==&gt; <span class="variable">$(APP)</span>&quot;</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(LFLAGS)</span> -o <span class="variable">$@</span> <span class="variable">$^</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(DIR_BUILDS)</span>/%<span class="variable">$(TYPE_OBJ)</span> : %<span class="variable">$(TYPE_SRC)</span> <span class="variable">$(HDRS)</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -c <span class="variable">$&lt;</span> -o <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line">clean :</span><br><span class="line">	<span class="variable">$(RM)</span> <span class="variable">$(DIR_BUILDS)</span></span><br></pre></td></tr></table></figure>
<h1 id="十七、打造专业的编译环境"><a href="#十七、打造专业的编译环境" class="headerlink" title="十七、打造专业的编译环境"></a><div align=center>十七、打造专业的编译环境</h1><h2 id="1-大型项目目录结构-无第三库"><a href="#1-大型项目目录结构-无第三库" class="headerlink" title="1. 大型项目目录结构(无第三库)"></a>1. 大型项目目录结构(无第三库)</h2></li>
</ol>
<img width=800 src="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/7.jpg">

<h2 id="2-需要打造的编译环境"><a href="#2-需要打造的编译环境" class="headerlink" title="2. 需要打造的编译环境"></a>2. 需要打造的编译环境</h2><p>源码文件夹在编译时不能被改动（只读文件夹）<br>在编译时自动创建文件夹（build）用于存放编译结果<br>编译过程中自动生成依赖关系，自动搜索需要的文件<br>每个模块可以拥有自己独立的编译方式<br>支持调试版本的编译选项</p>
<h2 id="3-项目架构设计分析"><a href="#3-项目架构设计分析" class="headerlink" title="3. 项目架构设计分析"></a>3. 项目架构设计分析</h2><h3 id="1）项目被划分为多个不同模块"><a href="#1）项目被划分为多个不同模块" class="headerlink" title="1）项目被划分为多个不同模块"></a>1）项目被划分为多个不同模块</h3><p>每个模块的代码用一个文件夹进行管理<br>&nbsp;&nbsp;&nbsp;&nbsp;文件夹由inc,src,makfile构成<br>每个模块的对外函数声明统一放置于common/inc中<br>&nbsp;&nbsp;&nbsp;&nbsp;如：common.h xxfunc.h</p>
<h3 id="2）实现阶段分析"><a href="#2）实现阶段分析" class="headerlink" title="2）实现阶段分析"></a>2）实现阶段分析</h3><p>由项目的目录结构将整个makefile的实现分为两个阶段编译（Compile）和链接（Link）</p>
<ul>
<li><strong>Compile阶段</strong><br>将每个文件中的代码编译成静态库文件</li>
</ul>
<img width=600 src="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/8.jpg">

<blockquote>
<p>任务：<br>完成可用于各个模块可编译的makefile文件<br>每个模块的编译结果为静态库文件（.a文件）</p>
</blockquote>
<ul>
<li><strong>link阶段</strong><br>将每个模块的静态库文件链接生成最终可执行程序</li>
</ul>
<img width=600 src="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/9.jpg">

<blockquote>
<p>任务:<br>完成整编译个工程的makefile文件<br>调用模块的makefile编译生成静态库文件<br>链接所有的静态库文件，最终得到可执行程序</p>
</blockquote>
<h2 id="4-Compile阶段实现"><a href="#4-Compile阶段实现" class="headerlink" title="4. Compile阶段实现"></a>4. Compile阶段实现</h2><h3 id="1）关键的实现要点"><a href="#1）关键的实现要点" class="headerlink" title="1）关键的实现要点"></a>1）关键的实现要点</h3><p>自动生成依赖关系（gcc -MM）<br>自动搜索需要的文件（vpath）<br>将目标打包为静态库文件（ar crs）</p>
<h3 id="2）模块中的makefile构成"><a href="#2）模块中的makefile构成" class="headerlink" title="2）模块中的makefile构成"></a>2）模块中的makefile构成</h3><img width=600 src="https://myblog-1259396478.cos.ap-chengdu.myqcloud.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/makefile/10.jpg">

<h3 id="3）编程实现-1"><a href="#3）编程实现-1" class="headerlink" title="3）编程实现"></a>3）编程实现</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">.PHONY : all</span><br><span class="line"></span><br><span class="line">DIR_BUILD := /home/delphi/project/build</span><br><span class="line">DIR_COMMON_INC := /home/delphi/project/common/inc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DIR_INC := inc</span><br><span class="line">DIR_SRC := src</span><br><span class="line"></span><br><span class="line">TYPE_INC := .h</span><br><span class="line">TYPE_SRC := .c</span><br><span class="line">TYPE_OBJ := .o</span><br><span class="line">TYPE_DEP := .dep</span><br><span class="line"></span><br><span class="line">CC := gcc</span><br><span class="line">RM := rm -rf </span><br><span class="line">MKDIR := mkdir </span><br><span class="line"></span><br><span class="line">AR := ar</span><br><span class="line">ARFLAGS := csr</span><br><span class="line"></span><br><span class="line">CFLAGS := -I<span class="variable">$(DIR_INC)</span> -I<span class="variable">$(DIR_COMMON_INC)</span></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="variable">$(DEBUG)</span>,true)</span><br><span class="line">CFLAGS += -g</span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line">MODULE := <span class="variable">$(<span class="built_in">realpath</span> .)</span></span><br><span class="line">MODULE := <span class="variable">$(<span class="built_in">notdir</span> <span class="variable">$(MODULE)</span>)</span></span><br><span class="line">DIR_OUTPUT := <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(DIR_BUILD)</span>/,<span class="variable">$(MODULE)</span>)</span></span><br><span class="line"></span><br><span class="line">OUTPUT := <span class="variable">$(MODULE)</span>.a</span><br><span class="line">OUTPUT := <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(DIR_BUILD)</span>/,<span class="variable">$(OUTPUT)</span>)</span></span><br><span class="line"></span><br><span class="line">SRCS := <span class="variable">$(<span class="built_in">wildcard</span> <span class="variable">$(DIR_SRC)</span>/*<span class="variable">$(TYPE_SRC)</span>)</span></span><br><span class="line">OBJS := $(SRCS:<span class="variable">$(TYPE_SRC)</span>=<span class="variable">$(TYPE_OBJ)</span>)</span><br><span class="line">OBJS := <span class="variable">$(<span class="built_in">patsubst</span> <span class="variable">$(DIR_SRC)</span>/%,<span class="variable">$(DIR_OUTPUT)</span>/%,<span class="variable">$(OBJS)</span>)</span></span><br><span class="line">DEPS := $(SRCS:<span class="variable">$(TYPE_SRC)</span>=<span class="variable">$(TYPE_DEP)</span>)</span><br><span class="line">DEPS := <span class="variable">$(<span class="built_in">patsubst</span> <span class="variable">$(DIR_SRC)</span>/%,<span class="variable">$(DIR_OUTPUT)</span>/%,<span class="variable">$(DEPS)</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">vpath</span> %<span class="variable">$(TYPE_INC)</span> <span class="variable">$(DIR_INC)</span></span><br><span class="line"><span class="keyword">vpath</span> %<span class="variable">$(TYPE_INC)</span> <span class="variable">$(DIR_COMMON_INC)</span></span><br><span class="line"><span class="keyword">vpath</span> %<span class="variable">$(TYPE_SRC)</span> <span class="variable">$(DIR_SRC)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="string">&quot;<span class="variable">$(MAKECMDGOALS)</span>&quot;</span>,<span class="string">&quot;all&quot;</span>)</span><br><span class="line"><span class="keyword">-include</span> <span class="variable">$(DEPS)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ifeq</span> (<span class="string">&quot;<span class="variable">$(MAKECMDGOALS)</span>&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">-include</span> <span class="variable">$(DEPS)</span></span><br><span class="line"><span class="keyword">endif</span></span><br><span class="line"></span><br><span class="line">test :</span><br><span class="line">	@echo <span class="string">&quot;<span class="variable">$(MAKECMDGOALS)</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(DIR_OUTPUT)</span>/%<span class="variable">$(TYPE_DEP)</span> : %<span class="variable">$(TYPE_SRC)</span></span><br><span class="line">	@echo <span class="string">&quot;Creating <span class="variable">$@</span> ...&quot;</span></span><br><span class="line">	@set -e;\</span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -MM -E <span class="variable">$(<span class="built_in">filter</span> %<span class="variable">$(TYPE_SRC)</span>,<span class="variable">$^</span>)</span> | sed &#x27;s,\(.*\)\.o[ :]*,objs/\1.o <span class="variable">$@</span>: ,g&#x27; &gt; <span class="variable">$@</span></span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">all : <span class="variable">$(OUTPUT)</span></span><br><span class="line">	@echo <span class="string">&quot;Success Target ==&gt; <span class="variable">$@</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$(OUTPUT)</span> : <span class="variable">$(OBJS)</span></span><br><span class="line">	<span class="variable">$(AR)</span> <span class="variable">$(ARFLAGS)</span> <span class="variable">$@</span> <span class="variable">$^</span></span><br><span class="line">	</span><br><span class="line"><span class="variable">$(DIR_OUTPUT)</span>/%<span class="variable">$(TYPE_OBJ)</span> : %<span class="variable">$(TYPE_SRC)</span></span><br><span class="line">	<span class="variable">$(CC)</span> <span class="variable">$(CFLAGS)</span> -c <span class="variable">$(<span class="built_in">filter</span> %<span class="variable">$(TYPE_SRC)</span>,<span class="variable">$^</span>)</span> -o <span class="variable">$@</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="5-Link阶段实现"><a href="#5-Link阶段实现" class="headerlink" title="5. Link阶段实现"></a>5. Link阶段实现</h2><h3 id="1）开发中的经验假设"><a href="#1）开发中的经验假设" class="headerlink" title="1）开发中的经验假设"></a>1）开发中的经验假设</h3><p>项目中各个模块在设计阶段就已经基本确定，因此在在之后的开发过程中不会频繁的随意增加或者减少</p>
<h3 id="2）设计思路"><a href="#2）设计思路" class="headerlink" title="2）设计思路"></a>2）设计思路</h3><ul>
<li><p><strong>定义变量模块名列表（模块变量名）</strong></p>
</li>
<li><p><strong>利用shell的for循环遍历模块变量名</strong> </p>
</li>
<li><p><strong>在for循环中进入模块文件夹进行编译</strong></p>
</li>
<li><p><strong>循环结束后链接所有的模块静态库文件</strong></p>
<h3 id="3）编程实现-2"><a href="#3）编程实现-2" class="headerlink" title="3）编程实现"></a>3）编程实现</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">.PHONY : all compile link</span><br><span class="line"></span><br><span class="line">MODULES := common \</span><br><span class="line">           main \</span><br><span class="line">           module</span><br><span class="line">        </span><br><span class="line">CC := gcc </span><br><span class="line">MKDIR := mkdir</span><br><span class="line">RM := rm -rf</span><br><span class="line"></span><br><span class="line">LFLAGS :=</span><br><span class="line"></span><br><span class="line">DIR_PROJECT := <span class="variable">$(<span class="built_in">realpath</span> .)</span></span><br><span class="line">DIR_BUILD := build</span><br><span class="line">DIR_BUILD_SUB := <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(DIR_BUILD)</span>/,<span class="variable">$(MODULES)</span>)</span></span><br><span class="line">MODULE_LIB := <span class="variable">$(<span class="built_in">addsuffix</span> .a,<span class="variable">$(MODULES)</span>)</span></span><br><span class="line">MODULE_LIB := <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(DIR_BUILD)</span>/,<span class="variable">$(MODULE_LIB)</span>)</span></span><br><span class="line"></span><br><span class="line">APP := app.out</span><br><span class="line">APP := <span class="variable">$(<span class="built_in">addprefix</span> <span class="variable">$(DIR_BUILD)</span>/,<span class="variable">$(APP)</span>)</span></span><br><span class="line"></span><br><span class="line">all : compile link</span><br><span class="line"></span><br><span class="line">link : <span class="variable">$(MODULE_LIB)</span></span><br><span class="line">	@echo <span class="string">&quot;Bengin to link ...&quot;</span></span><br><span class="line">	<span class="variable">$(CC)</span> -o <span class="variable">$(APP)</span> -Xlinker <span class="string">&quot;-(&quot;</span> <span class="variable">$^</span> -Xlinker <span class="string">&quot;-)&quot;</span> <span class="variable">$(LFLAGS)</span></span><br><span class="line">	@echo <span class="string">&quot;Success Target ==&gt; <span class="variable">$@</span> ...&quot;</span></span><br><span class="line"></span><br><span class="line">compile : <span class="variable">$(DIR_BUILD)</span> <span class="variable">$(DIR_BUILD_SUB)</span></span><br><span class="line">	@echo <span class="string">&quot;Compile Begin ...&quot;</span></span><br><span class="line">	@set -e;\</span><br><span class="line">	for dir in <span class="variable">$(MODULES)</span>;\</span><br><span class="line">	do\</span><br><span class="line">		cd $$dir &amp;&amp; make all DEBUG:=<span class="variable">$(DEBUG)</span> &amp;&amp; cd ..;\</span><br><span class="line">	done</span><br><span class="line">	@echo <span class="string">&quot;Compile Success ...&quot;</span></span><br><span class="line">	</span><br><span class="line"><span class="variable">$(DIR_BUILD)</span> <span class="variable">$(DIR_BUILD_SUB)</span> :</span><br><span class="line">	<span class="variable">$(MKDIR)</span> <span class="variable">$@</span></span><br><span class="line"></span><br><span class="line">clean :</span><br><span class="line">	<span class="variable">$(RM)</span> <span class="variable">$(DIR_BUILD)</span> </span><br></pre></td></tr></table></figure>
<h2 id="6-上述makefile存在潜在问题"><a href="#6-上述makefile存在潜在问题" class="headerlink" title="6. 上述makefile存在潜在问题"></a>6. 上述makefile存在潜在问题</h2><h3 id="1）问题-1"><a href="#1）问题-1" class="headerlink" title="1）问题 1"></a>1）问题 1</h3><p>所有模块makefile中使用编译路径均为写死的绝对路径，一旦项目文件夹移动，编译必将失败</p>
<h3 id="2）解决方案"><a href="#2）解决方案" class="headerlink" title="2）解决方案"></a>2）解决方案</h3><p>在工程makefile中获取项目的源码目录<br>根据项目源码路径：<br>  拼接得到编译文件夹路径DIR_BUILD<br>  拼接得到全局头文件路径DIR_COMMON_INC<br>通过定义命令行变量将路径传递给模块makefile</p>
<h3 id="3）问题-2"><a href="#3）问题-2" class="headerlink" title="3）问题 2"></a>3）问题 2</h3><p>所有makefile模块完全相同，当模块makefile需要改动时，将涉多处相同改动</p>
</li>
</ul>
<h1 id="未完待续！！！"><a href="#未完待续！！！" class="headerlink" title="未完待续！！！"></a>未完待续！！！</h1>
    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>braon-z
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://example.com/2021/01/18/makfile%E4%B8%93%E9%A2%98/" title="makefile专题">https://example.com/2021/01/18/makfile专题/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

          <div class="post-tags">
              <a href="/tags/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" rel="tag"><i class="fa fa-tag"></i> 基础知识</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/01/03/linux%E9%A9%B1%E5%8A%A8-%E8%AE%BE%E5%A4%87%E9%A9%B1%E5%8A%A8%E6%A8%A1%E5%9E%8B/" rel="prev" title="linux设备模型">
                  <i class="fa fa-chevron-left"></i> linux设备模型
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/06/11/linux%E9%A9%B1%E5%8A%A8-pinctrl/" rel="next" title="pinctrl 子系统">
                  pinctrl 子系统 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">braon-z</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">357k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">5:24</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/local-search.js"></script>






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





<script>
NexT.utils.loadComments('#valine-comments', () => {
  NexT.utils.getScript('https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js', () => {
    new Valine(Object.assign({"enable":true,"appId":"VsC1eQwQ4Xltm5eA9iYGp3VU-gzGzoHsz","appKey":"kyfyE4RWl6aIojedbxcuJa3V","serverURLs":null,"placeholder":"Just go go","avatar":"mm","meta":["nick","mail","link"],"pageSize":10,"lang":null,"visitor":false,"comment_count":true,"recordIP":false,"enableQQ":false,"requiredFields":[]}, {
      el: '#valine-comments',
      path: "/2021/01/18/makfile%E4%B8%93%E9%A2%98/",
      serverURLs: "https://vsc1eqwq.api.lncldglobal.com"
    }));
  }, window.Valine);
});
</script>




  <script src="/js/activate-power-mode.min.js"></script>
  <script>
    POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);
  </script>
<div class="moon-menu">
  <div class="moon-menu-items">
    
    <div class="moon-menu-item" onclick="back2bottom()">
      <i class='fa fa-chevron-down'></i>    </div>
    
    <div class="moon-menu-item" onclick="back2top()">
      <i class='fa fa-chevron-up'></i>    </div>
    
  </div>
  <div class="moon-menu-button">
    <svg class="moon-menu-bg">
      <circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle>
      <circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle>
    </svg>
    <div class="moon-menu-content">
      <div class="moon-menu-icon"><i class='fas fa-ellipsis-v'></i></div>
      <div class="moon-menu-text"></div>
    </div>
  </div>
</div><script src="/js/injector.js"></script>
</body>
</html>
